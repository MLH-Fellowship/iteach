!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(my){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l,e=t(my),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(Ie=l=l||{})[Ie.DEBUG=0]="DEBUG",Ie[Ie.VERBOSE=1]="VERBOSE",Ie[Ie.INFO=2]="INFO",Ie[Ie.WARN=3]="WARN",Ie[Ie.ERROR=4]="ERROR",Ie[Ie.SILENT=5]="SILENT";function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=c[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},a=l.INFO,c=((Ee={})[l.DEBUG]="log",Ee[l.VERBOSE]="log",Ee[l.INFO]="info",Ee[l.WARN]="warn",Ee[l.ERROR]="error",Ee),h=(Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),f.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?u[t]:t},Object.defineProperty(f.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),f.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},f.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},f.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},f.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},f.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},f);function f(t){this.name=t,this._logLevel=a,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(n(w,d=Error),w);function w(t,e){e=d.call(this,e)||this;return e.code=t,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").",s=new m(o,t),u=0,a=Object.keys(i);u<a.length;u++){var c=a[u];"_"!==c.slice(-1)&&(c in s&&console.warn('Overwriting FirebaseError base field "'+c+'" can cause unexpected behavior.'),s[c]=i[c])}return s},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S={},D=A||self;function O(){}function x(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function R(t){var e=x(t);return"array"==e||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function C(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:C).apply(null,arguments)}function M(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now;function F(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++P))},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var H,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var $=D.navigator;if($){$=$.userAgent;if($){H=$;break t}}H=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e,n={};for(e in t)n[e]=t[e];return n}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<tt.length;i++)e=tt[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function nt(t){return nt[" "](t),t}nt[" "]=O;var rt,it=Y(H,"Opera"),ot=Y(H,"Trident")||Y(H,"MSIE"),st=Y(H,"Edge"),ut=st||ot,at=Y(H,"Gecko")&&!(Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge"))&&!(Y(H,"Trident")||Y(H,"MSIE"))&&!Y(H,"Edge"),ct=Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge");function ht(){var t=D.document;return t?t.documentMode:void 0}t:{var ft="",lt=(lt=H,at?/rv:([^\);]+)(\)|;)/.exec(lt):st?/Edge\/([\d\.]+)/.exec(lt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lt):ct?/WebKit\/(\S+)/.exec(lt):it?/(?:Version)[ \/]?(\S+)/.exec(lt):void 0);if(lt&&(ft=lt?lt[1]:""),ot){lt=ht();if(null!=lt&&lt>parseFloat(ft)){rt=String(lt);break t}}rt=ft}var pt={};function dt(u){return t=u,e=function(){for(var t=0,e=Q(String(rt)).split("."),n=Q(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=pt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var yt=D.document&&ot?ht()||(parseInt(rt,10)||void 0):void 0,vt=!ot||9<=Number(yt),gt=ot&&!dt("9"),mt=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{D.addEventListener("test",O,e),D.removeEventListener("test",O,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function bt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},F(bt,wt);var It={2:"touch",3:"pen",4:"mouse"};bt.prototype.b=function(){bt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),_t=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++_t,this.Y=this.Z=!1}function Nt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function At(t){this.src=t,this.a={},this.b=0}function St(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Nt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}At.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Dt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Tt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),xt={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=jt(r);return e&&e[Et]?e.wa(n,r,k(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=jt(n),t&&t[Et]?t.va(e,n,k(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!vt)return null;var u,a,c=Ut(t);if(c||(t[Ot]=c=new At(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Ct,r=a=vt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)mt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Et]?St(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(St(n,t),0==n.b&&(n.src=null,e[Ot]=null)):Nt(t)))}function Pt(t){return t in xt?xt[t]:xt[t]="on"+t}function Vt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Lt(t),n.call(r,e)}function Ct(t,e){if(t.Y)return!0;if(vt)return Vt(t,new bt(e,this));if(!e)t:{e=["window","event"];for(var n=D,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Vt(t,e=new bt(e,this))}function Ut(t){return(t=t[Ot])instanceof At?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(e){return"function"==x(e)?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function Ft(){q.call(this),this.c=new At(this),(this.J=this).C=null}function qt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&St(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}F(Ft,q),Ft.prototype[Et]=!0,(N=Ft.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=jt(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Dt(s=e.a[n],r,i,o))&&(Nt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ut(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Dt(n,r,i,o)),(r=-1<e?n[e]:null)&&Lt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new wt(t,n):t instanceof wt?t.target=t.target||n:(s=t,et(t=new wt(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=qt(o,r,!0,t)&&s;if(s=qt(o=t.a=n,r,!0,t)&&s,s=qt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=qt(o=t.a=e[i],r,!1,t)&&s;return s},N.G=function(){if(Ft.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Nt(n[r]);delete e.a[t],e.b--}}this.C=null},N.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Bt=D.JSON.stringify;function Gt(){this.b=this.a=null}var zt,Wt=(Kt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Kt(function(){return new Ht},function(t){t.reset()},100));function Kt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Ht(){this.next=this.b=this.a=null}function Qt(t,e){var n;zt||(n=D.Promise.resolve(void 0),zt=function(){n.then($t)}),Yt||(zt(),Yt=!0),Xt.add(t,e)}Gt.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ht.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Yt=!(Ht.prototype.reset=function(){this.next=this.b=this.a=null}),Xt=new Gt;function $t(){for(var t,e;n=e=void 0,n=null,(e=Xt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){D.setTimeout(function(){throw t},0)}(t)}var n=Wt;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Yt=!1}function Jt(t,e){Ft.call(this),this.b=t||1,this.a=e||D,this.f=U(this.Ya,this),this.g=j()}function Zt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function te(t,e,n){if("function"==x(t))n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:D.setTimeout(t,e||0)}F(Jt,Ft),(N=Jt.prototype).aa=!1,N.M=null,N.Ya=function(){var t;this.aa&&(0<(t=j()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Zt(this),this.start())))},N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=j())},N.G=function(){Jt.S.G.call(this),Zt(this),delete this.a};var ee,ne,re,ie=(_(ne=se,re=ee=q),ne.prototype=null===re?Object.create(re):(oe.prototype=re.prototype,new oe),se.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=te(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},se.prototype.G=function(){ee.prototype.G.call(this),this.a&&(D.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},se);function oe(){this.constructor=ne}function se(t,e,n){var r=ee.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function ue(t){q.call(this),this.b=t,this.a={}}F(ue,q);var ae=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function fe(){this.a=!0}function le(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Bt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ue.prototype.G=function(){ue.S.G.call(this),he(this)},ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},fe.prototype.info=function(){};var pe=null;function de(){return pe=pe||new Ft}function ye(t){wt.call(this,"serverreachability",t)}function ve(t){var e=de();e.dispatchEvent(new ye(e))}function ge(t){wt.call(this,"statevent",t)}function me(t){var e=de();e.dispatchEvent(new ge(e))}function we(t){wt.call(this,"timingevent",t)}function be(t,e){if("function"!=x(t))throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){t()},e)}F(ye,wt),F(ge,wt),F(we,wt);var Ie={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Ee={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function _e(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ne(){}_e.prototype.a=null;var Ae,A={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Se(){wt.call(this,"d")}function De(){wt.call(this,"c")}function Oe(){}function xe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new ue(this),this.P=Re,t=ut?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}F(Se,wt),F(De,wt),F(Oe,_e),Ae=new Oe;var Re=45e3,ke={},Le={};function Pe(t,e,n){t.H=1,t.i=en(Ye(e)),t.j=n,t.I=!0,Ve(t,null)}function Ve(t,e){t.u=j(),Ue(t),t.l=Ye(t.i);var s,u,a,c,h,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.D=0,t.a=ar(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(U(t.Ca,t,t.a),t.O)),ce(t.J,t.a,"readystatechange",t.Wa),e=t.B?Z(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ve(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Ce(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=i=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?Le:(i=Number(u.substring(i,o)),isNaN(i)?ke:(o+=1)+i>u.length?Le:(u=u.substr(o,i),r.D=o+i,u)));if(u==Le){4==e&&(t.h=4,me(14),s=!1),le(t.c,t.f,null,"[Incomplete Response]");break}if(u==ke){t.h=4,me(15),le(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}le(t.c,t.f,u,null),Be(t,u)}4==e&&0==n.length&&(t.h=1,me(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),tr(e),e.F=!0)):(le(t.c,t.f,n,"[Invalid Chunked Response]"),qe(t),Fe(t))}function Ue(t){t.U=j()+t.P,Me(t,t.P)}function Me(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=be(U(t.Ua,t),e)}function je(t){t.o&&(D.clearTimeout(t.o),t.o=null)}function Fe(t){0==t.g.v||t.A||rr(t.g,t)}function qe(t){je(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Zt(t.R),he(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Be(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||En(u.b,t)))if(u.I=t.N,!t.C&&En(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;nr(u),Wn(u)}Zn(u),me(18)}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=be(U(u.Ra,u),6e3));if(In(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else or(u,11)}else if(!t.C&&u.a!=t||nr(u),!K(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++){c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(Y(r,"spdy")||Y(r,"quic")||Y(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(_n(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,tn(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.V&&(u.N=j()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=ur(n,n.C?n.ga:null,n.fa),i.C?(Tn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(je(o),Ue(o)),n.a=i):Jn(n),0<u.g.length&&Qn(u)):"stop"!=c[0]&&"close"!=c[0]||or(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?or(u,7):zn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0)}ve(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=xe.prototype).setTimeout=function(t){this.P=t},N.Wa=function(t){t=t.target;var e=this.F;e&&3==Fn(t)?e.f():this.Ca(t)},N.Ca=function(t){try{if(t==this.a)t:{var e=Fn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ut&&!this.a.$())){this.A||4!=e||7==n||ve(8==n||r<=0?3:2),je(this);var i=this.a.X();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.T,f=e,l=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+f+" "+l}),this.b){if(this.V&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,me(12),qe(this),Fe(this);break t}le(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Be(this,s)}this.I?(Ce(this,e,n),ut&&this.b&&3==e&&(ce(this.J,this.R,"tick",this.Va),this.R.start())):(le(this.c,this.f,n,null),Be(this,n)),4==e&&qe(this),this.b&&!this.A&&(4==e?rr(this.g,this):(this.b=!1,Ue(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,me(12)):(this.h=0,me(13)),qe(this),Fe(this)}}}catch(t){}var u,a,c,h,f,l},N.Va=function(){var t,e;this.a&&(t=Fn(this.a),e=this.a.$(),this.D<e.length&&(je(this),Ce(this,t,e),this.b&&4!=t&&Ue(this)))},N.cancel=function(){this.A=!0,qe(this)},N.Ua=function(){this.o=null;var t,e,n=j();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ve(3),me(17)),qe(this),this.h=2,Fe(this)):Me(this,this.U-n)},(N=ze.prototype).K=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.L=function(){return We(this),this.a.concat()},N.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},N.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Qe(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Qe?(this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,$e(this,t.c),Je(this,t.h),this.g=t.g,e=t.b,(n=new fn).c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),Ze(this,n),this.i=t.i):t&&(n=String(t).match(He))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=nn(n[2]||""),$e(this,n[3]||"",!0),Je(this,n[4]),this.g=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=nn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Ye(t){return new Qe(t)}function Xe(t,e,n){t.f=n?nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?nn(e,!0):e}function Je(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){var r,i;e instanceof fn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(ln(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),yn(this,n,t))},r)),r.f=i):(n||(e=rn(e,cn)),t.b=new fn(e,t.a))}function tn(t,e,n){t.b.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Qe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rn(e,sn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?an:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",rn(n,hn)),t.join("")};var sn=/[#\/\?@]/g,un=/[#\?:]/g,an=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function ln(n){n.a||(n.a=new ze,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function pn(t,e){ln(t),e=vn(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function dn(t,e){return ln(t),e=vn(t,e),Ke(t.a.b,e)}function yn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(vn(t,e),W(n)),t.b+=n.length)}function vn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function gn(t,e){this.b=t,this.a=e}function mn(t){this.g=t||wn,t=D.PerformanceNavigationTiming?0<(t=D.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(D.ia&&D.ia.ya&&D.ia.ya()&&D.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=fn.prototype).add=function(t,e){ln(this),this.c=null,t=vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){ln(this),this.a.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},N.L=function(){ln(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.K=function(t){ln(this);var e=[];if("string"==typeof t)dn(this,t)&&(e=z(e,this.a.get(vn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},N.set=function(t,e){return ln(this),this.c=null,dn(this,t=vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var wn=10;function bn(t){return t.b||t.a&&t.a.size>=t.f}function In(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function Tn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return W(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function An(){}function Sn(){this.a=new An}function Dn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){var e,t;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},An.prototype.stringify=function(t){return D.JSON.stringify(t,void 0)},An.prototype.parse=function(t){return D.JSON.parse(t,void 0)};var On=D.JSON.parse;function xn(t){Ft.call(this),this.headers=new ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Rn,this.D=this.F=!1}F(xn,Ft);var Rn="",kn=/^https?$/i,Ln=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Mn(t)}function Cn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Un(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=Fn(t)||2!=t.X()))if(t.l&&4==Fn(t))te(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Fn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(He)[1]||null)&&D.self&&D.self.location&&(i=(r=D.self.location.protocol).substr(0,r.length-1)),n=!kn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Fn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",Cn(t)}}finally{Mn(t)}}}function Mn(t,e){if(t.a){jn(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function jn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(D.clearTimeout(t.m),t.m=null)}function Fn(t){return t.a?t.a.readyState:0}function qn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.pa=0,this.g=[],this.c=new fe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Bn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Bn("baseRetryDelayMs",5e3,t),this.Ma=Bn("retryDelaySeedMs",1e4,t),this.Ja=Bn("forwardChannelMaxRetries",2,t),this.ma=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new mn(t&&t.concurrentRequestLimit),this.ka=new Sn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function zn(t){var e,n;Kn(t),3==t.v&&(e=t.R++,tn(n=Ye(t.B),"SID",t.J),tn(n,"RID",e),tn(n,"TYPE","terminate"),Xn(t,n),(e=new xe(t,t.c,e,void 0)).H=2,e.i=en(Ye(n)),n=!1,D.navigator&&D.navigator.sendBeacon&&(n=D.navigator.sendBeacon(e.i.toString(),"")),!n&&D.Image&&((new Image).src=e.i,n=!0),n||(e.a=ar(e.g,null),e.a.ba(e.i)),e.u=j(),Ue(e)),sr(t)}function Wn(t){t.a&&(tr(t),t.a.cancel(),t.a=null)}function Kn(t){Wn(t),t.j&&(D.clearTimeout(t.j),t.j=null),nr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&D.clearTimeout(t.h),t.h=null)}function Hn(t,e){t.g.push(new gn(t.La++,e)),3==t.v&&Qn(t)}function Qn(t){bn(t.b)||t.h||(t.h=!0,Qt(t.Ba,t),t.u=0)}function Yn(t,e){var n=e?e.f:t.R++,r=Ye(t.B);tn(r,"SID",t.J),tn(r,"RID",n),tn(r,"AID",t.P),Xn(t,r),t.i&&t.l&&qn(r,t.i,t.l),n=new xe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),_n(t.b,n),Pe(n,r,e)}function Xn(t,n){t.f&&Ge({},function(t,e){tn(n,e,t)})}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?U(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;k(t)&&(n=Bt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Jn(t){t.a||t.j||(t.U=1,Qt(t.Aa,t),t.o=0)}function Zn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=be(U(t.Aa,t),ir(t,t.o)),t.o++,1)}function tr(t){null!=t.s&&(D.clearTimeout(t.s),t.s=null)}function er(t){t.a=new xe(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ye(t.la);tn(e,"RID","rpc"),tn(e,"SID",t.J),tn(e,"CI",t.H?"0":"1"),tn(e,"AID",t.P),Xn(t,e),tn(e,"TYPE","xmlhttp"),t.i&&t.l&&qn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=en(Ye(e)),n.j=null,n.I=!0,Ve(n,t)}function nr(t){null!=t.m&&(D.clearTimeout(t.m),t.m=null)}function rr(t,e){var n,r=null;if(t.a==e){nr(t),tr(t),t.a=null;var i=2}else{if(!En(t.b,e))return;r=e.s,Tn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=j()-e.u,n=t.u,(i=de()).dispatchEvent(new we(i)),Qn(t)):Jn(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(In(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=be(U(t.Ba,t,e),ir(t,t.u)),t.u++,1}}(t,e)||2==i&&Zn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function or(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=U(t.Xa,t),r||(r=new Qe("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||Xe(r,"https"),en(r)),n=r.toString(),r=o,o=new fe,D.Image?((i=new Image).onload=M(Dn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=M(Dn,o,i,"TestLoadImage: error",!1,r),i.onabort=M(Dn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=M(Dn,o,i,"TestLoadImage: timeout",!1,r),D.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):me(2),t.v=0,t.f&&t.f.ra(e),sr(t),Kn(t)}function sr(t){t.v=0,t.I=-1,t.f&&(0==Nn(t.b).length&&0==t.g.length||(t.b.c.length=0,W(t.g),t.g.length=0),t.f.qa())}function ur(t,e,n){var r,i,o,s,u,a=(s=n)instanceof Qe?Ye(s):new Qe(s,void 0);return""!=a.c?(e&&$e(a,e+"."+a.c),Je(a,a.h)):(u=D.location,r=u.protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new Qe(null,void 0),r&&Xe(u,r),i&&$e(u,i),o&&Je(u,o),s&&(u.g=s),a=u),t.W&&J(t.W,function(t,e){tn(a,e,t)}),e=t.A,n=t.na,e&&n&&tn(a,e,n),tn(a,"VER",t.ha),Xn(t,a),a}function ar(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Ka)).F=t.C,e}function cr(){}function hr(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function fr(t,e){Ft.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new dr(this)}function lr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){De.call(this),this.status=1}function dr(t){this.a=t}(N=xn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Te(this.H):Te(Ae),this.a.onreadystatechange=U(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Vn(this,t)}t=n||"";var i,o=new ze(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=D.FormData&&t instanceof D.FormData,0<=B(Ln,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jn(this),0<this.o&&((this.D=(i=this.a,ot&&dt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=U(this.xa,this)):this.m=te(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vn(this,t)}},N.xa=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Mn(this))},N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Mn(this,!0)),xn.S.G.call(this)},N.za=function(){this.j||(this.A||this.l||this.g?Un(this):this.Ta())},N.Ta=function(){Un(this)},N.X=function(){try{return 2<Fn(this)?this.a.status:-1}catch(t){return-1}},N.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),On(e)}},N.ua=function(){return this.h},N.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Gn.prototype).ha=8,N.v=1,N.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new xe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?et(r=Z(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),tn(i=Ye(this.B),"RID",t),tn(i,"CVER",22),this.A&&tn(i,"X-HTTP-Session-Id",this.A),Xn(this,i),this.i&&r&&qn(i,this.i,r),_n(this.b,n),this.Ga&&tn(i,"TYPE","init"),this.da?(tn(i,"$req",e),tn(i,"SID","null"),n.V=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?Yn(this,t):0==this.g.length||bn(this.b)||Yn(this))},N.Aa=function(){var t;this.j=null,er(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=be(U(this.Sa,this),t))},N.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Wn(this),er(this))},N.Ra=function(){null!=this.m&&(this.m=null,Wn(this),Zn(this),me(19))},N.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),me(2)):(this.c.info("Failed to ping google.com"),me(1))},(N=cr.prototype).ta=function(){},N.sa=function(){},N.ra=function(){},N.qa=function(){},N.Ha=function(){},hr.prototype.a=function(t,e){return new fr(t,e)},F(fr,Ft),(N=fr.prototype).addEventListener=function(t,e,n,r){fr.S.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){fr.S.removeEventListener.call(this,t,e,n,r)},N.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;me(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ur(t,null,t.fa),Qn(t)},N.close=function(){zn(this.a)},N.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,Hn(this.a,e)):this.g?((e={}).__data__=Bt(t),Hn(this.a,e)):Hn(this.a,t)},N.G=function(){this.a.f=null,delete this.f,zn(this.a),delete this.a,fr.S.G.call(this)},F(lr,Se),F(pr,De),F(dr,cr),dr.prototype.ta=function(){this.a.dispatchEvent("a")},dr.prototype.sa=function(t){this.a.dispatchEvent(new lr(t))},dr.prototype.ra=function(t){this.a.dispatchEvent(new pr)},dr.prototype.qa=function(){this.a.dispatchEvent("b")},hr.prototype.createWebChannel=hr.prototype.a,fr.prototype.send=fr.prototype.Pa,fr.prototype.open=fr.prototype.Oa,Ie.NO_ERROR=0,Ie.TIMEOUT=8,Ie.HTTP_ERROR=6,Ee.COMPLETE="complete",(Ne.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",Ft.prototype.listen=Ft.prototype.va,xn.prototype.listenOnce=xn.prototype.wa,xn.prototype.getLastError=xn.prototype.Qa,xn.prototype.getLastErrorCode=xn.prototype.ua,xn.prototype.getStatus=xn.prototype.X,xn.prototype.getResponseJson=xn.prototype.Na,xn.prototype.getResponseText=xn.prototype.$,xn.prototype.send=xn.prototype.ba;var Ie={createWebChannelTransport:function(){return new hr},ErrorCode:Ie,EventType:Ee,WebChannel:Ne,XhrIo:xn},yr=Ie.createWebChannelTransport,vr=Ie.ErrorCode,gr=Ie.EventType,mr=Ie.WebChannel,wr=Ie.XhrIo,br=(Ir.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ir.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ir.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ir);function Ir(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Er,_r={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Tr=(n(Ar,Er=Error),Ar),Nr=new h("@firebase/firestore");function Ar(t,e){var n=this;return(n=Er.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Sr(){return Nr.logLevel}function Dr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Nr.logLevel<=l.DEBUG&&(e=n.map(Rr),Nr.debug.apply(Nr,i(["Firestore (7.23.0): "+t],e)))}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Nr.logLevel<=l.ERROR&&(e=n.map(Rr),Nr.error.apply(Nr,i(["Firestore (7.23.0): "+t],e)))}function xr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Nr.logLevel<=l.WARN&&(e=n.map(Rr),Nr.warn.apply(Nr,i(["Firestore (7.23.0): "+t],e)))}function Rr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function kr(t){void 0===t&&(t="Unexpected state");t="FIRESTORE (7.23.0) INTERNAL ASSERTION FAILED: "+t;throw Or(t),new Error(t)}function Lr(t){t||kr()}function Pr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Vr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Cr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ur,Mr,Ee=(Object.defineProperty(Kr.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),Kr.prototype.isEqual=function(t){return 0===Kr.i(this,t)},Kr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Kr?t.forEach(function(t){e.push(t)}):e.push(t),this.o(e)},Kr.prototype.limit=function(){return this.offset+this.length},Kr.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},Kr.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},Kr.prototype.l=function(){return this.segments[this.offset]},Kr.prototype._=function(){return this.get(this.length-1)},Kr.prototype.get=function(t){return this.segments[this.offset+t]},Kr.prototype.m=function(){return 0===this.length},Kr.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Kr.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Kr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Kr.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},Kr.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Kr),jr=(n(Wr,Mr=Ee),Wr.prototype.o=function(t,e,n){return new Wr(t,e,n)},Wr.prototype.R=function(){return this.A().join("/")},Wr.prototype.toString=function(){return this.R()},Wr.P=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Tr(_r.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Wr(n)},Wr.g=function(){return new Wr([])},Wr),Fr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qr=(n(zr,Ur=Ee),zr.prototype.o=function(t,e,n){return new zr(t,e,n)},zr.V=function(t){return Fr.test(t)},zr.prototype.R=function(){return this.A().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),zr.V(t)||(t="`"+t+"`"),t}).join(".")},zr.prototype.toString=function(){return this.R()},zr.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},zr.v=function(){return new zr(["__name__"])},zr.S=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Tr(_r.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Tr(_r.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Tr(_r.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Tr(_r.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new zr(e)},zr.g=function(){return new zr([])},zr),Br=(Gr.D=function(t){return new Gr(jr.P(t))},Gr.C=function(t){return new Gr(jr.P(t).u(5))},Gr.prototype.N=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Gr.prototype.isEqual=function(t){return null!==t&&0===jr.i(this.path,t.path)},Gr.prototype.toString=function(){return this.path.toString()},Gr.i=function(t,e){return jr.i(t.path,e.path)},Gr.F=function(t){return t.length%2==0},Gr.$=function(t){return new Gr(new jr(t.slice()))},Gr);function Gr(t){this.path=t}function zr(){return null!==Ur&&Ur.apply(this,arguments)||this}function Wr(){return null!==Mr&&Mr.apply(this,arguments)||this}function Kr(t,e,n){void 0===e?e=0:e>t.length&&kr(),void 0===n?n=t.length-e:n>t.length-e&&kr(),this.segments=t,this.offset=e,this.t=n}function Hr(t,e){if(0!==e.length)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+fi(e.length,"argument")+".")}function Qr(t,e,n){if(e.length!==n)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires "+fi(n,"argument")+", but was called with "+fi(e.length,"argument")+".")}function Yr(t,e,n){if(e.length<n)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires at least "+fi(n,"argument")+", but was called with "+fi(e.length,"argument")+".")}function Xr(t,e,n,r){if(e.length<n||e.length>r)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+fi(e.length,"argument")+".")}function $r(t,e,n,r){ri(t,e,hi(n)+" argument",r)}function Jr(t,e,n,r){void 0!==r&&$r(t,e,n,r)}function Zr(t,e,n,r){ri(t,e,n+" option",r)}function ti(t,e,n,r){void 0!==r&&Zr(t,e,n,r)}function ei(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(oi(s))}var u=oi(n);throw new Tr(_r.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function ni(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Tr(_r.INVALID_ARGUMENT,"Invalid value "+oi(r)+" provided to function "+t+"() for its "+hi(n)+" argument. Acceptable values: "+e.join(", "));return r}function ri(t,e,n,r){if(!("object"===e?ii(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){r=oi(r);throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+r)}}function ii(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function oi(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":kr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function si(t,e,n){if(void 0===n)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+hi(e)+" argument, but it was undefined.")}function ui(n,t,r){Vr(t,function(t,e){if(r.indexOf(t)<0)throw new Tr(_r.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function ai(t,e,n,r){r=oi(r);return new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires its "+hi(n)+" argument to be a "+e+", but it was: "+r)}function ci(t,e,n){if(n<=0)throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires its "+hi(e)+" argument to be a positive number, but it was: "+n+".")}function hi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function fi(t,e){return t+" "+e+(1===t?"":"s")}var li=(pi.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},pi);function pi(){}function di(t,e){return t<e?-1:e<t?1:0}function yi(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function vi(t){return t+"\0"}var gi=(mi.fromBase64String=function(t){return new mi(atob(t))},mi.fromUint8Array=function(t){return new mi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},mi.prototype.toBase64=function(){return t=this.M,btoa(t);var t},mi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},mi.prototype.O=function(){return 2*this.M.length},mi.prototype.L=function(t){return di(this.M,t.M)},mi.prototype.isEqual=function(t){return this.M===t.M},mi);function mi(t){this.M=t}gi.B=new gi("");var wi=(bi.fromBase64String=function(t){try{return new bi(gi.fromBase64String(t))}catch(t){throw new Tr(_r.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},bi.fromUint8Array=function(t){return new bi(gi.fromUint8Array(t))},bi.prototype.toBase64=function(){return this.q.toBase64()},bi.prototype.toUint8Array=function(){return this.q.toUint8Array()},bi.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},bi.prototype.isEqual=function(t){return this.q.isEqual(t.q)},bi);function bi(t){this.q=t}function Ii(){if("undefined"==typeof Uint8Array)throw new Tr(_r.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ei(){if("undefined"==typeof atob)throw new Tr(_r.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function _i(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Ti,Ni=(n(Pi,Ti=wi),Pi.fromBase64String=function(t){Qr("Blob.fromBase64String",arguments,1),$r("Blob.fromBase64String","string",1,t),Ei();try{return new Pi(gi.fromBase64String(t))}catch(t){throw new Tr(_r.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Pi.fromUint8Array=function(t){if(Qr("Blob.fromUint8Array",arguments,1),Ii(),!(t instanceof Uint8Array))throw ai("Blob.fromUint8Array","Uint8Array",1,t);return new Pi(gi.fromUint8Array(t))},Pi.prototype.toBase64=function(){return Qr("Blob.toBase64",arguments,0),Ei(),Ti.prototype.toBase64.call(this)},Pi.prototype.toUint8Array=function(){return Qr("Blob.toUint8Array",arguments,0),Ii(),Ti.prototype.toUint8Array.call(this)},Pi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Pi),Ai=(Object.defineProperty(Li.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Li.prototype.isEqual=function(t){return t instanceof Li&&t.projectId===this.projectId&&t.database===this.database},Li.prototype.L=function(t){return di(this.projectId,t.projectId)||di(this.database,t.database)},Li),Si=(ki.prototype.get=function(t){var e=this.j(t),e=this.G[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.K(o,t))return i}},ki.prototype.has=function(t){return void 0!==this.get(t)},ki.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},ki.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},ki.prototype.forEach=function(s){Vr(this.G,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},ki.prototype.m=function(){return Cr(this.G)},ki),Di=(Ri.now=function(){return Ri.fromMillis(Date.now())},Ri.fromDate=function(t){return Ri.fromMillis(t.getTime())},Ri.fromMillis=function(t){var e=Math.floor(t/1e3);return new Ri(e,1e6*(t-1e3*e))},Ri.prototype.toDate=function(){return new Date(this.toMillis())},Ri.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Ri.prototype.H=function(t){return this.seconds===t.seconds?di(this.nanoseconds,t.nanoseconds):di(this.seconds,t.seconds)},Ri.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Ri.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Ri.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Ri.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Ri),Oi=(xi.Y=function(t){return new xi(t)},xi.min=function(){return new xi(new Di(0,0))},xi.prototype.L=function(t){return this.timestamp.H(t.timestamp)},xi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},xi.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},xi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},xi.prototype.X=function(){return this.timestamp},xi);function xi(t){this.timestamp=t}function Ri(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Tr(_r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Tr(_r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Tr(_r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Tr(_r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ki(t,e){this.j=t,this.K=e,this.G={}}function Li(t,e){this.projectId=t,this.database=e||"(default)"}function Pi(){return null!==Ti&&Ti.apply(this,arguments)||this}function Vi(t){return null==t}function Ci(t){return 0===t&&1/t==-1/0}function Ui(t){return"number"==typeof t&&Number.isInteger(t)&&!Ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Mi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function ji(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Mi(t,e,n,r,i,o,s)}function Fi(t){var e=t;return null===e.Z&&(t=e.path.R(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.R()+t.op.toString()+Fo(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.R()+t.dir}).join(","),Vi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=wa(e.startAt)),e.endAt&&(t+="|ub:",t+=wa(e.endAt)),e.Z=t),e.Z}function qi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Co(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ia(t.startAt,e.startAt)&&Ia(t.endAt,e.endAt)}function Bi(t){return Br.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Gi(t){this.count=t}var zi,Wi=(Ki.prototype.nt=function(t){return new Ki(this.target,this.targetId,this.tt,t,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ki.prototype.st=function(t,e){return new Ki(this.target,this.targetId,this.tt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ki.prototype.it=function(t){return new Ki(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,t,this.resumeToken)},Ki);function Ki(t,e,n,r,i,o,s){void 0===i&&(i=Oi.min()),void 0===o&&(o=Oi.min()),void 0===s&&(s=gi.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Hi(t){switch(t){case _r.OK:return kr(),0;case _r.CANCELLED:case _r.UNKNOWN:case _r.DEADLINE_EXCEEDED:case _r.RESOURCE_EXHAUSTED:case _r.INTERNAL:case _r.UNAVAILABLE:case _r.UNAUTHENTICATED:return;case _r.INVALID_ARGUMENT:case _r.NOT_FOUND:case _r.ALREADY_EXISTS:case _r.PERMISSION_DENIED:case _r.FAILED_PRECONDITION:case _r.ABORTED:case _r.OUT_OF_RANGE:case _r.UNIMPLEMENTED:case _r.DATA_LOSS:return 1;default:return kr(),0}}function Qi(t){if(void 0===t)return Or("GRPC error has no .code"),_r.UNKNOWN;switch(t){case zi.OK:return _r.OK;case zi.CANCELLED:return _r.CANCELLED;case zi.UNKNOWN:return _r.UNKNOWN;case zi.DEADLINE_EXCEEDED:return _r.DEADLINE_EXCEEDED;case zi.RESOURCE_EXHAUSTED:return _r.RESOURCE_EXHAUSTED;case zi.INTERNAL:return _r.INTERNAL;case zi.UNAVAILABLE:return _r.UNAVAILABLE;case zi.UNAUTHENTICATED:return _r.UNAUTHENTICATED;case zi.INVALID_ARGUMENT:return _r.INVALID_ARGUMENT;case zi.NOT_FOUND:return _r.NOT_FOUND;case zi.ALREADY_EXISTS:return _r.ALREADY_EXISTS;case zi.PERMISSION_DENIED:return _r.PERMISSION_DENIED;case zi.FAILED_PRECONDITION:return _r.FAILED_PRECONDITION;case zi.ABORTED:return _r.ABORTED;case zi.OUT_OF_RANGE:return _r.OUT_OF_RANGE;case zi.UNIMPLEMENTED:return _r.UNIMPLEMENTED;case zi.DATA_LOSS:return _r.DATA_LOSS;default:return kr()}}(Ie=zi=zi||{})[Ie.OK=0]="OK",Ie[Ie.CANCELLED=1]="CANCELLED",Ie[Ie.UNKNOWN=2]="UNKNOWN",Ie[Ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ie[Ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ie[Ie.NOT_FOUND=5]="NOT_FOUND",Ie[Ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ie[Ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ie[Ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ie[Ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ie[Ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ie[Ie.ABORTED=10]="ABORTED",Ie[Ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ie[Ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ie[Ie.INTERNAL=13]="INTERNAL",Ie[Ie.UNAVAILABLE=14]="UNAVAILABLE",Ie[Ie.DATA_LOSS=15]="DATA_LOSS";var Yi=(to.prototype.rt=function(t,e){return new to(this.i,this.root.rt(t,e,this.i).copy(null,null,$i.ot,null,null))},to.prototype.remove=function(t){return new to(this.i,this.root.remove(t,this.i).copy(null,null,$i.ot,null,null))},to.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},to.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},to.prototype.m=function(){return this.root.m()},Object.defineProperty(to.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),to.prototype.at=function(){return this.root.at()},to.prototype.ct=function(){return this.root.ct()},to.prototype.ut=function(t){return this.root.ut(t)},to.prototype.forEach=function(n){this.ut(function(t,e){return n(t,e),!1})},to.prototype.toString=function(){var n=[];return this.ut(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},to.prototype.ht=function(t){return this.root.ht(t)},to.prototype.lt=function(){return new Xi(this.root,null,this.i,!1)},to.prototype._t=function(t){return new Xi(this.root,t,this.i,!1)},to.prototype.ft=function(){return new Xi(this.root,null,this.i,!0)},to.prototype.dt=function(t){return new Xi(this.root,t,this.i,!0)},to),Xi=(Zi.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},Zi.prototype.It=function(){return 0<this.Tt.length},Zi.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},Zi),$i=(Ji.prototype.copy=function(t,e,n,r,i){return new Ji(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ji.prototype.m=function(){return!1},Ji.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},Ji.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},Ji.prototype.min=function(){return this.left.m()?this:this.left.min()},Ji.prototype.at=function(){return this.min().key},Ji.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},Ji.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},Ji.prototype.Pt=function(){if(this.left.m())return Ji.EMPTY;var t=this;return t.left.gt()||t.left.left.gt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Rt()},Ji.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.m()||r.left.gt()||r.left.left.gt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.gt()&&(r=r.Vt()),r.right.m()||r.right.gt()||r.right.left.gt()||(r=r.bt()),0===e(t,r.key)){if(r.right.m())return Ji.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Rt()},Ji.prototype.gt=function(){return this.color},Ji.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},Ji.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},Ji.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},Ji.prototype.vt=function(){var t=this.copy(null,null,Ji.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ji.prototype.Vt=function(){var t=this.copy(null,null,Ji.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ji.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ji.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},Ji.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw kr();if(this.right.gt())throw kr();var t=this.left.Ct();if(t!==this.right.Ct())throw kr();return t+(this.gt()?0:1)},Ji);function Ji(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ji.RED,this.left=null!=r?r:Ji.EMPTY,this.right=null!=i?i:Ji.EMPTY,this.size=this.left.size+1+this.right.size}function Zi(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}function to(t,e){this.i=t,this.root=e||$i.EMPTY}function eo(){this.size=0}$i.EMPTY=null,$i.RED=!0,$i.ot=!1,$i.EMPTY=(Object.defineProperty(eo.prototype,"key",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(eo.prototype,"value",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(eo.prototype,"color",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(eo.prototype,"left",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(eo.prototype,"right",{get:function(){throw kr()},enumerable:!1,configurable:!0}),eo.prototype.copy=function(t,e,n,r,i){return this},eo.prototype.rt=function(t,e,n){return new $i(t,e)},eo.prototype.remove=function(t,e){return this},eo.prototype.m=function(){return!0},eo.prototype.ut=function(t){return!1},eo.prototype.ht=function(t){return!1},eo.prototype.at=function(){return null},eo.prototype.ct=function(){return null},eo.prototype.gt=function(){return!1},eo.prototype.Dt=function(){return!0},eo.prototype.Ct=function(){return 0},new eo);var no=(so.prototype.has=function(t){return null!==this.data.get(t)},so.prototype.first=function(){return this.data.at()},so.prototype.last=function(){return this.data.ct()},Object.defineProperty(so.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),so.prototype.indexOf=function(t){return this.data.indexOf(t)},so.prototype.forEach=function(n){this.data.ut(function(t,e){return n(t),!1})},so.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(0<=this.i(r.key,t[1]))return;e(r.key)}},so.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},so.prototype.$t=function(t){t=this.data._t(t);return t.It()?t.Et().key:null},so.prototype.lt=function(){return new ro(this.data.lt())},so.prototype._t=function(t){return new ro(this.data._t(t))},so.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},so.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},so.prototype.m=function(){return this.data.m()},so.prototype.xt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},so.prototype.isEqual=function(t){if(!(t instanceof so))return!1;if(this.size!==t.size)return!1;for(var e=this.data.lt(),n=t.data.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.i(r,i))return!1}return!0},so.prototype.A=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},so.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},so.prototype.copy=function(t){var e=new so(this.i);return e.data=t,e},so),ro=(oo.prototype.Et=function(){return this.kt.Et().key},oo.prototype.It=function(){return this.kt.It()},oo),io=new Yi(Br.i);function oo(t){this.kt=t}function so(t){this.i=t,this.data=new Yi(this.i)}var uo=new Yi(Br.i);var ao=new Yi(Br.i),co=new no(Br.i);function ho(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=co,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var fo=new no(di);var lo=(Oo.Lt=function(t){return new Oo(t.i)},Oo.prototype.has=function(t){return null!=this.Mt.get(t)},Oo.prototype.get=function(t){return this.Mt.get(t)},Oo.prototype.first=function(){return this.Ot.at()},Oo.prototype.last=function(){return this.Ot.ct()},Oo.prototype.m=function(){return this.Ot.m()},Oo.prototype.indexOf=function(t){t=this.Mt.get(t);return t?this.Ot.indexOf(t):-1},Object.defineProperty(Oo.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),Oo.prototype.forEach=function(n){this.Ot.ut(function(t,e){return n(t),!1})},Oo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},Oo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},Oo.prototype.isEqual=function(t){if(!(t instanceof Oo))return!1;if(this.size!==t.size)return!1;for(var e=this.Ot.lt(),n=t.Ot.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},Oo.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Oo.prototype.copy=function(t,e){var n=new Oo;return n.i=this.i,n.Mt=t,n.Ot=e,n},Oo),po=(Do.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);!n||0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):kr()},Do.prototype.qt=function(){var n=[];return this.Bt.ut(function(t,e){n.push(e)}),n},Do),yo=(So.Kt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new So(t,e,lo.Lt(e),i,n,r,!0,!1)},Object.defineProperty(So.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),So.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Bu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},So),vo=(Ao.Jt=function(t,e){var n=new Map;return n.set(t,go.Xt(t,e)),new Ao(Oi.min(),n,fo,io,ho())},Ao),go=(No.Xt=function(t,e){return new No(gi.B,e,ho(),ho(),ho())},No),mo=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},wo=function(t,e){this.targetId=t,this.re=e},bo=function(t,e,n,r){void 0===n&&(n=gi.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Io=(Object.defineProperty(To.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(To.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(To.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(To.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),To.prototype.fe=function(t){0<t.O()&&(this.he=!0,this.ce=t)},To.prototype.de=function(){var n=ho(),r=ho(),i=ho();return this.ae.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:kr()}}),new go(this.ce,this.ue,n,r,i)},To.prototype.we=function(){this.he=!1,this.ae=Ro()},To.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},To.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},To.prototype.Ee=function(){this.oe+=1},To.prototype.Ie=function(){--this.oe},To.prototype.Ae=function(){this.he=!0,this.ue=!0},To),Eo=(_o.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof _u?this.be(r,t.ie):t.ie instanceof Tu&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},_o.prototype.Se=function(n){var r=this;this.De(n,function(t){var e=r.Ce(t);switch(n.state){case 0:r.Ne(t)&&e.fe(n.resumeToken);break;case 1:e.Ie(),e.le||e.we(),e.fe(n.resumeToken);break;case 2:e.Ie(),e.le||r.removeTarget(t);break;case 3:r.Ne(t)&&(e.Ae(),e.fe(n.resumeToken));break;case 4:r.Ne(t)&&(r.Fe(t),e.fe(n.resumeToken));break;default:kr()}})},_o.prototype.De=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Pe.forEach(function(t,e){r.Ne(e)&&n(e)})},_o.prototype.$e=function(t){var e=t.targetId,n=t.re.count,t=this.xe(e);t&&(Bi(t=t.target)?0===n?(t=new Br(t.path),this.ve(e,t,new Tu(t,Oi.min()))):Lr(1===n):this.ke(e)!==n&&(this.Fe(e),this.Ve=this.Ve.add(e)))},_o.prototype.Me=function(r){var i=this,o=new Map;this.Pe.forEach(function(t,e){var n=i.xe(e);n&&(t.Zt&&Bi(n.target)&&(n=new Br(n.target.path),null!==i.ge.get(n)||i.Oe(e,n)||i.ve(e,n,new Tu(n,r))),t._e&&(o.set(e,t.de()),t.we()))});var s=ho();this.ye.forEach(function(t,e){var n=!0;e.Ft(function(t){t=i.xe(t);return!t||2===t.tt||(n=!1)}),n&&(s=s.add(t))});var t=new vo(r,o,this.Ve,this.ge,s);return this.ge=io,this.ye=xo(),this.Ve=new no(di),t},_o.prototype.be=function(t,e){var n;this.Ne(t)&&(n=this.Oe(t,e.key)?2:0,this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t)))},_o.prototype.ve=function(t,e,n){var r;this.Ne(t)&&(r=this.Ce(t),this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n)))},_o.prototype.removeTarget=function(t){this.Pe.delete(t)},_o.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},_o.prototype.Ee=function(t){this.Ce(t).Ee()},_o.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Io,this.Pe.set(t,e)),e},_o.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new no(di),this.ye=this.ye.rt(t,e)),e},_o.prototype.Ne=function(t){var e=null!==this.xe(t);return e||Dr("WatchChangeAggregator","Detected inactive target",t),e},_o.prototype.xe=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},_o.prototype.Fe=function(e){var n=this;this.Pe.set(e,new Io),this.Re.Be(e).forEach(function(t){n.ve(e,t,null)})},_o.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},_o);function _o(t){this.Re=t,this.Pe=new Map,this.ge=io,this.ye=xo(),this.Ve=new no(di)}function To(){this.oe=0,this.ae=Ro(),this.ce=gi.B,this.ue=!1,this.he=!0}function No(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}function Ao(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}function So(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function Do(){this.Bt=new Yi(Br.i)}function Oo(n){this.i=n?function(t,e){return n(t,e)||Br.i(t.key,e.key)}:function(t,e){return Br.i(t.key,e.key)},this.Mt=uo,this.Ot=new Yi(this.i)}function xo(){return new Yi(Br.i)}function Ro(){return new Yi(Br.i)}function ko(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Lo(t){t=qo(t.mapValue.fields.__local_write_time__.timestampValue);return new Di(t.seconds,t.nanos)}var Po=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ko(t)?4:10:kr()}function Co(r,i){var t,e=Vo(r);if(e!==Vo(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Lo(r).isEqual(Lo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=qo(r.timestampValue),t=qo(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Go(r.bytesValue).isEqual(Go(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Bo((t=r).geoPointValue.latitude)===Bo(e.geoPointValue.latitude)&&Bo(t.geoPointValue.longitude)===Bo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Bo(t.integerValue)===Bo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=Bo(t.doubleValue),e=Bo(e.doubleValue);return t===e?Ci(t)===Ci(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return yi(r.arrayValue.values||[],i.arrayValue.values||[],Co);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Pr(e)!==Pr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Co(e[t],n[t])))return!1;return!0}();default:return kr()}}function Uo(t,e){return void 0!==(t.values||[]).find(function(t){return Co(t,e)})}function Mo(t,e){var n,r,i=Vo(t),o=Vo(e);if(i!==o)return di(i,o);switch(i){case 0:return 0;case 1:return di(t.booleanValue,e.booleanValue);case 2:return n=e,r=Bo(t.integerValue||t.doubleValue),n=Bo(n.integerValue||n.doubleValue),r<n?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return jo(t.timestampValue,e.timestampValue);case 4:return jo(Lo(t),Lo(e));case 5:return di(t.stringValue,e.stringValue);case 6:return function(t,e){t=Go(t),e=Go(e);return t.L(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=di(n[i],r[i]);if(0!==o)return o}return di(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=di(Bo(i.latitude),Bo(r.latitude)))?n:di(Bo(i.longitude),Bo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Mo(n[i],r[i]);if(o)return o}return di(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=di(r[s],o[s]);if(0!==u)return u;u=Mo(n[r[s]],i[o[s]]);if(0!==u)return u}return di(r.length,o.length)}(t.mapValue,e.mapValue);default:throw kr()}}function jo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return di(t,e);var n=qo(t),t=qo(e),e=di(n.seconds,t.seconds);return 0!==e?e:di(n.nanos,t.nanos)}function Fo(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=qo(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Go(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Br.C(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):kr();var e}(t)}function qo(t){if(Lr(!!t),"string"!=typeof t)return{seconds:Bo(t.seconds),nanos:Bo(t.nanos)};var e=0,n=Po.exec(t);Lr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function Bo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Go(t){return"string"==typeof t?gi.fromBase64String(t):gi.fromUint8Array(t)}function zo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function Wo(t){return t&&"integerValue"in t}function Ko(t){return!!t&&"arrayValue"in t}function Ho(t){return t&&"nullValue"in t}function Qo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Yo(t){return t&&"mapValue"in t}var Xo={asc:"ASCENDING",desc:"DESCENDING"},$o={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Jo=function(t,e){this.U=t,this.Ue=e};function Zo(t){return{integerValue:""+t}}function ts(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ci(e)?"-0":e}}function es(t,e){return Ui(e)?Zo(e):ts(t,e)}function ns(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function rs(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function is(t){return Lr(!!t),Oi.Y((t=qo(t),new Di(t.seconds,t.nanos)))}function os(t,e){return new jr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).R()}function ss(t){t=jr.P(t);return Lr(Ts(t)),t}function us(t,e){return os(t.U,e.path)}function as(t,e){e=ss(e);return Lr(e.get(1)===t.U.projectId),Lr(!e.get(3)&&!t.U.database||e.get(3)===t.U.database),new Br(ls(e))}function cs(t,e){return os(t.U,e)}function hs(t){t=ss(t);return 4===t.length?jr.g():ls(t)}function fs(t){return new jr(["projects",t.U.projectId,"databases",t.U.database]).R()}function ls(t){return Lr(4<t.length&&"documents"===t.get(4)),t.u(5)}function ps(t,e,n){return{name:us(t,e),fields:n.proto.mapValue.fields}}function ds(t,e){var n,r,i;if(e instanceof eu)n={update:ps(t,e.key,e.value)};else if(e instanceof lu)n={delete:us(t,e.key)};else if(e instanceof nu)n={update:ps(t,e.key,e.data),updateMask:(i=e.Qe,r=[],i.fields.forEach(function(t){return r.push(t.R())}),{fieldPaths:r})};else if(e instanceof uu)n={transform:{document:us(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ds)return{fieldPath:t.field.R(),setToServerValue:"REQUEST_TIME"};if(e instanceof Os)return{fieldPath:t.field.R(),appendMissingElements:{values:e.elements}};if(e instanceof Ps)return{fieldPath:t.field.R(),removeAllFromArray:{values:e.elements}};if(e instanceof Ms)return{fieldPath:t.field.R(),increment:e.We};throw kr()})}};else{if(!(e instanceof pu))return kr();n={verify:us(t,e.key)}}return e.Ke.je||(n.currentDocument=void 0!==(i=e.Ke).updateTime?{updateTime:(e=t,t=i.updateTime,ns(e,t.X()))}:void 0!==i.exists?{exists:i.exists}:kr()),n}function ys(e,t){var n=t.currentDocument?void 0!==(o=t.currentDocument).updateTime?Ks.updateTime(is(o.updateTime)):void 0!==o.exists?Ks.exists(o.exists):Ks.Ge():Ks.Ge();if(t.update){t.update.name;var r=as(e,t.update.name),i=new du({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=(o=t.updateMask.fieldPaths||[],new Bs(o.map(function(t){return qr.S(t)})));return new nu(r,i,o,n)}return new eu(r,i,n)}if(t.delete){var s=as(e,t.delete);return new lu(s,n)}if(t.transform){i=as(e,t.transform.document),s=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(Lr("REQUEST_TIME"===e.setToServerValue),r=new Ds):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new Os(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new Ps(n)):"increment"in e?r=new Ms(t,e.increment):kr();e=qr.S(e.fieldPath);return new Gs(e,r)}(e,t)});return Lr(!0===n.exists),new uu(i,s)}if(t.verify){t=as(e,t.verify);return new pu(t,n)}return kr()}function vs(t,e){return{documents:[cs(t,e.path)]}}function gs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=cs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=cs(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Qo(t.value))return{unaryFilter:{field:Is(t.field),op:"IS_NAN"}};if(Ho(t.value))return{unaryFilter:{field:Is(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qo(t.value))return{unaryFilter:{field:Is(t.field),op:"IS_NOT_NAN"}};if(Ho(t.value))return{unaryFilter:{field:Is(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Is(t.field),op:(e=t.op,$o[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Is((t=t).field),direction:(t=t.dir,Xo[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.Ue||Vi(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=ws(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ws(e.endAt)),n}function ms(t){var e=hs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Lr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[_s(t)]:void 0!==t.fieldFilter?[(n=t,Qu.create(Es(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return kr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):kr():[];var n}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new Ea(Es((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=Vi(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=bs(n.startAt));var u=null;return n.endAt&&(u=bs(n.endAt)),Mu(xu(e,i,t,o,r,"F",s,u))}function ws(t){return{before:t.before,values:t.position}}function bs(t){var e=!!t.before,t=t.values||[];return new da(t,e)}function Is(t){return{fieldPath:t.R()}}function Es(t){return qr.S(t.fieldPath)}function _s(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Es(t.unaryFilter.field);return Qu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Es(t.unaryFilter.field);return Qu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=Es(t.unaryFilter.field);return Qu.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":t=Es(t.unaryFilter.field);return Qu.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return kr()}}function Ts(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}h=function(){this.ze=void 0};function Ns(t,e){return t instanceof Ms?Wo(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var As,Ss,Ds=(n(Rs,Ss=h),Rs),Os=(n(xs,As=h),xs);function xs(t){var e=this;return(e=As.call(this)||this).elements=t,e}function Rs(){return null!==Ss&&Ss.apply(this,arguments)||this}function ks(t,e){for(var n=qs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Co(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Ls,Ps=(n(Vs,Ls=h),Vs);function Vs(t){var e=this;return(e=Ls.call(this)||this).elements=t,e}function Cs(t,e){for(var n=qs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Co(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Us,Ms=(n(js,Us=h),js);function js(t,e){var n=this;return(n=Us.call(this)||this).serializer=t,n.We=e,n}function Fs(t){return Bo(t.integerValue||t.doubleValue)}function qs(t){return Ko(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Bs=(zs.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},zs.prototype.isEqual=function(t){return yi(this.fields,t.fields,function(t,e){return t.isEqual(e)})},zs),Gs=function(t,e){this.field=t,this.transform=e};function zs(t){(this.fields=t).sort(qr.i)}function Ws(t,e){this.version=t,this.transformResults=e}var Ks=(Hs.Ge=function(){return new Hs},Hs.exists=function(t){return new Hs(void 0,t)},Hs.updateTime=function(t){return new Hs(t)},Object.defineProperty(Hs.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Hs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Hs);function Hs(t,e){this.updateTime=t,this.exists=e}function Qs(t,e){return void 0!==t.updateTime?e instanceof _u&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof _u}Ee=function(){};function Ys(t,e,n){return t instanceof eu?new _u(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof nu?function(t,e,n){if(!Qs(t.Ke,e))return new Nu(t.key,n.version);e=ou(t,e);return new _u(t.key,n.version,e,{hasCommittedMutations:!0})}(t,e,n):t instanceof uu?function(t,e,n){if(Lr(null!=n.transformResults),!Qs(t.Ke,e))return new Nu(t.key,n.version);var r=e,e=function(t,e,n){var r=[];Lr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof _u&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof Os?ks(o,s):o instanceof Ps?Cs(o,s):u))}return r}(t.fieldTransforms,e,n.transformResults),n=n.version,e=cu(t,r.data(),e);return new _u(t.key,n,e,{hasCommittedMutations:!0})}(t,e,n):new Tu(t.key,n.version,{hasCommittedMutations:!0})}function Xs(t,e,n,r){return t instanceof eu?function(t,e){if(!Qs(t.Ke,e))return e;e=Js(e);return new _u(t.key,e,t.value,{Ye:!0})}(t,e):t instanceof nu?function(t,e){if(!Qs(t.Ke,e))return e;var n=Js(e),e=ou(t,e);return new _u(t.key,n,e,{Ye:!0})}(t,e):t instanceof uu?function(t,e,n,r){if(!Qs(t.Ke,e))return e;var i=e,r=function(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof _u&&(h=n.field(a.field)),null===h&&r instanceof _u&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,(c=c)instanceof Ds?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof Os?ks(c,i):c instanceof Ps?Cs(c,i):(c=Ns(h=c,i),i=Fs(c)+Fs(h.We),Wo(c)&&Wo(h.We)?Zo(i):ts(h.serializer,i))))}return o}(t.fieldTransforms,n,e,r),r=cu(t,i.data(),r);return new _u(t.key,i.version,r,{Ye:!0})}(t,e,r,n):(e=e,Qs((t=t).Ke,e)?new Tu(t.key,Oi.min()):e)}function $s(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||yi(t.fieldTransforms,t.fieldTransforms,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Os&&e instanceof Os||t instanceof Ps&&e instanceof Ps?yi(t.elements,e.elements,Co):t instanceof Ms&&e instanceof Ms?Co(t.We,e.We):t instanceof Ds&&e instanceof Ds)}))}function Js(t){return t instanceof _u?t.version:Oi.min()}var Zs,tu,eu=(n(iu,tu=Ee),iu),nu=(n(ru,Zs=Ee),ru);function ru(t,e,n,r){var i=this;return(i=Zs.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ke=r,i.type=1,i}function iu(t,e,n){var r=this;return(r=tu.call(this)||this).key=t,r.value=e,r.Ke=n,r.type=0,r}function ou(t,e){return n=t,e=e instanceof _u?e.data():du.empty(),r=new yu(e),n.Qe.fields.forEach(function(t){var e;t.m()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.Je();var n,r}var su,uu=(n(au,su=Ee),au);function au(t,e){var n=this;return(n=su.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ke=Ks.exists(!0),n}function cu(t,e,n){for(var r=new yu(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var hu,fu,lu=(n(wu,fu=Ee),wu),pu=(n(mu,hu=Ee),mu),du=(gu.empty=function(){return new gu({mapValue:{}})},gu.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Yo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},gu.prototype.isEqual=function(t){return Co(this.proto,t.proto)},gu),yu=(vu.prototype.set=function(t,e){return this.tn(t,e),this},vu.prototype.delete=function(t){return this.tn(t,null),this},vu.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Vo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t._(),e)},vu.prototype.Je=function(){var t=this.en(qr.g(),this.Ze);return null!=t?new du(t):this.Xe},vu.prototype.en=function(r,t){var i=this,o=!1,e=this.Xe.field(r),s=Yo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.en(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},vu);function vu(t){void 0===t&&(t=du.empty()),this.Xe=t,this.Ze=new Map}function gu(t){this.proto=t}function mu(t,e){var n=this;return(n=hu.call(this)||this).key=t,n.Ke=e,n.type=4,n}function wu(t,e){var n=this;return(n=fu.call(this)||this).key=t,n.Ke=e,n.type=3,n}var bu,Iu,Eu,Ie=function(t,e){this.key=t,this.version=e},_u=(n(Ou,Eu=Ie),Ou.prototype.field=function(t){return this.nn.field(t)},Ou.prototype.data=function(){return this.nn},Ou.prototype.sn=function(){return this.nn.proto},Ou.prototype.isEqual=function(t){return t instanceof Ou&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},Ou.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Ou.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ou),Tu=(n(Du,Iu=Ie),Du.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Du.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Du.prototype.isEqual=function(t){return t instanceof Du&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Du),Nu=(n(Su,bu=Ie),Su.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Su.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Su.prototype.isEqual=function(t){return t instanceof Su&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Su),Au=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Su(){return null!==bu&&bu.apply(this,arguments)||this}function Du(t,e,n){var r=this;return(r=Iu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Ou(t,e,n,r){var i=this;return(i=Eu.call(this,t,e)||this).nn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function xu(t,e,n,r,i,o,s,u){return new Au(t,e,n,r,i,o,s,u)}function Ru(t){return new Au(t)}function ku(t){return!Vi(t.limit)&&"F"===t.on}function Lu(t){return!Vi(t.limit)&&"L"===t.on}function Pu(t){return 0<t.rn.length?t.rn[0].field:null}function Vu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function Cu(t){return null!==t.collectionGroup}function Uu(t){var e=t;if(null===e.an){e.an=[];var n=Vu(e),t=Pu(e);if(null!==n&&null===t)n.p()||e.an.push(new Ea(n)),e.an.push(new Ea(qr.v(),"asc"));else{for(var r=!1,i=0,o=e.rn;i<o.length;i++){var s=o[i];e.an.push(s),s.field.p()&&(r=!0)}r||(n=0<e.rn.length?e.rn[e.rn.length-1].dir:"asc",e.an.push(new Ea(qr.v(),n)))}}return e.an}function Mu(t){var e=t;if(!e.cn)if("F"===e.on)e.cn=ji(e.path,e.collectionGroup,Uu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Uu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ea(o.field,s))}var u=e.endAt?new da(e.endAt.position,!e.endAt.before):null,t=e.startAt?new da(e.startAt.position,!e.startAt.before):null;e.cn=ji(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.cn}function ju(t,e,n){return new Au(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Fu(t,e){return new Au(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function qu(t,e){return new Au(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function Bu(t,e){return qi(Mu(t),Mu(e))&&t.on===e.on}function Gu(t){return Fi(Mu(t))+"|lt:"+t.on}function zu(t){return"Query(target="+(e=Mu(t),n=e.path.R(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.R()+" "+t.op+" "+Fo(t.value)}).join(", ")+"]"),Vi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.R()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+wa(e.startAt)),e.endAt&&(n+=", endAt: "+wa(e.endAt)),"Target("+n+")")+"; limitType="+t.on+")";var e,n}function Wu(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.N(e.collectionGroup)&&e.path.T(n):Br.F(e.path)?e.path.isEqual(n):e.path.I(n))&&function(t){for(var e=0,n=i.rn;e<n.length;e++){var r=n[e];if(!r.field.p()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||ba(t.startAt,Uu(t),n))&&(!t.endAt||!ba(t.endAt,Uu(t),n)));var e,n}function Ku(u){return function(t,e){for(var n=!1,r=0,i=Uu(u);r<i.length;r++){var o=i[r],s=function(t,r,e){e=t.field.p()?Br.i(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?Mo(n,t):kr()}(t.field,e);switch(t.dir){case"asc":return e;case"desc":return-1*e;default:return kr()}}(o,t,e);if(0!==s)return s;n=n||o.field.p()}return 0}}var Hu,Qu=(n(Yu,Hu=function(){}),Yu.create=function(t,e,n){if(t.p())return"in"===e||"not-in"===e?this.hn(t,e,n):new Zu(t,e,n);if(Ho(n)){if("=="!==e&&"!="!==e)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new Yu(t,e,n)}if(Qo(n)){if("=="!==e&&"!="!==e)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new Yu(t,e,n)}return"array-contains"===e?new ha(t,n):"in"===e?new fa(t,n):"not-in"===e?new la(t,n):"array-contains-any"===e?new pa(t,n):new Yu(t,e,n)},Yu.hn=function(t,e,n){return new("in"===e?ta:ea)(t,n)},Yu.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.ln(Mo(t,this.value)):null!==t&&Vo(this.value)===Vo(t)&&this.ln(Mo(t,this.value))},Yu.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return kr()}},Yu.prototype.un=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Yu);function Yu(t,e,n){var r=this;return(r=Hu.call(this)||this).field=t,r.op=e,r.value=n,r}var Xu,$u,Ju,Zu=(n(ia,Ju=Qu),ia.prototype.matches=function(t){t=Br.i(t.key,this.key);return this.ln(t)},ia),ta=(n(ra,$u=Qu),ra.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},ra),ea=(n(na,Xu=Qu),na.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},na);function na(t,e){var n=this;return(n=Xu.call(this,t,"not-in",e)||this).keys=oa(0,e),n}function ra(t,e){var n=this;return(n=$u.call(this,t,"in",e)||this).keys=oa(0,e),n}function ia(t,e,n){var r=this;return(r=Ju.call(this,t,e,n)||this).key=Br.C(n.referenceValue),r}function oa(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Br.C(t.referenceValue)})}var sa,ua,aa,ca,ha=(n(ma,ca=Qu),ma.prototype.matches=function(t){t=t.field(this.field);return Ko(t)&&Uo(t.arrayValue,this.value)},ma),fa=(n(ga,aa=Qu),ga.prototype.matches=function(t){t=t.field(this.field);return null!==t&&Uo(this.value.arrayValue,t)},ga),la=(n(va,ua=Qu),va.prototype.matches=function(t){if(Uo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!Uo(this.value.arrayValue,t)},va),pa=(n(ya,sa=Qu),ya.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!Ko(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Uo(e.value.arrayValue,t)})},ya),da=function(t,e){this.position=t,this.before=e};function ya(t,e){return sa.call(this,t,"array-contains-any",e)||this}function va(t,e){return ua.call(this,t,"not-in",e)||this}function ga(t,e){return aa.call(this,t,"in",e)||this}function ma(t,e){return ca.call(this,t,"array-contains",e)||this}function wa(t){return(t.before?"b":"a")+":"+t.position.map(Fo).join(",")}function ba(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.p()?Br.i(Br.C(s.referenceValue),n.key):Mo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ia(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Co(t.position[n],e.position[n]))return!1;return!0}var Ea=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function _a(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Ta,Na=(Pa.prototype.reset=function(){this.Tn=0},Pa.prototype.An=function(){this.Tn=this.mn},Pa.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);0<i&&Dr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,function(){return e.In=Date.now(),t()}),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},Pa.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},Pa.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},Pa.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},Pa),Aa=(La.prototype.catch=function(t){return this.next(void 0,t)},La.prototype.next=function(r,i){var o=this;return this.Sn&&kr(),this.Sn=!0,this.vn?this.error?this.Dn(i,this.error):this.Cn(r,this.result):new La(function(e,n){o.pn=function(t){o.Cn(r,t).next(e,n)},o.bn=function(t){o.Dn(i,t).next(e,n)}})},La.prototype.Nn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},La.prototype.Fn=function(t){try{var e=t();return e instanceof La?e:La.resolve(e)}catch(t){return La.reject(t)}},La.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):La.resolve(e)},La.prototype.Dn=function(t,e){return t?this.Fn(function(){return t(e)}):La.reject(e)},La.resolve=function(n){return new La(function(t,e){t(n)})},La.reject=function(n){return new La(function(t,e){e(n)})},La.$n=function(t){return new La(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},La.xn=function(t){for(var n=La.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?La.resolve(t):e()})}(r[e]);return n},La.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.$n(i)},La),Sa=(ka.delete=function(t){return Dr("SimpleDb","Removing database:",t),Fa(window.indexedDB.deleteDatabase(t)).Nn()},ka.On=function(){if("undefined"==typeof indexedDB)return!1;if(ka.Ln())return!0;var t=p(),e=ka.Mn(t),n=0<e&&e<10,e=ka.Bn(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},ka.Ln=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.qn)},ka.Un=function(t,e){return t.store(e)},ka.Mn=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},ka.Bn=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},ka.prototype.Qn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Dr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new Oa(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new Tr(_r.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Oa(o,t))},r.onupgradeneeded=function(t){Dr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.kn.createOrUpgrade(e,r.transaction,t.oldVersion,i.version).next(function(){Dr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return i.Wn(t)}),this.db)]}})})},ka.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},ka.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Qn(u)];case 2:return s.db=t.sent(),e=Ca.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),Aa.reject(t)}).Nn(),r={},n.catch(function(){}),[4,e.Kn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Dr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},ka.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},ka),Da=(Object.defineProperty(Ra.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(Ra.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(Ra.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),Ra.prototype.done=function(){this.zn=!0},Ra.prototype.Jn=function(t){this.Hn=t},Ra.prototype.delete=function(){return Fa(this.Gn.delete())},Ra),Oa=(n(xa,Ta=Tr),xa);function xa(t,e){var n=this;return(n=Ta.call(this,_r.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function Ra(t){this.Gn=t,this.zn=!1,this.Hn=null}function ka(t,e,n){this.name=t,this.version=e,this.kn=n,12.2===ka.Mn(p())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function La(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t(function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)},function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)})}function Pa(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}function Va(t){return"IndexedDbTransactionError"===t.name}var Ca=(ja.open=function(t,e,n,r){try{return new ja(e,t.transaction(r,n))}catch(t){throw new Oa(e,t)}},Object.defineProperty(ja.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),ja.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(Dr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},ja.prototype.store=function(t){t=this.transaction.objectStore(t);return new Ua(t)},ja),Ua=(Ma.prototype.put=function(t,e){t=void 0!==e?(Dr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Dr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Fa(t)},Ma.prototype.add=function(t){return Dr("SimpleDb","ADD",this.store.name,t,t),Fa(this.store.add(t))},Ma.prototype.get=function(e){var n=this;return Fa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Dr("SimpleDb","GET",n.store.name,e,t),t})},Ma.prototype.delete=function(t){return Dr("SimpleDb","DELETE",this.store.name,t),Fa(this.store.delete(t))},Ma.prototype.count=function(){return Dr("SimpleDb","COUNT",this.store.name),Fa(this.store.count())},Ma.prototype.Zn=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.ts(e,function(t,e){n.push(e)}).next(function(){return n})},Ma.prototype.es=function(t,e){Dr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.ns=!1;e=this.cursor(e);return this.ts(e,function(t,e,n){return n.delete()})},Ma.prototype.ss=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.ts(n,e)},Ma.prototype.rs=function(r){var t=this.cursor({});return new Aa(function(n,e){t.onerror=function(t){t=Ba(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Ma.prototype.ts=function(t,i){var o=[];return new Aa(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new Da(n),(t=i(n.primaryKey,n.value,e))instanceof Aa&&(t=t.catch(function(t){return e.done(),Aa.reject(t)}),o.push(t)),e.vn?r():null===e.Yn?n.continue():n.continue(e.Yn)):r()}}).next(function(){return Aa.$n(o)})},Ma.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Ma.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ma);function Ma(t){this.store=t}function ja(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.Xn=new _a,this.transaction.oncomplete=function(){n.Xn.resolve()},this.transaction.onabort=function(){t.error?n.Xn.reject(new Oa(e,t.error)):n.Xn.resolve()},this.transaction.onerror=function(t){t=Ba(t.target.error);n.Xn.reject(new Oa(e,t))}}function Fa(t){return new Aa(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Ba(t.target.error);n(t)}})}var qa=!1;function Ba(t){var e=Sa.Mn(p());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new Tr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return qa||(qa=!0,setTimeout(function(){throw n},0)),n}}return t}function Ga(){return"undefined"!=typeof window?window:null}function za(){return"undefined"!=typeof document?document:null}var Wa=(Qa.ls=function(t,e,n,r,i){i=new Qa(t,e,Date.now()+n,r,i);return i.start(n),i},Qa.prototype.start=function(t){var e=this;this._s=setTimeout(function(){return e.fs()},t)},Qa.prototype.Vn=function(){return this.fs()},Qa.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new Tr(_r.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Qa.prototype.fs=function(){var e=this;this.os.ds(function(){return null!==e._s?(e.clearTimeout(),e.op().then(function(t){return e.hs.resolve(t)})):Promise.resolve()})},Qa.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},Qa),Ka=(Object.defineProperty(Ha.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),Ha.prototype.ds=function(t){this.enqueue(t)},Ha.prototype.ps=function(t){this.bs(),this.vs(t)},Ha.prototype.Ss=function(){var t;this.Es||(this.Es=!0,(t=za())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},Ha.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise(function(t){}):this.vs(t)},Ha.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds(function(){return e.Cs()})},Ha.prototype.Cs=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Dr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.gs.Rn(function(){return n.Cs()}),t.label=5;case 5:return[2]}})})},Ha.prototype.vs=function(t){var r=this,e=this.ws.then(function(){return r.Rs=!0,t().catch(function(t){throw r.As=t,r.Rs=!1,Or("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Rs=!1,t})});return this.ws=e},Ha.prototype.gn=function(t,e,n){var r=this;this.bs(),-1<this.Ps.indexOf(t)&&(e=0);n=Wa.ls(this,t,e,n,function(t){return r.Ns(t)});return this.Is.push(n),n},Ha.prototype.bs=function(){this.As&&kr()},Ha.prototype.Fs=function(){},Ha.prototype.$s=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.ws];case 1:t.sent(),t.label=2;case 2:if(e!==this.ws)return[3,0];t.label=3;case 3:return[2]}})})},Ha.prototype.xs=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},Ha.prototype.ks=function(r){var i=this;return this.$s().then(function(){i.Is.sort(function(t,e){return t.cs-e.cs});for(var t=0,e=i.Is;t<e.length;t++){var n=e[t];if(n.Vn(),"all"!==r&&n.fn===r)break}return i.$s()})},Ha.prototype.Ms=function(t){this.Ps.push(t)},Ha.prototype.Ns=function(t){t=this.Is.indexOf(t);this.Is.splice(t,1)},Ha);function Ha(){var e=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new Na(this,"async_queue_retry"),this.ys=function(){var t=za();t&&Dr("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.gs.yn()};var t=za();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ys)}function Qa(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new _a,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch(function(t){})}function Ya(t,e){if(Or("AsyncQueue",e+": "+t),Va(t))return new Tr(_r.UNAVAILABLE,e+": "+t);throw t}function Xa(){this.Os=void 0,this.listeners=[]}function $a(){this.Ls=new Si(Gu,Bu),this.onlineState="Unknown",this.Bs=new Set}function Ja(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.Ls.get(n))||(r=!0,i=new Xa),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.qs(n)];case 2:return o.Os=t.sent(),[3,4];case 3:return o=t.sent(),o=Ya(o,"Initialization of query '"+zu(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.Ls.set(n,i),i.listeners.push(u),u.Us(e.onlineState),i.Os&&u.Qs(i.Os)&&tc(e),[2]}})})}function Za(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.Ls.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Ls.delete(n),e.Ws(n))]:[2]})})}function tc(t){t.Bs.forEach(function(t){t.next()})}var ec=(ic.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new yo(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},ic.prototype.onError=function(t){this.js.error(t)},ic.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},ic.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},ic.prototype.zs=function(t){if(0<t.docChanges.length)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},ic.prototype.Ys=function(t){t=yo.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},ic),nc=(rc.prototype.Xs=function(){return null!=this.uid},rc.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},rc.prototype.isEqual=function(t){return t.uid===this.uid},rc);function rc(t){this.uid=t}function ic(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}nc.UNAUTHENTICATED=new nc(null),nc.ti=new nc("google-credentials-uid"),nc.ei=new nc("first-party-uid");var oc=(sc.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},sc.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},sc);function sc(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}function uc(t,e){return"firestore_clients_"+t+"_"+e}function ac(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.Xs()&&(n+="_"+e.uid),n}function cc(t,e){return"firestore_targets_"+t+"_"+e}oc.oi=-1;var hc=(Pc.ai=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Tr(r.error.code,r.error.message)),i?new Pc(t,e,r.state,o):(Or("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Pc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Pc),fc=(Lc.ai=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Tr(n.error.code,n.error.message)),r?new Lc(t,n.state,i):(Or("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Lc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Lc),lc=(kc.ai=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fo,o=0;r&&o<n.activeTargetIds.length;++o)r=Ui(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new kc(t,i):(Or("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},kc),pc=(Rc.ai=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Rc(e.clientId,e.onlineState):(Or("SharedClientState","Failed to parse online state: "+t),null)},Rc),dc=(xc.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},xc.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},xc.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},xc),yc=(Oc.On=function(t){return!(!t||!t.localStorage)},Oc.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this._i.Vi()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.li&&(i=this.getItem(uc(this.persistenceKey,r)))&&(o=lc.ai(r,i))&&(this.mi=this.mi.rt(o.clientId,o));for(this.pi(),(s=this.storage.getItem(this.yi))&&(u=this.bi(s))&&this.vi(u),a=0,c=this.Ei;a<c.length;a++)h=c[a],this.wi(h);return this.Ei=[],this.window.addEventListener("unload",function(){return f.Si()}),this.Ti=!0,[2]}})})},Oc.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},Oc.prototype.Di=function(){return this.Ci(this.mi)},Oc.prototype.Ni=function(n){var r=!1;return this.mi.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Oc.prototype.Fi=function(t){this.$i(t,"pending")},Oc.prototype.xi=function(t,e,n){this.$i(t,e,n),this.ki(t)},Oc.prototype.Mi=function(t){var e,n="not-current";return this.Ni(t)&&(!(e=this.storage.getItem(cc(this.persistenceKey,t)))||(e=fc.ai(t,e))&&(n=e.state)),this.Oi.ui(t),this.pi(),n},Oc.prototype.Li=function(t){this.Oi.hi(t),this.pi()},Oc.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},Oc.prototype.qi=function(t){this.removeItem(cc(this.persistenceKey,t))},Oc.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},Oc.prototype.Wi=function(t,e,n){var r=this;e.forEach(function(t){r.ki(t)}),this.currentUser=t,n.forEach(function(t){r.Fi(t)})},Oc.prototype.ji=function(t){this.Ki(t)},Oc.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},Oc.prototype.getItem=function(t){var e=this.storage.getItem(t);return Dr("SharedClientState","READ",t,e),e},Oc.prototype.setItem=function(t,e){Dr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Oc.prototype.removeItem=function(t){Dr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Oc.prototype.wi=function(t){var e=this,s=t;if(s.storageArea===this.storage){if(Dr("SharedClientState","EVENT",s.key,s.newValue),s.key===this.Ii)return void Or("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){if(this.Ti){if(null!==s.key)if(this.Ri.test(s.key)){if(null==s.newValue)return e=this.Gi(s.key),[2,this.zi(e,null)];if(e=this.Hi(s.key,s.newValue))return[2,this.zi(e.clientId,e)]}else if(this.Pi.test(s.key)){if(null!==s.newValue&&(n=this.Yi(s.key,s.newValue)))return[2,this.Ji(n)]}else if(this.gi.test(s.key)){if(null!==s.newValue&&(r=this.Xi(s.key,s.newValue)))return[2,this.Zi(r)]}else if(s.key===this.yi){if(null!==s.newValue&&(i=this.bi(s.newValue)))return[2,this.vi(i)]}else s.key===this.Ai&&(o=function(t){var e=oc.oi;if(null!=t)try{var n=JSON.parse(t);Lr("number"==typeof n),e=n}catch(t){Or("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==oc.oi&&this.ni(o)}else this.Ei.push(s);return[2]})})})}},Object.defineProperty(Oc.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),Oc.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},Oc.prototype.$i=function(t,e,n){n=new hc(this.currentUser,t,e,n),t=ac(this.persistenceKey,this.currentUser,t);this.setItem(t,n.ci())},Oc.prototype.ki=function(t){t=ac(this.persistenceKey,this.currentUser,t);this.removeItem(t)},Oc.prototype.Ki=function(t){t={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(t))},Oc.prototype.Qi=function(t,e,n){var r=cc(this.persistenceKey,t),n=new fc(t,e,n);this.setItem(r,n.ci())},Oc.prototype.Gi=function(t){t=this.Ri.exec(t);return t?t[1]:null},Oc.prototype.Hi=function(t,e){t=this.Gi(t);return lc.ai(t,e)},Oc.prototype.Yi=function(t,e){var n=this.Pi.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return hc.ai(new nc(n),t,e)},Oc.prototype.Xi=function(t,e){t=this.gi.exec(t),t=Number(t[1]);return fc.ai(t,e)},Oc.prototype.bi=function(t){return pc.ai(t)},Oc.prototype.Ji=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this._i.tr(e.batchId,e.state,e.error)]:(Dr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Oc.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},Oc.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this._i.nr(s,u).then(function(){n.mi=r})},Oc.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},Oc.prototype.Ci=function(t){var n=fo;return t.forEach(function(t,e){n=n.xt(e.activeTargetIds)}),n},Oc),vc=(Dc.prototype.Fi=function(t){},Dc.prototype.xi=function(t,e,n){},Dc.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},Dc.prototype.Ui=function(t,e,n){this.ir[t]=e},Dc.prototype.Li=function(t){this.sr.hi(t)},Dc.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},Dc.prototype.qi=function(t){delete this.ir[t]},Dc.prototype.Di=function(){return this.sr.activeTargetIds},Dc.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},Dc.prototype.start=function(){return this.sr=new dc,Promise.resolve()},Dc.prototype.Wi=function(t,e,n){},Dc.prototype.ji=function(t){},Dc.prototype.Si=function(){},Dc.prototype.ri=function(t){},Dc),gc=(Sc.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Ys(o,e,r[i]))}return e},Sc.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Xs(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Xs(a,e,o,this.rr))}return e},Sc.prototype.hr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ur(t.key,n.get(t.key));e&&(i=i.rt(t.key,e))}),i},Sc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ho())},Sc.prototype.isEqual=function(t){return this.batchId===t.batchId&&yi(this.mutations,t.mutations,$s)&&yi(this.baseMutations,t.baseMutations,$s)},Sc),mc=(Ac.from=function(t,e,n){Lr(t.mutations.length===n.length);for(var r=ao,i=t.mutations,o=0;o<i.length;o++)r=r.rt(i[o].key,n[o].version);return new Ac(t,e,n,r)},Ac),h=(Object.defineProperty(Nc.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),Nc.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},Nc.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},Nc.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?Aa.resolve(n):this.Rr(t,e)},Nc.prototype.getEntries=function(t,e){return this.Pr(t,e)},Nc.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},Nc.prototype.Er=function(){},Nc),wc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ee=(Tc.prototype.Vr=function(t){this.yr.push(t)},Tc.prototype.pr=function(){this.yr.forEach(function(t){return t()})},Tc),bc=(_c.prototype.Dr=function(e,n){var r=this;return this.vr.Cr(e,n).next(function(t){return r.Nr(e,n,t)})},_c.prototype.Nr=function(t,r,i){return this.br.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ur(r,t);return t})},_c.prototype.Fr=function(t,e,i){var o=io;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ur(t,e);o=o.rt(t,e)}),o},_c.prototype.$r=function(e,t){var n=this;return this.br.getEntries(e,t).next(function(t){return n.kr(e,t)})},_c.prototype.kr=function(e,r){var i=this;return this.vr.Mr(e,r).next(function(t){var t=i.Fr(e,r,t),n=io;return t.forEach(function(t,e){e=e||new Tu(t,Oi.min()),n=n.rt(t,e)}),n})},_c.prototype.Or=function(t,e,n){return r=e,Br.F(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Lr(t,e.path):Cu(e)?this.Br(t,e,n):this.qr(t,e,n);var r},_c.prototype.Lr=function(t,e){return this.Dr(t,new Br(e)).next(function(t){var e=uo;return t instanceof _u&&(e=e.rt(t.key,t)),e})},_c.prototype.Br=function(n,r,i){var o=this,s=r.collectionGroup,u=uo;return this.Sr.Ur(n,s).next(function(t){return Aa.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Au(t,null,e.rn.slice(),e.filters.slice(),e.limit,e.on,e.startAt,e.endAt));return o.qr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.rt(t,e)})})}).next(function(){return u})})},_c.prototype.qr=function(e,n,t){var c,h,r=this;return this.br.Or(e,n,t).next(function(t){return c=t,r.vr.Qr(e,n)}).next(function(t){return h=t,r.Wr(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),a=Xs(s,a,a,r.rr);c=a instanceof _u?c.rt(u,a):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){Wu(n,e)||(c=c.remove(t))}),c})},_c.prototype.Wr=function(t,e,n){for(var r=ho(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof nu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof _u&&(c=c.rt(t,e))}),c})},_c),Ic=(Ec.Gr=function(t,e){for(var n=ho(),r=ho(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Ec(t,e.fromCache,n,r)},Ec);function Ec(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}function _c(t,e,n){this.br=t,this.vr=e,this.Sr=n}function Tc(){this.yr=[]}function Nc(){this.dr=new Si(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.wr=!1}function Ac(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}function Sc(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}function Dc(){this.sr=new dc,this.ir={},this.fi=null,this.ni=null}function Oc(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new Yi(di),this.Ti=!1,this.Ei=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=uc(this.persistenceKey,this.li),this.Ai="firestore_sequence_number_"+this.persistenceKey,this.mi=this.mi.rt(this.li,new dc),this.Ri=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.yi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.di)}function xc(){this.activeTargetIds=fo}function Rc(t,e){this.clientId=t,this.onlineState=e}function kc(t,e){this.clientId=t,this.activeTargetIds=e}function Lc(t,e,n){this.targetId=t,this.state=e,this.error=n}function Pc(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Vc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=di(n,t);return 0===t?di(r,e):t}var Cc=(Fc.prototype.Yr=function(){return++this.Hr},Fc.prototype.Jr=function(t){var e=[t,this.Yr()];this.buffer.size<this.zr?this.buffer=this.buffer.add(e):Vc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Fc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Fc),Uc={Xr:!1,Zr:0,eo:0,no:0},Mc=(jc.oo=function(t){return new jc(t,jc.ao,jc.co)},jc);function jc(t,e,n){this.so=t,this.io=e,this.ro=n}function Fc(t){this.zr=t,this.buffer=new no(Vc),this.Hr=0}Mc.uo=-1,Mc.ho=1048576,Mc.lo=41943040,Mc.ao=10,Mc.co=1e3,Mc._o=new Mc(Mc.lo,Mc.ao,Mc.co),Mc.fo=new Mc(Mc.uo,0,0);var qc=(zc.prototype.start=function(t){this.do.params.so!==Mc.uo&&this.To(t)},zc.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(zc.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),zc.prototype.To=function(n){var t=this,e=this.wo?3e5:6e4;Dr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.mo=this.os.gn("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.mo=null,this.wo=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eo(this.do)];case 2:return t.sent(),[3,7];case 3:return Va(e=t.sent())?(Dr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,_f(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.To(n)];case 8:return t.sent(),[2]}})})})},zc),Bc=(Gc.prototype.Ao=function(t,e){return this.Io.Ro(t).next(function(t){return Math.floor(e/100*t)})},Gc.prototype.Po=function(t,e){var n=this;if(0===e)return Aa.resolve(oc.oi);var r=new Cc(e);return this.Io.De(t,function(t){return r.Jr(t.sequenceNumber)}).next(function(){return n.Io.yo(t,function(t){return r.Jr(t)})}).next(function(){return r.maxValue})},Gc.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},Gc.prototype.po=function(t,e){return this.Io.po(t,e)},Gc.prototype.bo=function(e,n){var r=this;return this.params.so===Mc.uo?(Dr("LruGarbageCollector","Garbage collection skipped; disabled"),Aa.resolve(Uc)):this.vo(e).next(function(t){return t<r.params.so?(Dr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.so),Uc):r.So(e,n)})},Gc.prototype.vo=function(t){return this.Io.vo(t)},Gc.prototype.So=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Ao(e,this.params.io).next(function(t){return i=t>h.params.ro?(Dr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+t),h.params.ro):t,s=Date.now(),h.Po(e,i)}).next(function(t){return r=t,u=Date.now(),h.Vo(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.po(e,r)}).next(function(t){return c=Date.now(),Sr()<=l.DEBUG&&Dr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Aa.resolve({Xr:!0,Zr:i,eo:o,no:t})})},Gc);function Gc(t,e){this.Io=t,this.params=e}function zc(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}function Wc(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Kc(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return Kc(e)}function Kc(t){return t+"\x01\x01"}function Hc(t){var e=t.length;if(Lr(2<=e),2===e)return Lr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),jr.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&kr(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:kr()}o=s+2}return new jr(r)}var Qc=function(t){this.Do=t};function Yc(t,e){if(e.document)return n=t.Do,r=e.document,i=!!e.hasCommittedMutations,t=as(n,r.name),n=is(r.updateTime),r=new du({mapValue:{fields:r.fields}}),new _u(t,n,r,{hasCommittedMutations:!!i});var n,r;if(e.noDocument){var i=Br.$(e.noDocument.path),o=th(e.noDocument.readTime);return new Tu(i,o,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){o=Br.$(e.unknownDocument.path),e=th(e.unknownDocument.version);return new Nu(o,e)}return kr()}function Xc(t,e,n){var r=$c(n),n=e.key.path.h().A();if(e instanceof _u){var i={name:us(i=t.Do,(o=e).key),fields:o.sn().mapValue.fields,updateTime:ns(i,o.version.X())},o=e.hasCommittedMutations;return new Ph(null,null,i,o,r,n)}if(e instanceof Tu){var i=e.key.path.A(),o=Zc(e.version),s=e.hasCommittedMutations;return new Ph(null,new kh(i,o),null,s,r,n)}if(e instanceof Nu){s=e.key.path.A(),e=Zc(e.version);return new Ph(new Lh(s,e),null,null,!0,r,n)}return kr()}function $c(t){t=t.X();return[t.seconds,t.nanoseconds]}function Jc(t){t=new Di(t[0],t[1]);return Oi.Y(t)}function Zc(t){t=t.X();return new _h(t.seconds,t.nanoseconds)}function th(t){t=new Di(t.seconds,t.nanoseconds);return Oi.Y(t)}function eh(e,t){var n=(t.baseMutations||[]).map(function(t){return ys(e.Do,t)}),r=t.mutations.map(function(t){return ys(e.Do,t)}),i=Di.fromMillis(t.localWriteTimeMs);return new gc(t.batchId,i,n,r)}function nh(t){var e=th(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?th(t.lastLimboFreeSnapshotVersion):Oi.min(),r=void 0!==t.query.documents?(Lr(1===(r=t.query).documents.length),Mu(Ru(hs(r.documents[0])))):ms(t.query);return new Wi(r,t.targetId,0,t.lastListenSequenceNumber,e,n,gi.fromBase64String(t.resumeToken))}function rh(t,e){var n=Zc(e.et),r=Zc(e.lastLimboFreeSnapshotVersion),i=(Bi(e.target)?vs:gs)(t.Do,e.target),t=e.resumeToken.toBase64();return new Ch(e.targetId,Fi(e.target),n,t,e.sequenceNumber,r,i)}var ih=(oh.Fo=function(t,e,n,r){return Lr(""!==t.uid),new oh(t.Xs()?t.uid:"",e,n,r)},oh.prototype.$o=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ah(t).ss({index:Oh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},oh.prototype.xo=function(d,y,v,g){var m=this,w=ch(d),b=ah(d);return b.add({}).next(function(t){Lr("number"==typeof t);for(var e,n,r,i,o,s=new gc(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return ds(e.Do,t)}),o=r.mutations.map(function(t){return ds(e.Do,t)}),new Oh(n,r.batchId,r.rr.toMillis(),i,o)),a=[],c=new no(function(t,e){return di(t.R(),e.R())}),h=0,f=g;h<f.length;h++){var l=f[h],p=xh.key(m.userId,l.key.path,t),c=c.add(l.key.path.h());a.push(b.put(u)),a.push(w.put(p,xh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Sr.ko(d,t))}),d.Vr(function(){m.No[t]=s.keys()}),Aa.$n(a).next(function(){return s})})},oh.prototype.Mo=function(t,e){var n=this;return ah(t).get(e).next(function(t){return t?(Lr(t.userId===n.userId),eh(n.serializer,t)):null})},oh.prototype.Oo=function(t,e){var n=this;return this.No[e]?Aa.resolve(this.No[e]):this.Mo(t,e).next(function(t){if(t){t=t.keys();return n.No[e]=t}return null})},oh.prototype.Lo=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return ah(t).ss({index:Oh.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Lr(e.batchId>=i),o=eh(r.serializer,e)),n.done()}).next(function(){return o})},oh.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return ah(t).ss({index:Oh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},oh.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ah(t).Zn(Oh.userMutationsIndex,n).next(function(t){return t.map(function(t){return eh(e.serializer,t)})})},oh.prototype.Cr=function(o,s){var u=this,t=xh.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return ch(o).ss({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Hc(i);if(r===u.userId&&s.path.isEqual(i))return ah(o).get(t).next(function(t){if(!t)throw kr();Lr(t.userId===u.userId),a.push(eh(u.serializer,t))});n.done()}).next(function(){return a})},oh.prototype.Mr=function(e,t){var s=this,u=new no(di),n=[];return t.forEach(function(o){var t=xh.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=ch(e).ss({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Hc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),Aa.$n(n).next(function(){return s.Uo(e,u)})},oh.prototype.Qr=function(t,e){var o=this,s=e.path,u=s.length+1,e=xh.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new no(di);return ch(t).ss({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Hc(i);r===o.userId&&s.T(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Uo(t,a)})},oh.prototype.Uo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(ah(e).get(t).next(function(t){if(null===t)throw kr();Lr(t.userId===n.userId),r.push(eh(n.serializer,t))}))}),Aa.$n(i).next(function(){return r})},oh.prototype.Qo=function(e,n){var r=this;return uh(e.Wo,this.userId,n).next(function(t){return e.Vr(function(){r.jo(n.batchId)}),Aa.forEach(t,function(t){return r.Co.Ko(e,t)})})},oh.prototype.jo=function(t){delete this.No[t]},oh.prototype.Go=function(e){var i=this;return this.$o(e).next(function(t){if(!t)return Aa.resolve();var t=IDBKeyRange.lowerBound(xh.prefixForUser(i.userId)),r=[];return ch(e).ss({range:t},function(t,e,n){t[0]===i.userId?(t=Hc(t[1]),r.push(t)):n.done()}).next(function(){Lr(0===r.length)})})},oh.prototype.zo=function(t,e){return sh(t,this.userId,e)},oh.prototype.Ho=function(t){var e=this;return hh(t).get(this.userId).next(function(t){return t||new Dh(e.userId,-1,"")})},oh);function oh(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}function sh(t,o,e){var e=xh.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),u=!1;return ch(t).ss({range:e,ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function uh(t,e,n){var r=t.store(Oh.store),i=t.store(xh.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.ss({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Lr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=xh.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return Aa.$n(o).next(function(){return u})}function ah(t){return nf.Un(t,Oh.store)}function ch(t){return nf.Un(t,xh.store)}function hh(t){return nf.Un(t,Dh.store)}var fh,lh=(yh.prototype.Tr=function(t,e,n){return gh(t).put(mh(e),n)},yh.prototype.Ir=function(t,e){t=gh(t),e=mh(e);return t.delete(e)},yh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Yo(e,t)})},yh.prototype.Ar=function(t,e){var n=this;return gh(t).get(mh(e)).next(function(t){return n.Jo(t)})},yh.prototype.Xo=function(t,e){var n=this;return gh(t).get(mh(e)).next(function(t){var e=n.Jo(t);return e?{Zo:e,size:wh(t)}:null})},yh.prototype.getEntries=function(t,e){var n=this,r=io;return this.ta(t,e,function(t,e){e=n.Jo(e);r=r.rt(t,e)}).next(function(){return r})},yh.prototype.ea=function(t,e){var r=this,i=io,o=new Yi(Br.i);return this.ta(t,e,function(t,e){var n=r.Jo(e);o=n?(i=i.rt(t,n),o.rt(t,wh(e))):(i=i.rt(t,null),o.rt(t,0))}).next(function(){return{na:i,sa:o}})},yh.prototype.ta=function(t,e,i){if(e.m())return Aa.resolve();var n=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),o=e.lt(),s=o.Et();return gh(t).ss({range:n},function(t,e,n){for(var r=Br.$(t);s&&Br.i(s,r)<0;)i(s,null),s=o.Et();s&&s.isEqual(r)&&(i(s,e),s=o.It()?o.Et():null),s?n.Jn(s.path.A()):n.done()}).next(function(){for(;s;)i(s,null),s=o.It()?o.Et():null})},yh.prototype.Or=function(t,r,e){var n,i=this,o=uo,s=r.path.length+1,u={};return e.isEqual(Oi.min())?(n=r.path.A(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.A(),e=$c(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=Ph.collectionReadTimeIndex),gh(t).ss(u,function(t,e,n){t.length===s&&(e=Yc(i.serializer,e),r.path.T(e.key.path)?e instanceof _u&&Wu(r,e)&&(o=o.rt(e.key,e)):n.done())}).next(function(){return o})},yh.prototype.ia=function(t){return new ph(this,!!t&&t.ra)},yh.prototype.oa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},yh.prototype.getMetadata=function(t){return vh(t).get(Vh.key).next(function(t){return Lr(!!t),t})},yh.prototype.Yo=function(t,e){return vh(t).put(Vh.key,e)},yh.prototype.Jo=function(t){if(t){t=Yc(this.serializer,t);return t instanceof Tu&&t.version.isEqual(Oi.min())?null:t}return null},yh),ph=(n(dh,fh=h),dh.prototype.gr=function(i){var o=this,s=[],u=0,a=new no(function(t,e){return di(t.R(),e.R())});return this.dr.forEach(function(t,e){var n,r=o.ca.get(t);e?(n=Xc(o.aa.serializer,e,o.readTime),a=a.add(t.path.h()),e=wh(n),u+=e-r,s.push(o.aa.Tr(i,t,n))):(u-=r,o.ra?(r=Xc(o.aa.serializer,new Tu(t,Oi.min()),o.readTime),s.push(o.aa.Tr(i,t,r))):s.push(o.aa.Ir(i,t)))}),a.forEach(function(t){s.push(o.aa.Sr.ko(i,t))}),s.push(this.aa.updateMetadata(i,u)),Aa.$n(s)},dh.prototype.Rr=function(t,e){var n=this;return this.aa.Xo(t,e).next(function(t){return null===t?(n.ca.set(e,0),null):(n.ca.set(e,t.size),t.Zo)})},dh.prototype.Pr=function(t,e){var n=this;return this.aa.ea(t,e).next(function(t){var e=t.na;return t.sa.forEach(function(t,e){n.ca.set(t,e)}),e})},dh);function dh(t,e){var n=this;return(n=fh.call(this)||this).aa=t,n.ra=e,n.ca=new Si(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function yh(t,e){this.serializer=t,this.Sr=e}function vh(t){return nf.Un(t,Vh.store)}function gh(t){return nf.Un(t,Ph.store)}function mh(t){return t.path.A()}function wh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw kr();e=t.noDocument}return JSON.stringify(e).length}var bh=(Sh.prototype.ko=function(t,e){return this.ua.add(e),Aa.resolve()},Sh.prototype.Ur=function(t,e){return Aa.resolve(this.ua.getEntries(e))},Sh),Ih=(Ah.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new no(jr.i),t=!r.has(n);return this.index[e]=r.add(n),t},Ah.prototype.has=function(t){var e=t._(),t=t.h(),e=this.index[e];return e&&e.has(t)},Ah.prototype.getEntries=function(t){return(this.index[t]||new no(jr.i)).A()},Ah),Eh=(Nh.prototype.createOrUpgrade=function(e,n,t,r){var i=this;Lr(t<r&&0<=t&&r<=10);var o=new Ca("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Th.store),(s=e).createObjectStore(Dh.store,{keyPath:Dh.keyPath}),s.createObjectStore(Oh.store,{keyPath:Oh.keyPath,autoIncrement:!0}).createIndex(Oh.userMutationsIndex,Oh.userMutationsKeyPath,{unique:!0}),s.createObjectStore(xh.store),Fh(e),e.createObjectStore(Ph.store));var s,u=Aa.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Uh.store),s.deleteObjectStore(Ch.store),s.deleteObjectStore(Mh.store),Fh(e)),u=u.next(function(){return t=o.store(Mh.store),e=new Mh(0,0,Oi.min().X(),0),t.put(Mh.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(Oh.store).Zn().next(function(t){n.deleteObjectStore(Oh.store),n.createObjectStore(Oh.store,{keyPath:Oh.keyPath,autoIncrement:!0}).createIndex(Oh.userMutationsIndex,Oh.userMutationsKeyPath,{unique:!0});var e=r.store(Oh.store),t=t.map(function(t){return e.put(t)});return Aa.$n(t)});var n,r})),u=u.next(function(){e.createObjectStore(qh.store,{keyPath:qh.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.removeAcknowledgedMutations(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(Vh.store),i.addDocumentGlobal(o)})),t<7&&7<=r&&(u=u.next(function(){return i.ensureSequenceNumbers(o)})),t<8&&8<=r&&(u=u.next(function(){return i.createCollectionParentIndex(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Ph.store)).createIndex(Ph.readTimeIndex,Ph.readTimeIndexPath,{unique:!1}),t.createIndex(Ph.collectionReadTimeIndex,Ph.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.rewriteCanonicalIds(o)})),u},Nh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ph.store).ss(function(t,e){n+=wh(e)}).next(function(){var t=new Vh(n);return e.store(Vh.store).put(Vh.key,t)})},Nh.prototype.removeAcknowledgedMutations=function(n){var r=this,t=n.store(Dh.store),i=n.store(Oh.store);return t.Zn().next(function(t){return Aa.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.Zn(Oh.userMutationsIndex,t).next(function(t){return Aa.forEach(t,function(t){Lr(t.userId===e.userId);t=eh(r.serializer,t);return uh(n,e.userId,t).next(function(){})})})})})},Nh.prototype.ensureSequenceNumbers=function(t){var o=t.store(Uh.store),e=t.store(Ph.store);return t.store(Mh.store).get(Mh.key).next(function(r){var i=[];return e.ss(function(t,e){var n=new jr(t),t=[0,Wc(n)];i.push(o.get(t).next(function(t){return t?Aa.resolve():o.put(new Uh(0,Wc(n),r.highestListenSequenceNumber))}))}).next(function(){return Aa.$n(i)})})},Nh.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(jh.store,{keyPath:jh.keyPath});function r(t){if(i.add(t)){var e=t._(),t=t.h();return n.put({collectionId:e,parent:Wc(t)})}}var n=e.store(jh.store),i=new Ih;return e.store(Ph.store).ss({ns:!0},function(t,e){t=new jr(t);return r(t.h())}).next(function(){return e.store(xh.store).ss({ns:!0},function(t,e){t[0];var n=t[1],n=(t[2],Hc(n));return r(n.h())})})},Nh.prototype.rewriteCanonicalIds=function(t){var n=this,r=t.store(Ch.store);return r.ss(function(t,e){e=nh(e),e=rh(n.serializer,e);return r.put(e)})},Nh),_h=function(t,e){this.seconds=t,this.nanoseconds=e},Th=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Nh(t){this.serializer=t}function Ah(){this.index={}}function Sh(){this.ua=new Ih}Th.store="owner",Th.key="owner";var Dh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Dh.store="mutationQueues",Dh.keyPath="userId";var Oh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Oh.store="mutations",Oh.keyPath="batchId",Oh.userMutationsIndex="userMutationsIndex",Oh.userMutationsKeyPath=["userId","batchId"];var xh=(Rh.prefixForUser=function(t){return[t]},Rh.prefixForPath=function(t,e){return[t,Wc(e)]},Rh.key=function(t,e,n){return[t,Wc(e),n]},Rh);function Rh(){}xh.store="documentMutations",xh.PLACEHOLDER=new xh;var kh=function(t,e){this.path=t,this.readTime=e},Lh=function(t,e){this.path=t,this.version=e},Ph=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ph.store="remoteDocuments",Ph.readTimeIndex="readTimeIndex",Ph.readTimeIndexPath="readTime",Ph.collectionReadTimeIndex="collectionReadTimeIndex",Ph.collectionReadTimeIndexPath=["parentPath","readTime"];var Vh=function(t){this.byteSize=t};Vh.store="remoteDocumentGlobal",Vh.key="remoteDocumentGlobalKey";var Ch=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ch.store="targets",Ch.keyPath="targetId",Ch.queryTargetsIndexName="queryTargetsIndex",Ch.queryTargetsKeyPath=["canonicalId","targetId"];var Uh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Uh.store="targetDocuments",Uh.keyPath=["targetId","path"],Uh.documentTargetsIndex="documentTargetsIndex",Uh.documentTargetsKeyPath=["path","targetId"];var Mh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Mh.key="targetGlobalKey",Mh.store="targetGlobal";var jh=function(t,e){this.collectionId=t,this.parent=e};function Fh(t){t.createObjectStore(Uh.store,{keyPath:Uh.keyPath}).createIndex(Uh.documentTargetsIndex,Uh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ch.store,{keyPath:Ch.keyPath}).createIndex(Ch.queryTargetsIndexName,Ch.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Mh.store)}jh.store="collectionParents",jh.keyPath=["collectionId","parent"];var qh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};qh.store="clientMetadata",qh.keyPath="clientId";var Bh=i(i(i([Dh.store,Oh.store,xh.store,Ph.store,Ch.store,Th.store,Mh.store,Uh.store],[qh.store]),[Vh.store]),[jh.store]),Gh=(zh.prototype.ko=function(t,e){var n=this;if(this.ha.has(e))return Aa.resolve();var r=e._(),i=e.h();t.Vr(function(){n.ha.add(e)});i={collectionId:r,parent:Wc(i)};return Wh(t).put(i)},zh.prototype.Ur=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[vi(i),""],!1,!0);return Wh(t).Zn(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Hc(r.parent))}return o})},zh);function zh(){this.ha=new Ih}function Wh(t){return nf.Un(t,jh.store)}var Kh=(Yh.prototype.next=function(){return this.la+=2,this.la},Yh._a=function(){return new Yh(0)},Yh.fa=function(){return new Yh(-1)},Yh),Hh=(Qh.prototype.da=function(n){var r=this;return this.wa(n).next(function(t){var e=new Kh(t.highestTargetId);return t.highestTargetId=e.next(),r.ma(n,t).next(function(){return t.highestTargetId})})},Qh.prototype.Ta=function(t){return this.wa(t).next(function(t){return Oi.Y(new Di(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Qh.prototype.Ea=function(t){return this.wa(t).next(function(t){return t.highestListenSequenceNumber})},Qh.prototype.Ia=function(e,n,r){var i=this;return this.wa(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.X()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.ma(e,t)})},Qh.prototype.Aa=function(e,n){var r=this;return this.Ra(e,n).next(function(){return r.wa(e).next(function(t){return t.targetCount+=1,r.Pa(n,t),r.ma(e,t)})})},Qh.prototype.ga=function(t,e){return this.Ra(t,e)},Qh.prototype.ya=function(e,t){var n=this;return this.Va(e,t.targetId).next(function(){return Xh(e).delete(t.targetId)}).next(function(){return n.wa(e)}).next(function(t){return Lr(0<t.targetCount),--t.targetCount,n.ma(e,t)})},Qh.prototype.Vo=function(n,r,i){var o=this,s=0,u=[];return Xh(n).ss(function(t,e){e=nh(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.ya(n,e)))}).next(function(){return Aa.$n(u)}).next(function(){return s})},Qh.prototype.De=function(t,n){return Xh(t).ss(function(t,e){e=nh(e);n(e)})},Qh.prototype.wa=function(t){return $h(t).get(Mh.key).next(function(t){return Lr(null!==t),t})},Qh.prototype.ma=function(t,e){return $h(t).put(Mh.key,e)},Qh.prototype.Ra=function(t,e){return Xh(t).put(rh(this.serializer,e))},Qh.prototype.Pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Qh.prototype.pa=function(t){return this.wa(t).next(function(t){return t.targetCount})},Qh.prototype.ba=function(t,r){var e=Fi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return Xh(t).ss({range:e,index:Ch.queryTargetsIndexName},function(t,e,n){e=nh(e);qi(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Qh.prototype.va=function(n,t,r){var i=this,o=[],s=Jh(n);return t.forEach(function(t){var e=Wc(t.path);o.push(s.put(new Uh(r,e))),o.push(i.Co.Sa(n,r,t))}),Aa.$n(o)},Qh.prototype.Da=function(n,t,r){var i=this,o=Jh(n);return Aa.forEach(t,function(t){var e=Wc(t.path);return Aa.$n([o.delete([r,e]),i.Co.Ca(n,r,t)])})},Qh.prototype.Va=function(t,e){t=Jh(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},Qh.prototype.Na=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Jh(t),r=ho();return t.ss({range:e,ns:!0},function(t,e,n){t=Hc(t[1]),t=new Br(t);r=r.add(t)}).next(function(){return r})},Qh.prototype.zo=function(t,e){var e=Wc(e.path),e=IDBKeyRange.bound([e],[vi(e)],!1,!0),i=0;return Jh(t).ss({index:Uh.documentTargetsIndex,ns:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Qh.prototype.qe=function(t,e){return Xh(t).get(e).next(function(t){return t?nh(t):null})},Qh);function Qh(t,e){this.Co=t,this.serializer=e}function Yh(t){this.la=t}function Xh(t){return nf.Un(t,Ch.store)}function $h(t){return nf.Un(t,Mh.store)}function Jh(t){return nf.Un(t,Uh.store)}var Zh,tf="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ef=(n(of,Zh=Ee),of),nf=(rf.Un=function(t,e){if(t instanceof ef)return Sa.Un(t.Wo,e);throw kr()},rf.prototype.start=function(){var e=this;return this.Ga().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Tr(_r.FAILED_PRECONDITION,tf);return e.za(),e.Ha(),e.Ya(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.ja.Ea(t)})}).then(function(t){e.ka=new oc(t,e.$a)}).then(function(){e.Ma=!0}).catch(function(t){return e.Wa&&e.Wa.close(),Promise.reject(t)})},rf.prototype.Ja=function(n){var t=this;return this.Ua=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.Ti?[2,n(e)]:[2]})})},n(this.isPrimary)},rf.prototype.Xa=function(n){var t=this;this.Wa.jn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},rf.prototype.Za=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ti?[4,this.Ga()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},rf.prototype.Ga=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return uf(e).put(new qh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.tc(e).next(function(t){t||(n.isPrimary=!1,n._n.Ds(function(){return n.Ua(!1)}))})}).next(function(){return n.ec(e)}).next(function(t){return n.isPrimary&&!t?n.nc(e).next(function(){return!1}):!!t&&n.sc(e).next(function(){return!0})})}).catch(function(t){if(Va(t))return Dr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Dr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n._n.Ds(function(){return n.Ua(t)}),n.isPrimary=t})},rf.prototype.tc=function(t){var e=this;return sf(t).get(Th.key).next(function(t){return Aa.resolve(e.ic(t))})},rf.prototype.rc=function(t){return uf(t).delete(this.clientId)},rf.prototype.oc=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ac(this.qa,18e5)?[3,2]:(this.qa=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=rf.Un(t,qh.store);return r.Zn().next(function(t){var e=o.cc(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Aa.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Ka)for(n=0,r=e;n<r.length;n++)i=r[n],this.Ka.removeItem(this.uc(i.clientId));t.label=2;case 2:return[2]}})})},rf.prototype.Ya=function(){var t=this;this.Ba=this._n.gn("client_metadata_refresh",4e3,function(){return t.Ga().then(function(){return t.oc()}).then(function(){return t.Ya()})})},rf.prototype.ic=function(t){return!!t&&t.ownerId===this.clientId},rf.prototype.ec=function(e){var r=this;return this.xa?Aa.resolve(!0):sf(e).get(Th.key).next(function(t){if(null!==t&&r.ac(t.leaseTimestampMs,5e3)&&!r.hc(t.ownerId)){if(r.ic(t)&&r.networkEnabled)return!0;if(!r.ic(t)){if(!t.allowTabSynchronization)throw new Tr(_r.FAILED_PRECONDITION,tf);return!1}}return!(!r.networkEnabled||!r.inForeground)||uf(e).Zn().next(function(t){return void 0===r.cc(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Dr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},rf.prototype.Si=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Ma=!1,this.lc(),this.Ba&&(this.Ba.cancel(),this.Ba=null),this._c(),this.fc(),[4,this.Wa.runTransaction("shutdown","readwrite",[Th.store,qh.store],function(t){var e=new ef(t,oc.oi);return n.nc(e).next(function(){return n.rc(e)})})];case 1:return t.sent(),this.Wa.close(),this.dc(),[2]}})})},rf.prototype.cc=function(t,e){var n=this;return t.filter(function(t){return n.ac(t.updateTimeMs,e)&&!n.hc(t.clientId)})},rf.prototype.Vi=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return uf(t).Zn().next(function(t){return e.cc(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(rf.prototype,"Ti",{get:function(){return this.Ma},enumerable:!1,configurable:!0}),rf.prototype.wc=function(t){return ih.Fo(t,this.serializer,this.Sr,this.Co)},rf.prototype.mc=function(){return this.ja},rf.prototype.Tc=function(){return this.br},rf.prototype.Ec=function(){return this.Sr},rf.prototype.runTransaction=function(e,n,r){var i=this;Dr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Wa.runTransaction(e,t,Bh,function(t){return o=new ef(t,i.ka?i.ka.next():oc.oi),"readwrite-primary"===n?i.tc(o).next(function(t){return!!t||i.ec(o)}).next(function(t){if(!t)throw Or("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i._n.Ds(function(){return i.Ua(!1)}),new Tr(_r.FAILED_PRECONDITION,wc);return r(o)}).next(function(t){return i.sc(o).next(function(){return t})}):i.Ic(o).next(function(){return r(o)})}).then(function(t){return o.pr(),t})},rf.prototype.Ic=function(t){var e=this;return sf(t).get(Th.key).next(function(t){if(null!==t&&e.ac(t.leaseTimestampMs,5e3)&&!e.hc(t.ownerId)&&!e.ic(t)&&!(e.xa||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Tr(_r.FAILED_PRECONDITION,tf)})},rf.prototype.sc=function(t){var e=new Th(this.clientId,this.allowTabSynchronization,Date.now());return sf(t).put(Th.key,e)},rf.On=function(){return Sa.On()},rf.prototype.nc=function(t){var e=this,n=sf(t);return n.get(Th.key).next(function(t){return e.ic(t)?(Dr("IndexedDbPersistence","Releasing primary lease."),n.delete(Th.key)):Aa.resolve()})},rf.prototype.ac=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Or("Detected an update time that is in the future: "+t+" > "+n),1))},rf.prototype.za=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.La=function(){t._n.ds(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ga()})},this.document.addEventListener("visibilitychange",this.La),this.inForeground="visible"===this.document.visibilityState)},rf.prototype._c=function(){this.La&&(this.document.removeEventListener("visibilitychange",this.La),this.La=null)},rf.prototype.Ha=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Oa=function(){e.lc(),e._n.ds(function(){return e.Si()})},this.window.addEventListener("unload",this.Oa))},rf.prototype.fc=function(){this.Oa&&(this.window.removeEventListener("unload",this.Oa),this.Oa=null)},rf.prototype.hc=function(t){try{var e=null!==(null===(e=this.Ka)||void 0===e?void 0:e.getItem(this.uc(t)));return Dr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Or("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},rf.prototype.lc=function(){if(this.Ka)try{this.Ka.setItem(this.uc(this.clientId),String(Date.now()))}catch(t){Or("Failed to set zombie client id.",t)}},rf.prototype.dc=function(){if(this.Ka)try{this.Ka.removeItem(this.uc(this.clientId))}catch(t){}},rf.prototype.uc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},rf);function rf(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this._n=i,this.window=o,this.document=s,this.$a=a,this.xa=c,this.ka=null,this.Ma=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oa=null,this.inForeground=!1,this.La=null,this.Ba=null,this.qa=Number.NEGATIVE_INFINITY,this.Ua=function(t){return Promise.resolve()},!rf.On())throw new Tr(_r.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new af(this,r),this.Qa=e+"main",this.serializer=new Qc(u),this.Wa=new Sa(this.Qa,10,new Eh(this.serializer)),this.ja=new Hh(this.Co,this.serializer),this.Sr=new Gh,this.br=(e=this.serializer,u=this.Sr,new lh(e,u)),this.window&&this.window.localStorage?this.Ka=this.window.localStorage:(this.Ka=null,!1===c&&Or("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function of(t,e){var n=this;return(n=Zh.call(this)||this).Wo=t,n.Fa=e,n}function sf(t){return nf.Un(t,Th.store)}function uf(t){return nf.Un(t,qh.store)}var af=(cf.prototype.Ro=function(t){var n=this.Ac(t);return this.db.mc().pa(t).next(function(e){return n.next(function(t){return e+t})})},cf.prototype.Ac=function(t){var e=0;return this.yo(t,function(t){e++}).next(function(){return e})},cf.prototype.De=function(t,e){return this.db.mc().De(t,e)},cf.prototype.yo=function(t,n){return this.Rc(t,function(t,e){return n(e)})},cf.prototype.Sa=function(t,e,n){return hf(t,n)},cf.prototype.Ca=function(t,e,n){return hf(t,n)},cf.prototype.Vo=function(t,e,n){return this.db.mc().Vo(t,e,n)},cf.prototype.Ko=hf,cf.prototype.Pc=function(t,e){return r=e,i=!1,hh(n=t).rs(function(t){return sh(n,t,r).next(function(t){return t&&(i=!0),Aa.resolve(!t)})}).next(function(){return i});var n,r,i},cf.prototype.po=function(n,r){var i=this,o=this.db.Tc().ia(),s=[],u=0;return this.Rc(n,function(e,t){t<=r&&(t=i.Pc(n,e).next(function(t){if(!t)return u++,o.Ar(n,e).next(function(){return o.Ir(e),Jh(n).delete([0,Wc(e.path)])})}),s.push(t))}).next(function(){return Aa.$n(s)}).next(function(){return o.apply(n)}).next(function(){return u})},cf.prototype.removeTarget=function(t,e){e=e.nt(t.Fa);return this.db.mc().ga(t,e)},cf.prototype.gc=hf,cf.prototype.Rc=function(t,r){var i,t=Jh(t),o=oc.oi;return t.ss({index:Uh.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==oc.oi&&r(new Br(Hc(i)),o),o=e,i=t):o=oc.oi}).next(function(){o!==oc.oi&&r(new Br(Hc(i)),o)})},cf.prototype.vo=function(t){return this.db.Tc().oa(t)},cf);function cf(t,e){this.db=t,this.do=new Bc(this,e)}function hf(t,e){return Jh(t).put((t=t.Fa,new Uh(0,Wc(e.path),t)))}function ff(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var lf=(pf.prototype.Eo=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.bo(t,n.Vc)})},pf);function pf(t,e,n){this.persistence=t,this.yc=e,this.Vc=new Yi(di),this.bc=new Si(Fi,qi),this.vc=Oi.min(),this.vr=t.wc(n),this.Sc=t.Tc(),this.ja=t.mc(),this.Dc=new bc(this.Sc,this.vr,this.persistence.Ec()),this.yc.Cc(this.Dc)}function df(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,u,a=h.batch.keys(),c=f.Sc.ia({ra:!0});return e=f,r=t,o=c,s=(i=h).batch,n=s.keys(),u=Aa.resolve(),n.forEach(function(n){u=u.next(function(){return o.Ar(r,n)}).next(function(t){var e=t,t=i._r.get(n);Lr(null!==t),(!e||e.version.L(t)<0)&&(e=s.ar(n,e,i))&&o.Tr(e,i.lr)})}),u.next(function(){return e.vr.Qo(r,s)}).next(function(){return c.apply(t)}).next(function(){return f.vr.Go(t)}).next(function(){return f.Dc.$r(t,a)})})}function yf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.ja.Ta(t)})}function vf(t,a){var c=t,h=a.et,f=c.Vc;return c.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var i=c.Sc.ia({ra:!0});f=c.Vc;var u=[];a.Gt.forEach(function(t,e){var n,r,i,o=f.get(e);o&&(u.push(c.ja.Da(s,t.ne,e).next(function(){return c.ja.va(s,t.te,e)})),0<(i=t.resumeToken).O()&&(n=o.st(i,h).nt(s.Fa),f=f.rt(e,n),r=o,i=t,Lr(0<(o=n).resumeToken.O()),(0===r.resumeToken.O()||3e8<=o.et.J()-r.et.J()||0<i.te.size+i.ee.size+i.ne.size)&&u.push(c.ja.ga(s,n))))});var t,o=io,n=ho();return a.Ht.forEach(function(t,e){n=n.add(t)}),u.push(i.getEntries(s,n).next(function(r){a.Ht.forEach(function(t,e){var n=r.get(t);e instanceof Tu&&e.version.isEqual(Oi.min())?(i.Ir(t,h),o=o.rt(t,e)):null==n||0<e.version.L(n.version)||0===e.version.L(n.version)&&n.hasPendingWrites?(i.Tr(e,h),o=o.rt(t,e)):Dr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Yt.has(t)&&u.push(c.persistence.Co.gc(s,t))})})),h.isEqual(Oi.min())||(t=c.ja.Ta(s).next(function(t){return c.ja.Ia(s,s.Fa,h)}),u.push(t)),Aa.$n(u).next(function(){return i.apply(s)}).next(function(){return c.Dc.kr(s,o)})}).then(function(t){return c.Vc=f,t})}function gf(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.ja.ba(e,r).next(function(t){return t?(n=t,Aa.resolve(n)):i.ja.da(e).next(function(t){return n=new Wi(r,t,0,e.Fa),i.ja.Aa(e,n).next(function(){return n})})})}).then(function(t){var e=i.Vc.get(t.targetId);return(null===e||0<t.et.L(e.et))&&(i.Vc=i.Vc.rt(t.targetId,t),i.bc.set(r,t.targetId)),t})}function mf(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).Vc.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Co.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Va(r=t.sent()))throw r;return Dr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Vc=e.Vc.remove(o),e.bc.delete(n.target),[2]}})})}function wf(t,o,s){var u=t,a=Oi.min(),c=ho();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=Mu(o),(void 0!==(t=(i=t).bc.get(r))?Aa.resolve(i.Vc.get(t)):i.ja.ba(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.ja.Na(e,t.targetId).next(function(t){c=t})}).next(function(){return u.yc.Or(e,o,s?a:Oi.min(),s?c:ho())}).next(function(t){return{documents:t,Nc:c}});var t,n,r,i})}function bf(t,e){var n=t,r=n.ja,t=n.Vc.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.qe(t,e).next(function(t){return t?t.target:null})})}function If(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Sc,n=t,t=s.vc,r=e,i=io,o=$c(t),t=gh(n),n=IDBKeyRange.lowerBound(o,!0),t.ss({index:Ph.readTimeIndex,range:n},function(t,e){var n=Yc(r.serializer,e);i=i.rt(n.key,n),o=e.readTime}).next(function(){return{Fc:i,readTime:Jc(o)}});var e,n,r,i,o}).then(function(t){var e=t.Fc,t=t.readTime;return s.vc=t,e})}function Ef(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=gh(t),r=Oi.min(),t.ss({index:Ph.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Jc(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.vc=t})]})})}function _f(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==_r.FAILED_PRECONDITION||e.message!==wc)throw e;return Dr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Tf(t,e){this.user=e,this.type="OAuth",this.jc={},this.jc.Authorization="Bearer "+t}function Nf(t,e,n,r,i){var o=this;this.Wu=t,this.ju=e,this.os=n,this.Ku={},this.Gu=[],this.zu=new Map,this.Hu=new Set,this.Yu=[],this.Ju=i,this.Ju.Xu(function(t){n.ds(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return ol(this)?(Dr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Hu.add(4),[4,$f(e)];case 1:return t.sent(),e.Zu.set("Unknown"),e.Hu.delete(4),[4,Xf(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Zu=new Mf(n,r)}var Af,Sf,Df,Of=(Yf.prototype.m=function(){return this.$c.m()},Yf.prototype.Sa=function(t,e){e=new xf(t,e);this.$c=this.$c.add(e),this.kc=this.kc.add(e)},Yf.prototype.Oc=function(t,e){var n=this;t.forEach(function(t){return n.Sa(t,e)})},Yf.prototype.Ca=function(t,e){this.Lc(new xf(t,e))},Yf.prototype.Bc=function(t,e){var n=this;t.forEach(function(t){return n.Ca(t,e)})},Yf.prototype.qc=function(t){var e=this,n=new Br(new jr([])),r=new xf(n,t),t=new xf(n,t+1),i=[];return this.kc.Nt([r,t],function(t){e.Lc(t),i.push(t.key)}),i},Yf.prototype.Uc=function(){var e=this;this.$c.forEach(function(t){return e.Lc(t)})},Yf.prototype.Lc=function(t){this.$c=this.$c.delete(t),this.kc=this.kc.delete(t)},Yf.prototype.Qc=function(t){var e=new Br(new jr([])),n=new xf(e,t),t=new xf(e,t+1),r=ho();return this.kc.Nt([n,t],function(t){r=r.add(t.key)}),r},Yf.prototype.zo=function(t){var e=new xf(t,0),e=this.$c.$t(e);return null!==e&&t.isEqual(e.key)},Yf),xf=(Qf.xc=function(t,e){return Br.i(t.key,e.key)||di(t.Wc,e.Wc)},Qf.Mc=function(t,e){return di(t.Wc,e.Wc)||Br.i(t.key,e.key)},Qf),Rf=(Hf.prototype.getToken=function(){return Promise.resolve(null)},Hf.prototype.Gc=function(){},Hf.prototype.zc=function(t){(this.Kc=t)(nc.UNAUTHENTICATED)},Hf.prototype.Hc=function(){this.Kc=null},Hf),kf=(Kf.prototype.getToken=function(){var e=this,n=this.Xc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.Xc!==n?(Dr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Lr("string"==typeof t.accessToken),new Tf(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Kf.prototype.Gc=function(){this.forceRefresh=!0},Kf.prototype.zc=function(t){this.Kc=t,this.Jc&&t(this.currentUser)},Kf.prototype.Hc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Yc),this.Yc=null,this.Kc=null},Kf.prototype.Zc=function(){var t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new nc(t)},Kf),Lf=(Object.defineProperty(Wf.prototype,"jc",{get:function(){var t={"X-Goog-AuthUser":this.eu},e=this.tu.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Wf),Pf=(zf.prototype.getToken=function(){return Promise.resolve(new Lf(this.tu,this.eu))},zf.prototype.zc=function(t){t(nc.ei)},zf.prototype.Hc=function(){},zf.prototype.Gc=function(){},zf),Ie=(Gf.prototype.au=function(){return 1===this.state||2===this.state||4===this.state},Gf.prototype.cu=function(){return 2===this.state},Gf.prototype.start=function(){3!==this.state?this.auth():this.uu()},Gf.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.au()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gf.prototype.hu=function(){this.state=0,this.gs.reset()},Gf.prototype.lu=function(){var t=this;this.cu()&&null===this.ou&&(this.ou=this._n.gn(this.nu,6e4,function(){return t._u()}))},Gf.prototype.fu=function(t){this.du(),this.stream.send(t)},Gf.prototype._u=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.cu()?[2,this.close(0)]:[2]})})},Gf.prototype.du=function(){this.ou&&(this.ou.cancel(),this.ou=null)},Gf.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.du(),this.gs.cancel(),this.ru++,3!==e?this.gs.reset():n&&n.code===_r.RESOURCE_EXHAUSTED?(Or(n.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):n&&n.code===_r.UNAUTHENTICATED&&this.iu.Gc(),null!==this.stream&&(this.wu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.mu(n)];case 1:return t.sent(),[2]}})})},Gf.prototype.wu=function(){},Gf.prototype.auth=function(){var n=this;this.state=1;var t=this.Tu(this.ru),e=this.ru;this.iu.getToken().then(function(t){n.ru===e&&n.Eu(t)},function(e){t(function(){var t=new Tr(_r.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Iu(t)})})},Gf.prototype.Eu=function(t){var e=this,n=this.Tu(this.ru);this.stream=this.Au(t),this.stream.Ru(function(){n(function(){return e.state=2,e.listener.Ru()})}),this.stream.mu(function(t){n(function(){return e.Iu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Gf.prototype.uu=function(){var t=this;this.state=4,this.gs.Rn(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Gf.prototype.Iu=function(t){return Dr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Gf.prototype.Tu=function(e){var n=this;return function(t){n._n.ds(function(){return n.ru===e?t():(Dr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Gf),Vf=(n(Bf,Df=Ie),Bf.prototype.Au=function(t){return this.su.Pu("Listen",t)},Bf.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:kr(),r=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.Ue?(Lr(void 0===o||"string"==typeof o),gi.fromBase64String(o||"")):(Lr(void 0===o||o instanceof Uint8Array),gi.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,s=o&&(o=void 0===(s=o).code?_r.UNKNOWN:Qi(s.code),new Tr(o,s.message||"")),r=new bo(n,r,i,s||null)}else if("documentChange"in e){e.documentChange;var u=e.documentChange;u.document,u.document.name,u.document.updateTime;var i=as(t,u.document.name),a=is(u.document.updateTime),s=new du({mapValue:{fields:u.document.fields}}),a=new _u(i,a,s,{}),s=u.targetIds||[],u=u.removedTargetIds||[];r=new mo(s,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;u=e.documentDelete;u.document;var a=as(t,u.document),c=u.readTime?is(u.readTime):Oi.min(),c=new Tu(a,c),u=u.removedTargetIds||[];r=new mo([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;c=e.documentRemove;c.document;var h=as(t,c.document),c=c.removedTargetIds||[];r=new mo([],c,h,null)}else{if(!("filter"in e))return kr();e.filter;h=e.filter;h.targetId;e=h.count||0,e=new Gi(e),h=h.targetId;r=new wo(h,e)}return r}(this.serializer,t),t=function(t){if(!("targetChange"in t))return Oi.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?is(t.readTime):Oi.min()}(t);return this.listener.gu(e,t)},Bf.prototype.yu=function(t){var e,n,r,i={};i.database=fs(this.serializer),i.addTarget=(e=this.serializer,(r=Bi(r=(n=t).target)?{documents:vs(e,r)}:{query:gs(e,r)}).targetId=n.targetId,0<n.resumeToken.O()&&(r.resumeToken=rs(e,n.resumeToken)),r);var o,t=(this.serializer,o=t,null==(t=function(){switch(o.tt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return kr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.fu(i)},Bf.prototype.Vu=function(t){var e={};e.database=fs(this.serializer),e.removeTarget=t,this.fu(e)},Bf),Cf=(n(qf,Sf=Ie),Object.defineProperty(qf.prototype,"bu",{get:function(){return this.pu},enumerable:!1,configurable:!0}),qf.prototype.start=function(){this.pu=!1,this.lastStreamToken=void 0,Sf.prototype.start.call(this)},qf.prototype.wu=function(){this.pu&&this.vu([])},qf.prototype.Au=function(t){return this.su.Pu("Write",t)},qf.prototype.onMessage=function(t){if(Lr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.pu){this.gs.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Lr(void 0!==r),n.map(function(t){return function(t,e){var n=t.updateTime?is(t.updateTime):is(e);n.isEqual(Oi.min())&&(n=is(e));e=null;return t.transformResults&&0<t.transformResults.length&&(e=t.transformResults),new Ws(n,e)}(t,r)})):[]),n=is(t.commitTime);return this.listener.Su(n,e)}var n,r;return Lr(!t.writeResults||0===t.writeResults.length),this.pu=!0,this.listener.Du()},qf.prototype.Cu=function(){var t={};t.database=fs(this.serializer),this.fu(t)},qf.prototype.vu=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return ds(e.serializer,t)})};this.fu(t)},qf),Uf=(n(Ff,Af=function(){}),Ff.prototype.Fu=function(){if(this.Nu)throw new Tr(_r.FAILED_PRECONDITION,"The client has already been terminated.")},Ff.prototype.$u=function(e,n,r){var i=this;return this.Fu(),this.credentials.getToken().then(function(t){return i.su.$u(e,n,r,t)}).catch(function(t){throw t.code===_r.UNAUTHENTICATED&&i.credentials.Gc(),t})},Ff.prototype.xu=function(e,n,r){var i=this;return this.Fu(),this.credentials.getToken().then(function(t){return i.su.xu(e,n,r,t)}).catch(function(t){throw t.code===_r.UNAUTHENTICATED&&i.credentials.Gc(),t})},Ff.prototype.terminate=function(){this.Nu=!1},Ff),Mf=(jf.prototype.Lu=function(){var t=this;0===this.ku&&(this.Bu("Unknown"),this.Mu=this.os.gn("online_state_timeout",1e4,function(){return t.Mu=null,t.qu("Backend didn't respond within 10 seconds."),t.Bu("Offline"),Promise.resolve()}))},jf.prototype.Uu=function(t){"Online"===this.state?this.Bu("Unknown"):(this.ku++,1<=this.ku&&(this.Qu(),this.qu("Connection failed 1 times. Most recent error: "+t.toString()),this.Bu("Offline")))},jf.prototype.set=function(t){this.Qu(),this.ku=0,"Online"===t&&(this.Ou=!1),this.Bu(t)},jf.prototype.Bu=function(t){t!==this.state&&(this.state=t,this.fi(t))},jf.prototype.qu=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ou?(Or(t),this.Ou=!1):Dr("OnlineStateTracker",t)},jf.prototype.Qu=function(){null!==this.Mu&&(this.Mu.cancel(),this.Mu=null)},jf);function jf(t,e){this.os=t,this.fi=e,this.state="Unknown",this.ku=0,this.Mu=null,this.Ou=!0}function Ff(t,e,n){var r=this;return(r=Af.call(this)||this).credentials=t,r.su=e,r.serializer=n,r.Nu=!1,r}function qf(t,e,n,r,i){var o=this;return(o=Sf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.pu=!1,o}function Bf(t,e,n,r,i){var o=this;return(o=Df.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Gf(t,e,n,r,i,o){this._n=t,this.nu=n,this.su=r,this.iu=i,this.listener=o,this.state=0,this.ru=0,this.ou=null,this.stream=null,this.gs=new Na(t,e)}function zf(t,e){this.tu=t,this.eu=e}function Wf(t,e){this.tu=t,this.eu=e,this.type="FirstParty",this.user=nc.ei}function Kf(t){var e=this;this.Yc=null,this.currentUser=nc.UNAUTHENTICATED,this.Jc=!1,this.Xc=0,this.Kc=null,this.forceRefresh=!1,this.Yc=function(){e.Xc++,e.currentUser=e.Zc(),e.Jc=!0,e.Kc&&e.Kc(e.currentUser)},this.Xc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Yc):(this.Yc(null),t.get().then(function(t){e.auth=t,e.Yc&&e.auth.addAuthTokenListener(e.Yc)},function(){}))}function Hf(){this.Kc=null}function Qf(t,e){this.key=t,this.Wc=e}function Yf(){this.$c=new no(xf.xc),this.kc=new no(xf.Mc)}function Xf(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!ol(r))return[3,4];e=0,n=r.Yu,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function $f(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.Yu,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Jf(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Dr("RemoteStore","RemoteStore shutting down."),e.Hu.add(5),[4,$f(e)];case 1:return t.sent(),e.Ju.Si(),e.Zu.set("Unknown"),[2]}})})}function Zf(t,e){t.zu.has(e.targetId)||(t.zu.set(e.targetId,e),il(t)?rl(t):dl(t).cu()&&el(t,e))}function tl(t,e){var n=t,t=dl(n);n.zu.delete(e),t.cu()&&nl(n,e),0===n.zu.size&&(t.cu()?t.lu():ol(n)&&n.Zu.set("Unknown"))}function el(t,e){t.th.Ee(e.targetId),dl(t).yu(e)}function nl(t,e){t.th.Ee(e),dl(t).Vu(e)}function rl(e){e.th=new Eo({Be:function(t){return e.Ku.Be(t)},qe:function(t){return e.zu.get(t)||null}}),dl(e).start(),e.Zu.Lu()}function il(t){return ol(t)&&!dl(t).au()&&0<t.zu.size}function ol(t){return 0===t.Hu.size}function sl(t){t.th=void 0}function ul(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Zu.set("Online"),!(u instanceof bo&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.zu.has(i)?[4,o.Ku.eh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.zu.delete(i),o.th.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Dr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,al(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof mo?s.th.pe(u):u instanceof wo?s.th.$e(u):s.th.Se(u),a.isEqual(Oi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,yf(s.Wu)];case 8:return o=t.sent(),0<=a.L(o)?[4,(i=a,(e=(r=s).th.Me(i)).Gt.forEach(function(t,e){var n;0<t.resumeToken.O()&&((n=r.zu.get(e))&&r.zu.set(e,n.st(t.resumeToken,i)))}),e.zt.forEach(function(t){var e=r.zu.get(t);e&&(r.zu.set(t,e.st(gi.B,e.et)),nl(r,t),e=new Wi(e.target,t,1,e.sequenceNumber),el(r,e))}),r.Ku.nh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Dr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,al(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function al(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Va(r))throw r;return n.Hu.add(1),[4,$f(n)];case 1:return t.sent(),n.Zu.set("Offline"),i=i||function(){return yf(n.Wu)},n.os.Ds(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Dr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Hu.delete(1),[4,Xf(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function cl(e,n){return n().catch(function(t){return al(e,t,n)})}function hl(a){return y(this,void 0,void 0,function(){var i,o,s,u;return v(this,function(t){switch(t.label){case 0:o=yl(i=a),s=0<i.Gu.length?i.Gu[i.Gu.length-1].batchId:-1,t.label=1;case 1:if(!(ol(i)&&i.Gu.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.Wu,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.vr.Lo(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Gu.length&&o.lu(),[3,7]):(s=u.batchId,function(t,e){t.Gu.push(e);t=yl(t);t.cu()&&t.bu&&t.vu(e.mutations)}(i,u),[3,6]);case 4:return u=t.sent(),[4,al(i,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return fl(i)&&ll(i),[2]}var e,n,r})})}function fl(t){return ol(t)&&!yl(t).au()&&0<t.Gu.length}function ll(t){yl(t).start()}function pl(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Hu.delete(2),[4,Xf(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Hu.add(2),[4,$f(e)]);case 3:t.sent(),e.Zu.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function dl(n){var t,e,r,i=this;return n.rh||(n.rh=(t=n.ju,e=n.os,r={Ru:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.zu.forEach(function(t,e){el(n,t)}),[2]})})}.bind(null,n),mu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return sl(e),il(e)?(e.Zu.Uu(n),rl(e)):e.Zu.set("Unknown"),[2]})})}.bind(null,n),gu:ul.bind(null,n)},t.Fu(),new Vf(e,t.su,t.credentials,t.serializer,r)),n.Yu.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.rh.hu(),il(n)?rl(n):n.Zu.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.rh.stop()];case 2:t.sent(),sl(n),t.label=3;case 3:return[2]}})})})),n.rh}function yl(n){var t,e,r,i=this;return n.oh||(n.oh=(t=n.ju,e=n.os,r={Ru:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return yl(e).Cu(),[2]})})}.bind(null,n),mu:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&yl(e).bu?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return Hi(n=i.code)&&n!==_r.ABORTED?(e=r.Gu.shift(),yl(r).hu(),[4,cl(r,function(){return r.Ku.ih(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,hl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return fl(e)&&ll(e),[2]}})})}.bind(null,n),Du:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=yl(o),n=0,r=o.Gu;n<r.length;n++)i=r[n],e.vu(i.mutations);return[2]})})}.bind(null,n),Su:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Gu.shift(),n=mc.from(e,i,o),[4,cl(r,function(){return r.Ku.sh(n)})];case 1:return t.sent(),[4,hl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Fu(),new Cf(e,t.su,t.credentials,t.serializer,r)),n.Yu.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.oh.hu(),[4,hl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.oh.stop()];case 3:t.sent(),0<n.Gu.length&&(Dr("RemoteStore","Stopping write stream with "+n.Gu.length+" pending writes"),n.Gu=[]),t.label=4;case 4:return[2]}})})})),n.oh}var vl=function(t){this.key=t},gl=function(t){this.key=t},ml=(Object.defineProperty(_l.prototype,"fh",{get:function(){return this.ah},enumerable:!1,configurable:!0}),_l.prototype.dh=function(t,e){var s=this,u=e?e.wh:new po,a=(e||this)._h,c=(e||this).Qt,h=a,f=!1,l=ku(this.query)&&a.size===this.query.limit?a.last():null,p=Lu(this.query)&&a.size===this.query.limit?a.first():null;if(t.ut(function(t,e){var n=a.get(t),r=(r=e instanceof _u?e:null)&&(Wu(s.query,r)?r:null),i=!!n&&s.Qt.has(n.key),o=!!r&&(r.Ye||s.Qt.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.mh(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s.lh(r,l)||p&&s.lh(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),ku(this.query)||Lu(this.query))for(;h.size>this.query.limit;){var n=ku(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{_h:h,wh:u,Th:f,Qt:c}},_l.prototype.mh=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},_l.prototype.gr=function(t,e,n){var o=this,r=this._h;this._h=t._h,this.Qt=t.Qt;var i=t.wh.qt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lh(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return kr()}}var r,i}),this.Eh(n);var s=e?this.Ih():[],n=0===this.hh.size&&this.Zt?1:0,e=n!==this.uh;return this.uh=n,0!==i.length||e?{snapshot:new yo(this.query,t._h,r,i,t.Qt,0==n,e,!1),Ah:s}:{Ah:s}},_l.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({_h:this._h,wh:new po,Qt:this.Qt,Th:!1},!1)):{Ah:[]}},_l.prototype.Rh=function(t){return!this.ah.has(t)&&!!this._h.has(t)&&!this._h.get(t).Ye},_l.prototype.Eh=function(t){var e=this;t&&(t.te.forEach(function(t){return e.ah=e.ah.add(t)}),t.ee.forEach(function(t){}),t.ne.forEach(function(t){return e.ah=e.ah.delete(t)}),this.Zt=t.Zt)},_l.prototype.Ih=function(){var e=this;if(!this.Zt)return[];var n=this.hh;this.hh=ho(),this._h.forEach(function(t){e.Rh(t.key)&&(e.hh=e.hh.add(t.key))});var r=[];return n.forEach(function(t){e.hh.has(t)||r.push(new gl(t))}),this.hh.forEach(function(t){n.has(t)||r.push(new vl(t))}),r},_l.prototype.Ph=function(t){this.ah=t.Nc,this.hh=ho();t=this.dh(t.documents);return this.gr(t,!0)},_l.prototype.gh=function(){return yo.Kt(this.query,this._h,this.Qt,0===this.uh)},_l),wl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},bl=function(t){this.key=t,this.yh=!1},Il=(Object.defineProperty(El.prototype,"qh",{get:function(){return!0===this.Bh},enumerable:!1,configurable:!0}),El);function El(t,e,n,r,i,o){this.Wu=t,this.Vh=e,this.ph=n,this.bh=r,this.currentUser=i,this.Sh=o,this.Dh={},this.Ch=new Si(Gu,Bu),this.Nh=new Map,this.Fh=[],this.$h=new Yi(Br.i),this.xh=new Map,this.kh=new Of,this.Mh={},this.Oh=new Map,this.Lh=Kh.fa(),this.onlineState="Unknown",this.Bh=void 0}function _l(t,e){this.query=t,this.ah=e,this.uh=null,this.Zt=!1,this.hh=ho(),this.Qt=ho(),this.lh=Ku(t),this._h=new lo(this.lh)}function Tl(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Uh=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.dh(o)).Th?[4,wf(r.Wu,i.query,!1).then(function(t){t=t.documents;return i.view.dh(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.Gt.get(i.targetId),n=i.view.gr(e,r.qh,n),[2,(kl(r,i.targetId,n.Ah),n.snapshot)]}})})}(i,t,e,n)},[4,wf(i.Wu,o,!0)];case 1:return n=t.sent(),r=new ml(o,n.Nc),e=r.dh(n.documents),n=go.Xt(s,u&&"Offline"!==i.onlineState),n=r.gr(e,i.qh,n),kl(i,s,n.Ah),r=new wl(o,s,r),[2,(i.Ch.set(o,r),i.Nh.has(s)?i.Nh.get(s).push(o):i.Nh.set(s,[o]),n.snapshot)]}})})}function Nl(r,i){return y(this,void 0,void 0,function(){var n,e;return v(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,vf(n.Wu,i)];case 2:return e=t.sent(),i.Gt.forEach(function(t,e){e=n.xh.get(e);e&&(Lr(t.te.size+t.ee.size+t.ne.size<=1),0<t.te.size?e.yh=!0:0<t.ee.size?Lr(e.yh):0<t.ne.size&&(Lr(e.yh),e.yh=!1))}),[4,Pl(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,_f(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Al(t,n,e){var r,t=t;(t.qh&&0===e||!t.qh&&1===e)&&(r=[],t.Ch.forEach(function(t,e){e=e.view.Us(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.Ls.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Us(i)&&(o=!0)}),o&&tc(t)}(t.ph,n),r.length&&t.Dh.gu(r),t.onlineState=n,t.qh&&t.bh.ji(n))}function Sl(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Wu,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.vr.Mo(e,r).next(function(t){return Lr(null!==t),n=t.keys(),i.vr.Qo(e,t)}).next(function(){return i.vr.Go(e)}).next(function(){return i.Dc.$r(e,n)})}))];case 2:return o=t.sent(),Ol(n,u,a),Dl(n,u),n.bh.xi(u,"rejected",a),[4,Pl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,_f(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function Dl(t,e){(t.Oh.get(e)||[]).forEach(function(t){t.resolve()}),t.Oh.delete(e)}function Ol(t,e,n){var r=t,i=r.Mh[r.currentUser.Zs()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Mh[r.currentUser.Zs()]=i)}function xl(e,t,n){void 0===n&&(n=null),e.bh.Li(t);for(var r=0,i=e.Nh.get(t);r<i.length;r++){var o=i[r];e.Ch.delete(o),n&&e.Dh.Qh(o,n)}e.Nh.delete(t),e.qh&&e.kh.qc(t).forEach(function(t){e.kh.zo(t)||Rl(e,t)})}function Rl(t,e){var n=t.$h.get(e);null!==n&&(tl(t.Vh,n),t.$h=t.$h.remove(e),t.xh.delete(n),Ll(t))}function kl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof vl?(t.kh.Sa(o.key,e),function(t,e){e=e.key;t.$h.get(e)||(Dr("SyncEngine","New document in limbo: "+e),t.Fh.push(e),Ll(t))}(t,o)):o instanceof gl?(Dr("SyncEngine","Document no longer in limbo: "+o.key),t.kh.Ca(o.key,e),t.kh.zo(o.key)||Rl(t,o.key)):kr()}}function Ll(t){for(;0<t.Fh.length&&t.$h.size<t.Sh;){var e=t.Fh.shift(),n=t.Lh.next();t.xh.set(n,new bl(e)),t.$h=t.$h.rt(e,n),Zf(t.Vh,new Wi(Mu(Ru(e.path)),n,2,oc.oi))}}function Pl(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Ch.m()?[3,3]:(n.Ch.forEach(function(t,e){o.push(n.Uh(e,s,u).then(function(t){t&&(n.qh&&n.bh.Ui(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Ic.Gr(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Dh.gu(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Aa.forEach(c,function(e){return Aa.forEach(e.jr,function(t){return r.persistence.Co.Sa(n,e.targetId,t)}).next(function(){return Aa.forEach(e.Kr,function(t){return r.persistence.Co.Ca(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Dr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.Vc.get(o),u=s.et,u=s.it(u),r.Vc=r.Vc.rt(o,u));return[2]}})})}(n.Wu,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Vl(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Dr("SyncEngine","User change. New user:",o.Zs()),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).vr,m=e.Dc,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.vr.qo(v).next(function(t){return g=t,n=e.persistence.wc(o),m=new bc(e.Sc,n,e.persistence.Ec()),n.qo(v)}).next(function(t){for(var e=[],n=[],r=ho(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.$r(v,r).next(function(t){return{Wh:t,jh:e,Kh:n}})})})];case 1:return r=t.sent(),[2,(e.vr=n,e.Dc=m,e.yc.Cc(e.Dc),r)]}})})}(n.Wu,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Oh.forEach(function(t){t.forEach(function(t){t.reject(new Tr(_r.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Oh.clear(),n.bh.Wi(o,r.jh,r.Kh),[4,Pl(n,r.Wh)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Cl(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Wu,n=a,i=(r=e).vr,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Oo(e,n).next(function(t){return t?r.Dc.$r(e,t):Aa.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,hl(o.Vh)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Ol(o,a,h||null),Dl(o,a),o.Wu.vr.jo(a)):kr(),t.label=4;case 4:return[4,Pl(o,s)];case 5:return t.sent(),[3,7];case 6:Dr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Ul(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return Fl(r=h),ql(r),!0!==f||!0===r.Bh?[3,3]:(e=r.bh.Di(),[4,Ml(r,e.A())]);case 1:return i=t.sent(),r.Bh=!0,[4,pl(r.Vh,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],Zf(r.Vh,u);return[3,7];case 3:return!1!==f||!1===r.Bh?[3,7]:(a=[],c=Promise.resolve(),r.Nh.forEach(function(t,e){r.bh.Bi(e)?a.push(e):c=c.then(function(){return xl(r,e),mf(r.Wu,e,!0)}),tl(r.Vh,e)}),[4,c]);case 4:return t.sent(),[4,Ml(r,a)];case 5:return t.sent(),(n=r).xh.forEach(function(t,e){tl(n.Vh,e)}),n.kh.Uc(),n.xh=new Map,n.$h=new Yi(Br.i),r.Bh=!1,[4,pl(r.Vh,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Ml(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Nh.get(s))&&0!==a.length?[4,gf(e.Wu,Mu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Ch.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,wf((e=r).Wu,i.query,!0)];case 1:return n=t.sent(),n=i.view.Ph(n),[2,(e.qh&&kl(e,i.targetId,n.Ah),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,bf(e.Wu,s)];case 8:return l=t.sent(),[4,gf(e.Wu,l)];case 9:return u=t.sent(),[4,Tl(e,jl(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Dh.gu(r),n)]}})})}function jl(t){return xu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Fl(t){return t.Vh.Ku.nh=Nl.bind(null,t),t.Vh.Ku.Be=function(t,e){var n=t;if((t=n.xh.get(e))&&t.yh)return ho().add(t.key);var r=ho();if(!(e=n.Nh.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Ch.get(s),r=r.xt(s.view.fh);return r}.bind(null,t),t.Vh.Ku.eh=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).bh.Ui(s,"rejected",u),i=e.xh.get(s),(n=i&&i.key)?(r=(r=new Yi(Br.i)).rt(n,new Tu(n,Oi.min())),i=ho().add(n),i=new vo(Oi.min(),new Map,new no(di),r,i),[4,Nl(e,i)]):[3,2];case 1:return t.sent(),e.$h=e.$h.remove(n),e.xh.delete(s),Ll(e),[3,4];case 2:return[4,mf(e.Wu,s,!1).then(function(){return xl(e,s,u)}).catch(_f)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.Dh.gu=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,u=n.Ls.get(u);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Qs(s)&&(r=!0);u.Os=s}}r&&tc(n)}.bind(null,t.ph),t.Dh.Qh=function(t,e,n){var r=t;if(t=r.Ls.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.Ls.delete(e)}.bind(null,t.ph),t}function ql(t){return t.Vh.Ku.sh=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,df(e.Wu,o)];case 2:return r=t.sent(),Ol(e,n,null),Dl(e,n),e.bh.xi(n,"acknowledged"),[4,Pl(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,_f(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.Vh.Ku.ih=Sl.bind(null,t),t}var Bl,Gl,zl,Wl=(vp.prototype.Cc=function(t){this.Gh=t},vp.prototype.Or=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.rn.length||1===r.rn.length&&r.rn[0].field.p())||i.isEqual(Oi.min())?this.zh(e,r):this.Gh.$r(e,o).next(function(t){var n=s.Hh(r,t);return(ku(r)||Lu(r))&&s.Th(r.on,n,o,i)?s.zh(e,r):(Sr()<=l.DEBUG&&Dr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zu(r)),s.Gh.Or(e,r,i).next(function(e){return n.forEach(function(t){e=e.rt(t.key,t)}),e}))})},vp.prototype.Hh=function(n,t){var r=new no(Ku(n));return t.forEach(function(t,e){e instanceof _u&&Wu(n,e)&&(r=r.add(e))}),r},vp.prototype.Th=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.L(r))},vp.prototype.zh=function(t,e){return Sr()<=l.DEBUG&&Dr("IndexFreeQueryEngine","Using full collection scan to execute query:",zu(e)),this.Gh.Or(t,e,Oi.min())},vp),Kl=(yp.prototype.$o=function(t){return Aa.resolve(0===this.vr.length)},yp.prototype.xo=function(t,e,n,r){var i=this.Yh;this.Yh++,0<this.vr.length&&this.vr[this.vr.length-1];n=new gc(i,e,n,r);this.vr.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.Jh=this.Jh.add(new xf(u.key,i)),this.Sr.ko(t,u.key.path.h())}return Aa.resolve(n)},yp.prototype.Mo=function(t,e){return Aa.resolve(this.Xh(e))},yp.prototype.Lo=function(t,e){e+=1,e=this.Zh(e),e=e<0?0:e;return Aa.resolve(this.vr.length>e?this.vr[e]:null)},yp.prototype.Bo=function(){return Aa.resolve(0===this.vr.length?-1:this.Yh-1)},yp.prototype.qo=function(t){return Aa.resolve(this.vr.slice())},yp.prototype.Cr=function(t,e){var n=this,r=new xf(e,0),e=new xf(e,Number.POSITIVE_INFINITY),i=[];return this.Jh.Nt([r,e],function(t){t=n.Xh(t.Wc);i.push(t)}),Aa.resolve(i)},yp.prototype.Mr=function(t,e){var n=this,r=new no(di);return e.forEach(function(t){var e=new xf(t,0),t=new xf(t,Number.POSITIVE_INFINITY);n.Jh.Nt([e,t],function(t){r=r.add(t.Wc)})}),Aa.resolve(this.tl(r))},yp.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,e=n;Br.F(e)||(e=e.child(""));var e=new xf(new Br(e),0),i=new no(di);return this.Jh.Ft(function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(i=i.add(t.Wc)),!0)},e),Aa.resolve(this.tl(i))},yp.prototype.tl=function(t){var e=this,n=[];return t.forEach(function(t){t=e.Xh(t);null!==t&&n.push(t)}),n},yp.prototype.Qo=function(n,r){var i=this;Lr(0===this.el(r.batchId,"removed")),this.vr.shift();var o=this.Jh;return Aa.forEach(r.mutations,function(t){var e=new xf(t.key,r.batchId);return o=o.delete(e),i.Co.Ko(n,t.key)}).next(function(){i.Jh=o})},yp.prototype.jo=function(t){},yp.prototype.zo=function(t,e){var n=new xf(e,0),n=this.Jh.$t(n);return Aa.resolve(e.isEqual(n&&n.key))},yp.prototype.Go=function(t){return this.vr.length,Aa.resolve()},yp.prototype.el=function(t,e){return this.Zh(t)},yp.prototype.Zh=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},yp.prototype.Xh=function(t){t=this.Zh(t);return t<0||t>=this.vr.length?null:this.vr[t]},yp),Hl=(dp.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.nl(e);return this.docs=this.docs.rt(r,{Zo:e,size:i,readTime:n}),this.size+=i-o,this.Sr.ko(t,r.path.h())},dp.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},dp.prototype.Ar=function(t,e){e=this.docs.get(e);return Aa.resolve(e?e.Zo:null)},dp.prototype.getEntries=function(t,e){var n=this,r=io;return e.forEach(function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)}),Aa.resolve(r)},dp.prototype.Or=function(t,e,n){for(var r=uo,i=new Br(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,s=a.Zo,a=a.readTime;if(!e.path.T(u.path))break;a.L(n)<=0||s instanceof _u&&Wu(e,s)&&(r=r.rt(s.key,s))}return Aa.resolve(r)},dp.prototype.sl=function(t,e){return Aa.forEach(this.docs,function(t){return e(t)})},dp.prototype.ia=function(t){return new Ql(this)},dp.prototype.oa=function(t){return Aa.resolve(this.size)},dp),Ql=(n(pp,zl=h),pp.prototype.gr=function(n){var r=this,i=[];return this.dr.forEach(function(t,e){e?i.push(r.aa.Tr(n,e,r.readTime)):r.aa.Ir(t)}),Aa.$n(i)},pp.prototype.Rr=function(t,e){return this.aa.Ar(t,e)},pp.prototype.Pr=function(t,e){return this.aa.getEntries(t,e)},pp),Yl=(lp.prototype.De=function(t,n){return this.il.forEach(function(t,e){return n(e)}),Aa.resolve()},lp.prototype.Ta=function(t){return Aa.resolve(this.lastRemoteSnapshotVersion)},lp.prototype.Ea=function(t){return Aa.resolve(this.rl)},lp.prototype.da=function(t){return this.highestTargetId=this.al.next(),Aa.resolve(this.highestTargetId)},lp.prototype.Ia=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.rl&&(this.rl=e),Aa.resolve()},lp.prototype.Ra=function(t){this.il.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.al=new Kh(e),this.highestTargetId=e),t.sequenceNumber>this.rl&&(this.rl=t.sequenceNumber)},lp.prototype.Aa=function(t,e){return this.Ra(e),this.targetCount+=1,Aa.resolve()},lp.prototype.ga=function(t,e){return this.Ra(e),Aa.resolve()},lp.prototype.ya=function(t,e){return this.il.delete(e.target),this.ol.qc(e.targetId),--this.targetCount,Aa.resolve()},lp.prototype.Vo=function(n,r,i){var o=this,s=0,u=[];return this.il.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.il.delete(t),u.push(o.Va(n,e.targetId)),s++)}),Aa.$n(u).next(function(){return s})},lp.prototype.pa=function(t){return Aa.resolve(this.targetCount)},lp.prototype.ba=function(t,e){e=this.il.get(e)||null;return Aa.resolve(e)},lp.prototype.va=function(t,e,n){return this.ol.Oc(e,n),Aa.resolve()},lp.prototype.Da=function(e,t,n){this.ol.Bc(t,n);var r=this.persistence.Co,i=[];return r&&t.forEach(function(t){i.push(r.Ko(e,t))}),Aa.$n(i)},lp.prototype.Va=function(t,e){return this.ol.qc(e),Aa.resolve()},lp.prototype.Na=function(t,e){e=this.ol.Qc(e);return Aa.resolve(e)},lp.prototype.zo=function(t,e){return Aa.resolve(this.ol.zo(e))},lp),Xl=(fp.prototype.start=function(){return Promise.resolve()},fp.prototype.Si=function(){return this.Ma=!1,Promise.resolve()},Object.defineProperty(fp.prototype,"Ti",{get:function(){return this.Ma},enumerable:!1,configurable:!0}),fp.prototype.Xa=function(){},fp.prototype.Za=function(){},fp.prototype.Ec=function(){return this.Sr},fp.prototype.wc=function(t){var e=this.cl[t.Zs()];return e||(e=new Kl(this.Sr,this.Co),this.cl[t.Zs()]=e),e},fp.prototype.mc=function(){return this.ja},fp.prototype.Tc=function(){return this.br},fp.prototype.runTransaction=function(t,e,n){var r=this;Dr("MemoryPersistence","Starting transaction:",t);var i=new $l(this.ka.next());return this.Co.hl(),n(i).next(function(t){return r.Co.ll(i).next(function(){return t})}).Nn().then(function(t){return i.pr(),t})},fp.prototype._l=function(e,n){return Aa.xn(Object.values(this.cl).map(function(t){return function(){return t.zo(e,n)}}))},fp),$l=(n(hp,Gl=Ee),hp),Jl=(cp.wl=function(t){return new cp(t)},Object.defineProperty(cp.prototype,"ml",{get:function(){if(this.dl)return this.dl;throw kr()},enumerable:!1,configurable:!0}),cp.prototype.Sa=function(t,e,n){return this.fl.Sa(n,e),this.ml.delete(n.toString()),Aa.resolve()},cp.prototype.Ca=function(t,e,n){return this.fl.Ca(n,e),this.ml.add(n.toString()),Aa.resolve()},cp.prototype.Ko=function(t,e){return this.ml.add(e.toString()),Aa.resolve()},cp.prototype.removeTarget=function(t,e){var n=this;this.fl.qc(e.targetId).forEach(function(t){return n.ml.add(t.toString())});var r=this.persistence.mc();return r.Na(t,e.targetId).next(function(t){t.forEach(function(t){return n.ml.add(t.toString())})}).next(function(){return r.ya(t,e)})},cp.prototype.hl=function(){this.dl=new Set},cp.prototype.ll=function(n){var r=this,i=this.persistence.Tc().ia();return Aa.forEach(this.ml,function(t){var e=Br.D(t);return r.Tl(n,e).next(function(t){t||i.Ir(e)})}).next(function(){return r.dl=null,i.apply(n)})},cp.prototype.gc=function(t,e){var n=this;return this.Tl(t,e).next(function(t){t?n.ml.delete(e.toString()):n.ml.add(e.toString())})},cp.prototype.ul=function(t){return 0},cp.prototype.Tl=function(t,e){var n=this;return Aa.xn([function(){return Aa.resolve(n.fl.zo(e))},function(){return n.persistence.mc().zo(t,e)},function(){return n.persistence._l(t,e)}])},cp),Zl=(ap.prototype.Ru=function(t){this.Al=t},ap.prototype.mu=function(t){this.Rl=t},ap.prototype.onMessage=function(t){this.Pl=t},ap.prototype.close=function(){this.Il()},ap.prototype.send=function(t){this.El(t)},ap.prototype.gl=function(){this.Al()},ap.prototype.yl=function(t){this.Rl(t)},ap.prototype.Vl=function(t){this.Pl(t)},ap),tp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ep=(up.prototype.$u=function(e,t,n,r){var i=this.Sl(e,t);Dr("RestConnection","Sending: ",i,n);t={};return this.Dl(t,r),this.Cl(e,i,t,n).then(function(t){return Dr("RestConnection","Received: ",t),t},function(t){throw xr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},up.prototype.xu=function(t,e,n,r){return this.$u(t,e,n,r)},up.prototype.Dl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.23.0",t["Content-Type"]="text/plain",e)for(var n in e.jc)e.jc.hasOwnProperty(n)&&(t[n]=e.jc[n])},up.prototype.Sl=function(t,e){t=tp[t];return this.bl+"/v1/"+e+":"+t},n(sp,Bl=up),sp.prototype.Cl=function(o,e,s,u){return new Promise(function(n,r){var i=new wr;i.listenOnce(gr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case vr.NO_ERROR:var t=i.getResponseJson();Dr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case vr.TIMEOUT:Dr("Connection",'RPC "'+o+'" timed out'),r(new Tr(_r.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var e=i.getStatus();Dr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace("_","-"),e=0<=Object.values(_r).indexOf(e)?e:_r.UNKNOWN,r(new Tr(e,t.message))):r(new Tr(_r.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Tr(_r.UNAVAILABLE,"Connection failed."));break;default:kr()}}finally{Dr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},sp.prototype.Pu=function(t,e){var n,r=[this.bl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=yr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Dl(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||(0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Dr("Connection","Creating WebChannel: "+r,t);var o=i.createWebChannel(r,t),s=!1,u=!1,a=new Zl({El:function(t){u?Dr("Connection","Not sending because WebChannel is closed:",t):(s||(Dr("Connection","Opening WebChannel transport."),o.open(),s=!0),Dr("Connection","WebChannel sending:",t),o.send(t))},Il:function(){return o.close()}}),t=function(t,e){o.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(mr.EventType.OPEN,function(){u||Dr("Connection","WebChannel transport opened.")}),t(mr.EventType.CLOSE,function(){u||(u=!0,Dr("Connection","WebChannel transport closed"),a.yl())}),t(mr.EventType.ERROR,function(t){u||(u=!0,xr("Connection","WebChannel transport errored:",t),a.yl(new Tr(_r.UNAVAILABLE,"The operation could not be completed")))}),t(mr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Lr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Dr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=zi[r];if(void 0!==t)return Qi(t)}(),i=n.message,void 0===t&&(t=_r.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,a.yl(new Tr(t,i)),o.close()):(Dr("Connection","WebChannel received:",e),a.Vl(e)))}),setTimeout(function(){a.gl()},0),a},sp),np=(op.prototype.Xu=function(t){this.kl.push(t)},op.prototype.Si=function(){window.removeEventListener("online",this.Nl),window.removeEventListener("offline",this.$l)},op.prototype.Ml=function(){window.addEventListener("online",this.Nl),window.addEventListener("offline",this.$l)},op.prototype.Fl=function(){Dr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kl;t<e.length;t++)(0,e[t])(0)},op.prototype.xl=function(){Dr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kl;t<e.length;t++)(0,e[t])(1)},op.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},op),rp=(ip.prototype.Xu=function(t){},ip.prototype.Si=function(){},ip);function ip(){}function op(){var t=this;this.Nl=function(){return t.Fl()},this.$l=function(){return t.xl()},this.kl=[],this.Ml()}function sp(t){var e=this;return(e=Bl.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function up(t){this.pl=t,this.U=t.U;var e=t.ssl?"https":"http";this.bl=e+"://"+t.host,this.vl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}function ap(t){this.El=t.El,this.Il=t.Il}function cp(t){this.persistence=t,this.fl=new Of,this.dl=null}function hp(t){var e=this;return(e=Gl.call(this)||this).Fa=t,e}function fp(t){var e=this;this.cl={},this.ka=new oc(0),this.Ma=!1,this.Ma=!0,this.Co=t(this),this.ja=new Yl(this),this.Sr=new bh,this.br=(t=this.Sr,new Hl(t,function(t){return e.Co.ul(t)}))}function lp(t){this.persistence=t,this.il=new Si(Fi,qi),this.lastRemoteSnapshotVersion=Oi.min(),this.highestTargetId=0,this.rl=0,this.ol=new Of,this.targetCount=0,this.al=Kh._a()}function pp(t){var e=this;return(e=zl.call(this)||this).aa=t,e}function dp(t,e){this.Sr=t,this.nl=e,this.docs=new Yi(Br.i),this.size=0}function yp(t,e){this.Sr=t,this.Co=e,this.vr=[],this.Yh=1,this.Jh=new no(xf.xc)}function vp(){}function gp(t){return new Jo(t,!0)}var mp,wp,bp,Ip,Ep="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",_p=(Mp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.bh=this.Ol(e),this.persistence=this.Ll(e),[4,this.persistence.start()];case 1:return t.sent(),this.Bl=this.ql(e),this.Wu=this.Ul(e),[2]}})})},Mp.prototype.ql=function(t){return null},Mp.prototype.Ul=function(t){return e=this.persistence,n=new Wl,t=t.Ql,new lf(e,n,t);var e,n},Mp.prototype.Ll=function(t){if(t.persistenceSettings.Wl)throw new Tr(_r.FAILED_PRECONDITION,Ep);return new Xl(Jl.wl)},Mp.prototype.Ol=function(t){return new vc},Mp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Bl&&this.Bl.stop(),[4,this.bh.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}})})},Mp.prototype.clearPersistence=function(t,e){throw new Tr(_r.FAILED_PRECONDITION,Ep)},Mp),Tp=(n(Up,Ip=_p),Up.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Ip.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,Ef(this.Wu)];case 2:return t.sent(),[4,this.jl.initialize(this,e)];case 3:return t.sent(),[4,ql(this.jl._i)];case 4:return t.sent(),[4,hl(this.jl.Vh)];case 5:return t.sent(),[2]}})})},Up.prototype.ql=function(t){var e=this.persistence.Co.do;return new qc(e,t.os)},Up.prototype.Ll=function(t){var e=ff(t.pl.U,t.pl.persistenceKey),n=gp(t.pl.U);return new nf(t.persistenceSettings.synchronizeTabs,e,t.clientId,Mc.oo(t.persistenceSettings.cacheSizeBytes),t.os,Ga(),za(),n,this.bh,t.persistenceSettings.xa)},Up.prototype.Ol=function(t){return new vc},Up.prototype.clearPersistence=function(t,e){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Sa.On()?(e=n+"main",[4,Sa.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(ff(t,e))},n(Cp,bp=Up),Cp.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,bp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.jl._i,this.bh instanceof yc?(this.bh._i={tr:Cl.bind(null,e),er:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).Bh?(Dr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Nh.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,If(e.Wu)];case 3:return n=t.sent(),r=vo.Jt(o,"current"===s),[4,Pl(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,mf(e.Wu,o,!0)];case 6:return t.sent(),xl(e,o,u),[3,8];case 7:kr(),t.label=8;case 8:return[2]}})})}.bind(null,e),nr:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=Fl(c)).Bh)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.Nh.has(r)?(Dr("SyncEngine","Adding an already active target "+r),[3,5]):[4,bf(n.Wu,r)]):[3,6];case 2:return i=t.sent(),[4,gf(n.Wu,i)];case 3:return o=t.sent(),[4,Tl(n,jl(i),o.targetId,!1)];case 4:t.sent(),Zf(n.Vh,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.Nh.has(e)?[4,mf(n.Wu,e,!1).then(function(){tl(n.Vh,e),xl(n,e)}).catch(_f)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),Vi:function(t){return t.Wu.persistence.Vi()}.bind(null,e)},[4,this.bh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.Ja(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Ul(this.jl._i,e)];case 1:return t.sent(),this.Bl&&(e&&!this.Bl.Ti?this.Bl.start(this.Wu):e||this.Bl.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Cp.prototype.Ol=function(t){if(t.persistenceSettings.Wl&&t.persistenceSettings.synchronizeTabs){var e=Ga();if(!yc.On(e))throw new Tr(_r.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ff(t.pl.U,t.pl.persistenceKey);return new yc(e,t.os,n,t.clientId,t.Ql)}return new vc},Cp),Np=(Vp.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Wu?[3,2]:(this.Wu=n.Wu,this.bh=n.bh,this.ju=this.Kl(r),this.Vh=this.Gl(r),this.ph=this.zl(r),this._i=this.Hl(r),this.bh.fi=function(t){return Al(e._i,t,1)},this.Vh.Ku.Yl=Vl.bind(null,this._i),[4,pl(this.Vh,this._i.qh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Vp.prototype.zl=function(t){return new $a},Vp.prototype.Kl=function(t){var e=gp(t.pl.U),n=(n=t.pl,new ep(n));return t=t.credentials,new Uf(t,n,e)},Vp.prototype.Gl=function(t){var e=this,n=this.Wu,r=this.ju,i=t.os,o=function(t){return Al(e._i,t,0)},t=new(np.On()?np:rp);return new Nf(n,r,i,o,t)},Vp.prototype.Hl=function(t){return function(t,e,n,r,i,o,s){o=new Il(t,e,n,r,i,o);return s&&(o.Bh=!0),o}(this.Wu,this.Vh,this.ph,this.bh,t.Ql,t.Sh,!t.persistenceSettings.Wl||!t.persistenceSettings.synchronizeTabs)},Vp.prototype.terminate=function(){return Jf(this.Vh)},Vp),Ap=(Pp.prototype.next=function(t){this.observer.next&&this.Jl(this.observer.next,t)},Pp.prototype.error=function(t){this.observer.error?this.Jl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Pp.prototype.Xl=function(){this.muted=!0},Pp.prototype.Jl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Pp),Sp=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Tr(_r.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if($r("FieldPath","string",e,t[e]),0===t[e].length)throw new Tr(_r.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Zl=new qr(t)},Dp=(n(Lp,wp=Sp),Lp.documentId=function(){return new Lp(qr.v().R())},Lp.prototype.isEqual=function(t){if(!(t instanceof Lp))throw ai("isEqual","FieldPath",1,t);return this.Zl.isEqual(t.Zl)},Lp),Op=new RegExp("[~\\*/\\[\\]]"),xp=function(t){this.t_=t},Rp=(n(kp,mp=xp),kp.prototype.e_=function(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+"() can only appear at the top level of your update data"):t.s_(this.t_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},kp.prototype.isEqual=function(t){return t instanceof kp},kp);function kp(){return null!==mp&&mp.apply(this,arguments)||this}function Lp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wp.call(this,t)||this}function Pp(t){this.observer=t,this.muted=!1}function Vp(){}function Cp(){return null!==bp&&bp.apply(this,arguments)||this}function Up(t){var e=this;return(e=Ip.call(this)||this).jl=t,e}function Mp(){}function jp(t,e,n){return new ad({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var Fp,qp,Bp,Gp,zp=(n(sd,Gp=xp),sd.prototype.e_=function(t){return new Gs(t.path,new Ds)},sd.prototype.isEqual=function(t){return t instanceof sd},sd),Wp=(n(od,Bp=xp),od.prototype.e_=function(t){var e=jp(this,t,!0),n=this.o_.map(function(t){return vd(t,e)}),n=new Os(n);return new Gs(t.path,n)},od.prototype.isEqual=function(t){return this===t},od),Kp=(n(id,qp=xp),id.prototype.e_=function(t){var e=jp(this,t,!0),n=this.o_.map(function(t){return vd(t,e)}),n=new Ps(n);return new Gs(t.path,n)},id.prototype.isEqual=function(t){return this===t},id),Hp=(n(rd,Fp=xp),rd.prototype.e_=function(t){var e=new Ms(t.serializer,es(t.serializer,this.a_));return new Gs(t.path,e)},rd.prototype.isEqual=function(t){return this===t},rd),Qp=(Object.defineProperty(nd.prototype,"latitude",{get:function(){return this.c_},enumerable:!1,configurable:!0}),Object.defineProperty(nd.prototype,"longitude",{get:function(){return this.u_},enumerable:!1,configurable:!0}),nd.prototype.isEqual=function(t){return this.c_===t.c_&&this.u_===t.u_},nd.prototype.toJSON=function(){return{latitude:this.c_,longitude:this.u_}},nd.prototype.H=function(t){return di(this.c_,t.c_)||di(this.u_,t.u_)},nd),Yp=function(t){this.h_=t},Xp=/^__.*__$/,$p=function(t,e,n){this.l_=t,this.__=e,this.f_=n},Jp=(ed.prototype.d_=function(t,e){var n=[];return null!==this.Qe?n.push(new nu(t,this.data,this.Qe,e)):n.push(new eu(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new uu(t,this.fieldTransforms)),n},ed),Zp=(td.prototype.d_=function(t,e){e=[new nu(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&e.push(new uu(t,this.fieldTransforms)),e},td);function td(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function ed(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function nd(t,e){if(Qr("GeoPoint",arguments,2),$r("GeoPoint","number",1,t),$r("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Tr(_r.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Tr(_r.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.c_=t,this.u_=e}function rd(t,e){var n=this;return(n=Fp.call(this,t)||this).a_=e,n}function id(t,e){var n=this;return(n=qp.call(this,t)||this).o_=e,n}function od(t,e){var n=this;return(n=Bp.call(this,t)||this).o_=e,n}function sd(){return null!==Gp&&Gp.apply(this,arguments)||this}function ud(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw kr()}}var ad=(Object.defineProperty(fd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(fd.prototype,"n_",{get:function(){return this.settings.n_},enumerable:!1,configurable:!0}),fd.prototype.m_=function(t){return new fd(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},fd.prototype.T_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.m_({path:e,r_:!1});return e.E_(t),e},fd.prototype.I_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.m_({path:t,r_:!1});return t.w_(),t},fd.prototype.A_=function(t){return this.m_({path:void 0,r_:!0})},fd.prototype.s_=function(t){return Ed(t,this.settings.methodName,this.settings.R_||!1,this.path,this.settings.i_)},fd.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.T(t)})||void 0!==this.fieldTransforms.find(function(t){return e.T(t.field)})},fd.prototype.w_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.E_(this.path.get(t))},fd.prototype.E_=function(t){if(0===t.length)throw this.s_("Document fields must not be empty");if(ud(this.n_)&&Xp.test(t))throw this.s_('Document fields cannot begin and end with "__"')},fd),cd=(hd.prototype.P_=function(t,e,n,r){return void 0===r&&(r=!1),new ad({n_:t,methodName:e,i_:n,path:qr.g(),r_:!1,R_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},hd);function hd(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||gp(t)}function fd(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.w_(),this.fieldTransforms=i||[],this.Qe=o||[]}function ld(t,e,n,r,i,o){void 0===o&&(o={});var s=t.P_(o.merge||o.mergeFields?2:0,e,n,i);wd("Data must be an object, but it was:",s,r);var u,a,r=gd(r,s);if(o.merge)u=new Bs(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=f[h],p=void 0;if(l instanceof Sp)p=l.Zl;else{if("string"!=typeof l)throw kr();p=Id(e,l,n)}if(!s.contains(p))throw new Tr(_r.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");_d(c,p)||c.push(p)}u=new Bs(c),a=s.fieldTransforms.filter(function(t){return u.He(t.field)})}else u=null,a=s.fieldTransforms;return new Jp(new du(r),u,a)}function pd(t,r,i,e){var o=t.P_(1,r,i);wd("Data must be an object, but it was:",o,e);var s=[],u=new yu;Vr(e,function(t,e){var n=Id(r,t,i),t=o.I_(n);e instanceof Rp||e instanceof Yp&&e.h_ instanceof Rp?s.push(n):null!=(t=vd(e,t))&&(s.push(n),u.set(n,t))});e=new Bs(s);return new Zp(u.Je(),e,o.fieldTransforms)}function dd(t,e,n,r,i,o){var s=t.P_(1,e,n),u=[bd(e,r,n)],a=[i];if(o.length%2!=0)throw new Tr(_r.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(bd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new yu,y=u.length-1;0<=y;--y){_d(p,u[y])||(h=u[y],f=a[y],l=s.I_(h),f instanceof Rp||f instanceof Yp&&f.h_ instanceof Rp?p.push(h):null!=(l=vd(f,l))&&(p.push(h),d.set(h,l)))}i=new Bs(p);return new Zp(d.Je(),i,s.fieldTransforms)}function yd(t,e,n,r){return void 0===r&&(r=!1),vd(n,t.P_(r?4:3,e))}function vd(s,t){if(s instanceof Yp&&(s=s.h_),md(s))return wd("Unsupported field value:",t,s),gd(s,t);if(s instanceof xp)return function(t,e){if(!ud(e.n_))throw e.s_(t.t_+"() can only be used with update() and set()");if(!e.path)throw e.s_(t.t_+"() is not currently supported inside arrays");t=t.e_(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.r_&&4!==t.n_)throw t.s_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=vd(i[r],t.A_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return es(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Di.fromDate(t);return{timestampValue:ns(e.serializer,n)}}if(t instanceof Di){var r=new Di(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ns(e.serializer,r)}}if(t instanceof Qp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof wi)return{bytesValue:rs(e.serializer,t.q)};if(t instanceof $p){n=e.U,r=t.l_;if(!r.isEqual(n))throw e.s_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:os(t.l_||e.U,t.__.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_("Unsupported field value: "+oi(t))}(s,t)}function gd(t,n){var r={};return Cr(t)?n.path&&0<n.path.length&&n.Qe.push(n.path):Vr(t,function(t,e){e=vd(e,n.T_(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function md(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Di||t instanceof Qp||t instanceof wi||t instanceof $p||t instanceof xp)}function wd(t,e,n){if(!md(n)||!ii(n)){n=oi(n);throw"an object"===n?e.s_(t+" a custom object"):e.s_(t+" "+n)}}function bd(t,e,n){if(e instanceof Sp)return e.Zl;if("string"==typeof e)return Id(t,e);throw Ed("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Id(t,e,n){try{return function(e){if(0<=e.search(Op))throw new Tr(_r.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Dp.bind.apply(Dp,i([void 0],e.split("."))))}catch(t){throw new Tr(_r.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Zl}catch(e){throw Ed(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Ed(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Tr(_r.INVALID_ARGUMENT,(e+=". ")+t+n)}function _d(t,e){return t.some(function(t){return t.isEqual(e)})}var Td=(Od.prototype.b_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.v_(),0<this.mutations.length)throw new Tr(_r.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=fs((n=s).serializer)+"/documents",r={documents:u.map(function(t){return us(n.serializer,t)})},[4,n.xu("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.serializer,"found"in(t=t)?function(t,e){Lr(!!e.found),e.found.name,e.found.updateTime;var n=as(t,e.found.name),t=is(e.found.updateTime),e=new du({mapValue:{fields:e.found.fields}});return new _u(n,t,e,{})}(e,t):"missing"in t?function(t,e){Lr(!!e.missing),Lr(!!e.readTime);t=as(t,e.missing),e=is(e.readTime);return new Tu(t,e)}(e,t):kr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){t=i.get(t.toString());Lr(!!t),o.push(t)}),o)]}})})}(this.ju,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Tu||t instanceof _u?n.S_(t):kr()}),e)]}})})},Od.prototype.set=function(t,e){this.write(e.d_(t,this.Ke(t))),this.p_.add(t.toString())},Od.prototype.update=function(t,e){try{this.write(e.d_(t,this.D_(t)))}catch(t){this.V_=t}this.p_.add(t.toString())},Od.prototype.delete=function(t){this.write([new lu(t,this.Ke(t))]),this.p_.add(t.toString())},Od.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.v_(),this.V_)throw this.V_;return e=this.g_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Br.D(e);n.mutations.push(new pu(e,n.Ke(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=fs((e=i).serializer)+"/documents",r={writes:o.map(function(t){return ds(e.serializer,t)})},[4,e.$u("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.ju,this.mutations)];case 1:return t.sent(),this.y_=!0,[2]}})})},Od.prototype.S_=function(t){var e;if(t instanceof _u)e=t.version;else{if(!(t instanceof Tu))throw kr();e=Oi.min()}var n=this.g_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Tr(_r.ABORTED,"Document version changed between two reads.")}else this.g_.set(t.key.toString(),e)},Od.prototype.Ke=function(t){var e=this.g_.get(t.toString());return!this.p_.has(t.toString())&&e?Ks.updateTime(e):Ks.Ge()},Od.prototype.D_=function(t){var e=this.g_.get(t.toString());if(this.p_.has(t.toString())||!e)return Ks.exists(!0);if(e.isEqual(Oi.min()))throw new Tr(_r.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ks.updateTime(e)},Od.prototype.write=function(t){this.v_(),this.mutations=this.mutations.concat(t)},Od.prototype.v_=function(){},Od),Nd=(Dd.prototype.run=function(){this.N_()},Dd.prototype.N_=function(){var t=this;this.gs.Rn(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Td(this.ju),(n=this.F_(e))&&n.then(function(t){r.os.ds(function(){return e.commit().then(function(){r.hs.resolve(t)}).catch(function(t){r.x_(t)})})}).catch(function(t){r.x_(t)}),[2]})})})},Dd.prototype.F_=function(t){try{var e=this.updateFunction(t);return!Vi(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},Dd.prototype.x_=function(t){var e=this;0<this.C_&&this.k_(t)?(--this.C_,this.os.ds(function(){return e.N_(),Promise.resolve()})):this.hs.reject(t)},Dd.prototype.k_=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Hi(t)},Dd),Ad=(Sd.prototype.start=function(t,e,n,r){var i=this;this.O_(),this.pl=t;var o=new _a,s=!1;return this.credentials.zc(function(t){return s?void i.os.Ds(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).os.Fs(),Dr("RemoteStore","RemoteStore received new credentials"),n=ol(e),e.Hu.add(3),[4,$f(e)];case 1:return t.sent(),n&&e.Zu.set("Unknown"),[4,e.Ku.Yl(i)];case 2:return t.sent(),e.Hu.delete(3),[4,Xf(e)];case 3:return t.sent(),[2]}})})}(i.Vh,t)}):(s=!0,Dr("FirestoreClient","Initializing. user=",t.uid),i.L_(e,n,r,t,o).then(i.M_.resolve,i.M_.reject))}),this.os.ds(function(){return i.M_.promise}),o.promise},Sd.prototype.enableNetwork=function(){var e=this;return this.O_(),this.os.enqueue(function(){return e.persistence.Za(!0),(t=e.Vh).Hu.delete(0),Xf(t);var t})},Sd.prototype.L_=function(r,i,o,s,u){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={os:this.os,pl:this.pl,clientId:this.clientId,credentials:this.credentials,Ql:s,Sh:100,persistenceSettings:o},[4,r.initialize(e)];case 1:return t.sent(),[4,i.initialize(r,e)];case 2:return t.sent(),this.persistence=r.persistence,this.bh=r.bh,this.Wu=r.Wu,this.Bl=r.Bl,this.ju=i.ju,this.Vh=i.Vh,this._i=i._i,this.B_=i.ph,this.B_.qs=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=Fl(s),(o=e.Ch.get(u))?(n=o.targetId,e.bh.Mi(n),r=o.view.gh(),[3,4]):[3,1];case 1:return[4,gf(e.Wu,Mu(u))];case 2:return i=t.sent(),o=e.bh.Mi(i.targetId),n=i.targetId,[4,Tl(e,u,n,"current"===o)];case 3:r=t.sent(),e.qh&&Zf(e.Vh,i),t.label=4;case 4:return[2,r]}})})}.bind(null,this._i),this.B_.Ws=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Ch.get(o),1<(r=e.Nh.get(n.targetId)).length?[2,(e.Nh.set(n.targetId,r.filter(function(t){return!Bu(t,o)})),void e.Ch.delete(o))]:e.qh?(e.bh.Li(n.targetId),e.bh.Ni(n.targetId)?[3,2]:[4,mf(e.Wu,n.targetId,!1).then(function(){e.bh.qi(n.targetId),tl(e.Vh,n.targetId),xl(e,n.targetId)}).catch(_f)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return xl(e,n.targetId),[4,mf(e.Wu,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,this._i),this.persistence.Xa(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),u.resolve(),[3,4];case 3:if(e=t.sent(),u.reject(e),!this.q_(e))throw e;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),this.L_(new _p,new Np,{Wl:!1},s,u))];case 4:return[2]}})})},Sd.prototype.q_=function(t){return"FirebaseError"===t.name?t.code===_r.FAILED_PRECONDITION||t.code===_r.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Sd.prototype.O_=function(){if(this.os.Vs)throw new Tr(_r.FAILED_PRECONDITION,"The client has already been terminated.")},Sd.prototype.disableNetwork=function(){var t=this;return this.O_(),this.os.enqueue(function(){return t.persistence.Za(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Hu.add(0),[4,$f(e)];case 1:return t.sent(),e.Zu.set("Offline"),[2]}})})}(t.Vh)})},Sd.prototype.terminate=function(){var t=this;this.os.Ss();var n=new _a;return this.os.ps(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.Bl&&this.Bl.stop(),[4,Jf(this.Vh)];case 1:return t.sent(),[4,this.bh.Si()];case 2:return t.sent(),[4,this.persistence.Si()];case 3:return t.sent(),this.credentials.Hc(),n.resolve(),[3,5];case 4:return e=t.sent(),e=Ya(e,"Failed to shutdown persistence"),n.reject(e),[3,5];case 5:return[2]}})})}),n.promise},Sd.prototype.waitForPendingWrites=function(){var t=this;this.O_();var e=new _a;return this.os.ds(function(){return function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:ol((n=o).Vh)||Dr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Wu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.vr.Bo(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Oh.get(r)||[]).push(s),n.Oh.set(r,i),[3,4]);case 3:return i=t.sent(),i=Ya(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}(t._i,e)}),e.promise},Sd.prototype.listen=function(t,e,n){var r=this;this.O_();var i=new Ap(n),o=new ec(t,i,e);return this.os.ds(function(){return Ja(r.B_,o)}),function(){i.Xl(),r.os.ds(function(){return Za(r.B_,o)})}},Sd.prototype.U_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return t.sent(),e=new _a,[2,(this.os.ds(function(){return function(i,o,s){return y(this,void 0,void 0,function(){var r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=o,(n=i).persistence.runTransaction("read document","readonly",function(t){return n.Dc.Dr(t,e)}))];case 1:return(r=t.sent())instanceof _u?s.resolve(r):r instanceof Tu?s.resolve(null):s.reject(new Tr(_r.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),r=Ya(r,"Failed to get document '"+o+" from cache"),s.reject(r),[3,3];case 3:return[2]}var e,n})})}(n.Wu,r,e)}),e.promise)]}})})},Sd.prototype.Q_=function(c,h){return void 0===h&&(h={}),y(this,void 0,void 0,function(){var e,a=this;return v(this,function(t){switch(t.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return t.sent(),e=new _a,[2,(this.os.ds(function(){return n=a.B_,r=a.os,i=c,o=h,s=e,t=new Ap({next:function(t){r.ds(function(){return Za(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Tr(_r.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Tr(_r.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new ec(Ru(i.path),t,{includeMetadataChanges:!0,Js:!0}),Ja(n,u);var n,r,i,o,s,t,u}),e.promise)]}})})},Sd.prototype.W_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return t.sent(),e=new _a,[2,(this.os.ds(function(){return function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,wf(r,i,!0)];case 1:return n=t.sent(),e=new ml(i,n.Nc),n=e.dh(n.documents),n=e.gr(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),n=Ya(n,"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})}(n.Wu,r,e)}),e.promise)]}})})},Sd.prototype.j_=function(c,h){return void 0===h&&(h={}),y(this,void 0,void 0,function(){var u,a=this;return v(this,function(t){switch(t.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return t.sent(),u=new _a,[2,(this.os.ds(function(){return e=a.B_,n=a.os,t=c,r=h,i=u,o=new Ap({next:function(t){n.ds(function(){return Za(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Tr(_r.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new ec(t,o,{includeMetadataChanges:!0,Js:!0}),Ja(e,s);var e,n,t,r,i,o,s}),u.promise)]}})})},Sd.prototype.write=function(t){var e=this;this.O_();var n=new _a;return this.os.ds(function(){return function(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=ql(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Wu,a=p,h=i,f=Di.now(),o=a.reduce(function(t,e){return t.add(e.key)},ho()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Dc.$r(u,o).next(function(t){c=t;for(var s,e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=(s=i,o=c.get(i.key),s instanceof uu?function(t){for(var e=null,n=0,r=s.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof _u?t.field(i.field):void 0,o=Ns(i.transform,o||null);null!=o&&(e=(null==e?new yu:e).set(i.field,o))}return e?e.Je():null}(o):null);null!=o&&e.push(new nu(i.key,o,function s(t){var u=[];return Vr(t.fields||{},function(t,e){var n=new qr([t]);if(Yo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new Bs(u)}(o.proto.mapValue),Ks.exists(!0)))}return h.vr.xo(u,f,e,a)})}).then(function(t){var e=t.hr(c);return{batchId:t.batchId,dr:e}}))];case 2:return s=t.sent(),u.bh.Fi(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.Mh[e.currentUser.Zs()])||new Yi(di)).rt(n,r),e.Mh[e.currentUser.Zs()]=i,[4,Pl(u,s.dr)];case 3:return t.sent(),[4,hl(u.Vh)];case 4:return t.sent(),[3,6];case 5:return u=t.sent(),u=Ya(u,"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}(e._i,t,n)}),n.promise},Sd.prototype.U=function(){return this.pl.U},Sd.prototype.K_=function(t){var e=this;this.O_();var r=new Ap(t);return this.os.ds(function(){return y(e,void 0,void 0,function(){return v(this,function(t){return[2,(e=this.B_,n=r,e.Bs.add(n),void n.next())];var e,n})})}),function(){r.Xl(),e.os.ds(function(){return y(e,void 0,void 0,function(){return v(this,function(t){return[2,void this.B_.Bs.delete(r)]})})})}},Object.defineProperty(Sd.prototype,"G_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),Sd.prototype.transaction=function(t){var e=this;this.O_();var n=new _a;return this.os.ds(function(){return new Nd(e.os,e.ju,t,n).run(),Promise.resolve()}),n.promise},Sd);function Sd(t,e){this.credentials=t,this.os=e,this.clientId=li.k(),this.M_=new _a}function Dd(t,e,n,r){this.os=t,this.ju=e,this.updateFunction=n,this.hs=r,this.C_=5,this.gs=new Na(this.os,"transaction_retry")}function Od(t){this.ju=t,this.g_=new Map,this.mutations=[],this.y_=!1,this.V_=null,this.p_=new Set}function xd(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Rd,kd,Ld=($d.prototype.J_=function(t){switch(Vo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Bo(t.integerValue||t.doubleValue);case 3:return this.X_(t.timestampValue);case 4:return this.Z_(t);case 5:return t.stringValue;case 6:return this.Y_(Go(t.bytesValue));case 7:return this.tf(t.referenceValue);case 8:return this.ef(t.geoPointValue);case 9:return this.nf(t.arrayValue);case 10:return this.sf(t.mapValue);default:throw kr()}},$d.prototype.sf=function(t){var n=this,r={};return Vr(t.fields||{},function(t,e){r[t]=n.J_(e)}),r},$d.prototype.ef=function(t){return new Qp(Bo(t.latitude),Bo(t.longitude))},$d.prototype.nf=function(t){var e=this;return(t.values||[]).map(function(t){return e.J_(t)})},$d.prototype.Z_=function(t){switch(this.z_){case"previous":var e=function t(e){e=e.mapValue.fields.__previous_value__;return ko(e)?t(e):e}(t);return null==e?null:this.J_(e);case"estimate":return this.X_(Lo(t));default:return null}},$d.prototype.X_=function(t){t=qo(t),t=new Di(t.seconds,t.nanos);return this.timestampsInSnapshots?t:t.toDate()},$d.prototype.tf=function(t){var e=jr.P(t);Lr(Ts(e));t=new Ai(e.get(1),e.get(3)),e=new Br(e.u(5));return t.isEqual(this.U)||Or("Document "+e+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.H_(e)},$d),Pd=Mc.uo,Vd=(Xd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Xd),Cd=(Object.defineProperty(Yd.prototype,"wf",{get:function(){return this.mf||(this.mf=new cd(this.l_,this.df.ignoreUndefinedProperties)),this.mf},enumerable:!1,configurable:!0}),Yd.prototype.settings=function(t){Qr("Firestore.settings",arguments,1),$r("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.df),t)).merge;t=new Vd(t);if(this.hf&&!this.df.isEqual(t))throw new Tr(_r.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.df=t).credentials&&(this.ff=function(t){if(!t)return new Rf;switch(t.type){case"gapi":var e=t.client;return Lr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Pf(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Tr(_r.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Yd.prototype.enableNetwork=function(){return this.uf(),this.hf.enableNetwork()},Yd.prototype.disableNetwork=function(){return this.uf(),this.hf.disableNetwork()},Yd.prototype.enablePersistence=function(t){var e;if(this.hf)throw new Tr(_r.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var n=!1,r=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Or("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),n=null!==(e=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==e&&e,r=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,n&&r))throw new Tr(_r.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Tf(this.if,this.rf,{Wl:!0,cacheSizeBytes:this.df.cacheSizeBytes,synchronizeTabs:n,xa:r})},Yd.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var n,e=this;return v(this,function(t){if(void 0!==this.hf&&!this.hf.G_)throw new Tr(_r.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new _a,[2,(this.cf.ps(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.if.clearPersistence(this.l_,this._f)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},Yd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Yd.prototype,"Ef",{get:function(){return this.uf(),this.hf.G_},enumerable:!1,configurable:!0}),Yd.prototype.waitForPendingWrites=function(){return this.uf(),this.hf.waitForPendingWrites()},Yd.prototype.onSnapshotsInSync=function(t){if(this.uf(),xd(t))return this.hf.K_(t);$r("Firestore.onSnapshotsInSync","function",1,t);t={next:t};return this.hf.K_(t)},Yd.prototype.uf=function(){return this.hf||this.Tf(new _p,new Np,{Wl:!1}),this.hf},Yd.prototype.If=function(){return new _i(this.l_,this._f,this.df.host,this.df.ssl,this.df.experimentalForceLongPolling)},Yd.prototype.Tf=function(t,e,n){var r=this.If();return this.hf=new Ad(this.ff,this.cf),this.hf.start(r,t,e,n)},Yd.lf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Tr(_r.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,t=t.options.projectId;if(!t||"string"!=typeof t)throw new Tr(_r.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ai(t)},Object.defineProperty(Yd.prototype,"app",{get:function(){if(!this.af)throw new Tr(_r.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.af},enumerable:!1,configurable:!0}),Yd.prototype.collection=function(t){return Qr("Firestore.collection",arguments,1),$r("Firestore.collection","non-empty string",1,t),this.uf(),new oy(jr.P(t),this,null)},Yd.prototype.doc=function(t){return Qr("Firestore.doc",arguments,1),$r("Firestore.doc","non-empty string",1,t),this.uf(),jd.Af(jr.P(t),this,null)},Yd.prototype.collectionGroup=function(t){if(Qr("Firestore.collectionGroup",arguments,1),$r("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Tr(_r.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.uf(),new ry((t=t,new Au(jr.g(),t)),this,null)},Yd.prototype.runTransaction=function(e){var n=this;return Qr("Firestore.runTransaction",arguments,1),$r("Firestore.runTransaction","function",1,e),this.uf().transaction(function(t){return e(new Ud(n,t))})},Yd.prototype.batch=function(){return this.uf(),new Md(this)},Object.defineProperty(Yd,"logLevel",{get:function(){switch(Sr()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),Yd.setLogLevel=function(t){Qr("Firestore.setLogLevel",arguments,1),ni("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Nr.setLogLevel(t)},Yd.prototype.Rf=function(){return this.df.timestampsInSnapshots},Yd.prototype.Pf=function(){return this.df},Yd),Ud=(Qd.prototype.get=function(t){var e=this;Qr("Transaction.get",arguments,1);var n=ly("Transaction.get",t,this.gf);return this.yf.b_([n.__]).then(function(t){if(!t||1!==t.length)return kr();t=t[0];if(t instanceof Tu)return new qd(e.gf,n.__,null,!1,!1,n.f_);if(t instanceof _u)return new qd(e.gf,n.__,t,!1,!1,n.f_);throw kr()})},Qd.prototype.set=function(t,e,n){Xr("Transaction.set",arguments,2,3);t=ly("Transaction.set",t,this.gf);n=cy("Transaction.set",n);e=py(t.f_,e,n),n=ld(this.gf.wf,"Transaction.set",t.__,e,null!==t.f_,n);return this.yf.set(t.__,n),this},Qd.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return e="string"==typeof e||e instanceof Dp?(Yr("Transaction.update",arguments,3),r=ly("Transaction.update",t,this.gf),dd(this.gf.wf,"Transaction.update",r.__,e,n,i)):(Qr("Transaction.update",arguments,2),r=ly("Transaction.update",t,this.gf),pd(this.gf.wf,"Transaction.update",r.__,e)),this.yf.update(r.__,e),this},Qd.prototype.delete=function(t){Qr("Transaction.delete",arguments,1);t=ly("Transaction.delete",t,this.gf);return this.yf.delete(t.__),this},Qd),Md=(Hd.prototype.set=function(t,e,n){Xr("WriteBatch.set",arguments,2,3),this.bf();t=ly("WriteBatch.set",t,this.gf);n=cy("WriteBatch.set",n);e=py(t.f_,e,n),n=ld(this.gf.wf,"WriteBatch.set",t.__,e,null!==t.f_,n);return this.Vf=this.Vf.concat(n.d_(t.__,Ks.Ge())),this},Hd.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return this.bf(),e="string"==typeof e||e instanceof Dp?(Yr("WriteBatch.update",arguments,3),r=ly("WriteBatch.update",t,this.gf),dd(this.gf.wf,"WriteBatch.update",r.__,e,n,i)):(Qr("WriteBatch.update",arguments,2),r=ly("WriteBatch.update",t,this.gf),pd(this.gf.wf,"WriteBatch.update",r.__,e)),this.Vf=this.Vf.concat(e.d_(r.__,Ks.exists(!0))),this},Hd.prototype.delete=function(t){Qr("WriteBatch.delete",arguments,1),this.bf();t=ly("WriteBatch.delete",t,this.gf);return this.Vf=this.Vf.concat(new lu(t.__,Ks.Ge())),this},Hd.prototype.commit=function(){return this.bf(),this.pf=!0,0<this.Vf.length?this.gf.uf().write(this.Vf):Promise.resolve()},Hd.prototype.bf=function(){if(this.pf)throw new Tr(_r.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Hd),jd=(n(Kd,kd=$p),Kd.Af=function(t,e,n){if(t.length%2!=0)throw new Tr(_r.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new Kd(new Br(t),e,n)},Object.defineProperty(Kd.prototype,"id",{get:function(){return this.__.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(Kd.prototype,"parent",{get:function(){return new oy(this.__.path.h(),this.firestore,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(Kd.prototype,"path",{get:function(){return this.__.path.R()},enumerable:!1,configurable:!0}),Kd.prototype.collection=function(t){if(Qr("DocumentReference.collection",arguments,1),$r("DocumentReference.collection","non-empty string",1,t),!t)throw new Tr(_r.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");t=jr.P(t);return new oy(this.__.path.child(t),this.firestore,null)},Kd.prototype.isEqual=function(t){if(!(t instanceof Kd))throw ai("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.__.isEqual(t.__)&&this.f_===t.f_},Kd.prototype.set=function(t,e){Xr("DocumentReference.set",arguments,1,2),e=cy("DocumentReference.set",e);t=py(this.f_,t,e),e=ld(this.firestore.wf,"DocumentReference.set",this.__,t,null!==this.f_,e);return this.hf.write(e.d_(this.__,Ks.Ge()))},Kd.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return t="string"==typeof t||t instanceof Dp?(Yr("DocumentReference.update",arguments,2),dd(this.firestore.wf,"DocumentReference.update",this.__,t,e,n)):(Qr("DocumentReference.update",arguments,1),pd(this.firestore.wf,"DocumentReference.update",this.__,t)),this.hf.write(t.d_(this.__,Ks.exists(!0)))},Kd.prototype.delete=function(){return Qr("DocumentReference.delete",arguments,0),this.hf.write([new lu(this.__,Ks.Ge())])},Kd.prototype.onSnapshot=function(){for(var e=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];Xr("DocumentReference.onSnapshot",arguments,1,4);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||xd(n[i])||(ui("DocumentReference.onSnapshot",r=n[i],["includeMetadataChanges"]),ti("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};xd(n[i])?(s=n[i],n[i]=null===(r=s.next)||void 0===r?void 0:r.bind(s),n[i+1]=null===(r=s.error)||void 0===r?void 0:r.bind(s),n[i+2]=null===(r=s.complete)||void 0===r?void 0:r.bind(s)):($r("DocumentReference.onSnapshot","function",i,n[i]),Jr("DocumentReference.onSnapshot","function",i+1,n[i+1]),Jr("DocumentReference.onSnapshot","function",i+2,n[i+2]));var s={next:function(t){n[i]&&n[i](e.vf(t))},error:n[i+1],complete:n[i+2]};return this.hf.listen(Ru(this.__.path),o,s)},Kd.prototype.get=function(t){var e=this;Xr("DocumentReference.get",arguments,0,1),fy("DocumentReference.get",t);var n=this.firestore.uf();return t&&"cache"===t.source?n.U_(this.__).then(function(t){return new qd(e.firestore,e.__,t,!0,t instanceof _u&&t.Ye,e.f_)}):n.Q_(this.__,t).then(function(t){return e.vf(t)})},Kd.prototype.withConverter=function(t){return new Kd(this.__,this.firestore,t)},Kd.prototype.vf=function(t){var e=t.docs.get(this.__);return new qd(this.firestore,this.__,e,t.fromCache,t.hasPendingWrites,this.f_)},Kd),Fd=(Wd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Wd),qd=(zd.prototype.data=function(t){var e=this;if(Xr("DocumentSnapshot.data",arguments,0,1),t=hy("DocumentSnapshot.data",t),this.Sf){if(this.f_){var n=new Bd(this.gf,this.__,this.Sf,this.Df,this.Cf,null);return this.f_.fromFirestore(n,t)}return new Ld(this.gf.l_,this.gf.Rf(),t.serverTimestamps||"none",function(t){return new jd(t,e.gf,null)},function(t){return new Ni(t)}).J_(this.Sf.sn())}},zd.prototype.get=function(t,e){var n=this;if(Xr("DocumentSnapshot.get",arguments,1,2),e=hy("DocumentSnapshot.get",e),this.Sf){t=this.Sf.data().field(bd("DocumentSnapshot.get",t,this.__));if(null!==t)return new Ld(this.gf.l_,this.gf.Rf(),e.serverTimestamps||"none",function(t){return new jd(t,n.gf,n.f_)},function(t){return new Ni(t)}).J_(t)}},Object.defineProperty(zd.prototype,"id",{get:function(){return this.__.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(zd.prototype,"ref",{get:function(){return new jd(this.__,this.gf,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(zd.prototype,"exists",{get:function(){return null!==this.Sf},enumerable:!1,configurable:!0}),Object.defineProperty(zd.prototype,"metadata",{get:function(){return new Fd(this.Cf,this.Df)},enumerable:!1,configurable:!0}),zd.prototype.isEqual=function(t){if(!(t instanceof zd))throw ai("isEqual","DocumentSnapshot",1,t);return this.gf===t.gf&&this.Df===t.Df&&this.__.isEqual(t.__)&&(null===this.Sf?null===t.Sf:this.Sf.isEqual(t.Sf))&&this.f_===t.f_},zd),Bd=(n(Gd,Rd=qd),Gd.prototype.data=function(t){return Rd.prototype.data.call(this,t)},Gd);function Gd(){return null!==Rd&&Rd.apply(this,arguments)||this}function zd(t,e,n,r,i,o){this.gf=t,this.__=e,this.Sf=n,this.Df=r,this.Cf=i,this.f_=o}function Wd(t,e){this.hasPendingWrites=t,this.fromCache=e}function Kd(t,e,n){var r=this;return(r=kd.call(this,e.l_,t,n)||this).__=t,r.firestore=e,r.f_=n,r.hf=r.firestore.uf(),r}function Hd(t){this.gf=t,this.Vf=[],this.pf=!1}function Qd(t,e){this.gf=t,this.yf=e}function Yd(t,e,n,r){var i=this;if(void 0===n&&(n=new _p),void 0===r&&(r=new Np),this.if=n,this.rf=r,this.af=null,this.cf=new Ka,this.INTERNAL={delete:function(){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.uf(),[4,this.hf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){r=t;this.af=r,this.l_=Yd.lf(r),this._f=r.name,this.ff=new kf(e)}else{t=t;if(!t.projectId)throw new Tr(_r.INVALID_ARGUMENT,"Must provide projectId");this.l_=new Ai(t.projectId,t.database),this._f="[DEFAULT]",this.ff=new Rf}this.df=new Vd({})}function Xd(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Tr(_r.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Zr("settings","non-empty string","host",t.host),this.host=t.host,ti("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(ui("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),ti("settings","object","credentials",t.credentials),this.credentials=t.credentials,ti("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),ti("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Or("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Or("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(e=t.timestampsInSnapshots)||void 0===e||e,this.ignoreUndefinedProperties=null!==(e=t.ignoreUndefinedProperties)&&void 0!==e&&e,ti("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Mc.lo;else{if(t.cacheSizeBytes!==Pd&&t.cacheSizeBytes<Mc.ho)throw new Tr(_r.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Mc.ho);this.cacheSizeBytes=t.cacheSizeBytes}ti("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(t=t.experimentalForceLongPolling)&&void 0!==t&&t}function $d(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.z_=n,this.H_=r,this.Y_=i}function Jd(t,e,n){if("string"==typeof n){if(""===n)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cu(e)&&-1!==n.indexOf("/"))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(jr.P(n));if(!Br.F(e))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return zo(t,new Br(e))}if(n instanceof $p)return zo(t,n.__);throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+oi(n)+".")}function Zd(t,e){if(!Array.isArray(t)||0===t.length)throw new Tr(_r.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Tr(_r.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Tr(_r.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Tr(_r.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function ty(t,e,n){if(!n.isEqual(e))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function ey(t){if(Lu(t)&&0===t.rn.length)throw new Tr(_r.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ny,ry=(ay.prototype.where=function(t,e,n){Qr("Query.where",arguments,3),si("Query.where",3,n);e=ni("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),t=bd("Query.where",t),e=function(t,e,n,r,i,o,s){if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new Tr(_r.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Zd(s,o);for(var u=[],a=0,c=s;a<c.length;a++){var h=c[a];u.push(Jd(r,t,h))}f={arrayValue:{values:u}}}else f=Jd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Zd(s,o),f=yd(n,e,s,"in"===o||"not-in"===o);var f=Qu.create(i,o,f);return function(t,e){if(e.un()){var n=Vu(t);if(null!==n&&!n.isEqual(e.field))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=Pu(t);null!==n&&ty(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Tr(_r.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Tr(_r.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,f),f}(this.Nf,"Query.where",this.firestore.wf,this.firestore.l_,t,e,n);return new ay((n=this.Nf,e=n.filters.concat([e]),new Au(n.path,n.collectionGroup,n.rn.slice(),e,n.limit,n.on,n.startAt,n.endAt)),this.firestore,this.f_)},ay.prototype.orderBy=function(t,e){if(Xr("Query.orderBy",arguments,1,2),Jr("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Tr(_r.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var n,t=bd("Query.orderBy",t),t=function(t,e,n){if(null!==t.startAt)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ea(e,n);return e=r,null!==Pu(n=t)||null!==(t=Vu(n))&&ty(0,t,e.field),r}(this.Nf,t,n);return new ay((n=this.Nf,t=n.rn.concat([t]),new Au(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.on,n.startAt,n.endAt)),this.firestore,this.f_)},ay.prototype.limit=function(t){return Qr("Query.limit",arguments,1),$r("Query.limit","number",1,t),ci("Query.limit",1,t),new ay(ju(this.Nf,t,"F"),this.firestore,this.f_)},ay.prototype.limitToLast=function(t){return Qr("Query.limitToLast",arguments,1),$r("Query.limitToLast","number",1,t),ci("Query.limitToLast",1,t),new ay(ju(this.Nf,t,"L"),this.firestore,this.f_)},ay.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yr("Query.startAt",arguments,1);t=this.Ff("Query.startAt",t,e,!0);return new ay(Fu(this.Nf,t),this.firestore,this.f_)},ay.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yr("Query.startAfter",arguments,1);t=this.Ff("Query.startAfter",t,e,!1);return new ay(Fu(this.Nf,t),this.firestore,this.f_)},ay.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yr("Query.endBefore",arguments,1);t=this.Ff("Query.endBefore",t,e,!0);return new ay(qu(this.Nf,t),this.firestore,this.f_)},ay.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yr("Query.endAt",arguments,1);t=this.Ff("Query.endAt",t,e,!1);return new ay(qu(this.Nf,t),this.firestore,this.f_)},ay.prototype.isEqual=function(t){if(!(t instanceof ay))throw ai("isEqual","Query",1,t);return this.firestore===t.firestore&&Bu(this.Nf,t.Nf)&&this.f_===t.f_},ay.prototype.withConverter=function(t){return new ay(this.Nf,this.firestore,t)},ay.prototype.Ff=function(c,t,e,n){if(si(c,1,t),t instanceof qd)return Qr(c,i([t],e),1),function(t,e,n,r){if(!n)throw new Tr(_r.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Uu(t);o<s.length;o++){var u=s[o];if(u.field.p())i.push(zo(e,n.key));else{var a=n.field(u.field);if(ko(a))throw new Tr(_r.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){u=u.field.R();throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}i.push(a)}}return new da(i,r)}(this.Nf,this.firestore.l_,t.Sf,n);e=[t].concat(e);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new Tr(_r.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if("string"!=typeof c)throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Cu(t)&&-1!==c.indexOf("/"))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(jr.P(c));if(!Br.F(h))throw new Tr(_r.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Br(h);u.push(zo(e,h))}else{c=yd(n,r,c);u.push(c)}}return new da(u,o)}(this.Nf,this.firestore.l_,this.firestore.wf,c,e,n)},ay.prototype.onSnapshot=function(){for(var t,e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Xr("Query.onSnapshot",arguments,1,4);var i={},o=0;"object"!=typeof n[o]||xd(n[o])||(ui("Query.onSnapshot",i=n[o],["includeMetadataChanges"]),ti("Query.onSnapshot","boolean","includeMetadataChanges",i.includeMetadataChanges),o++),xd(n[o])?(s=n[o],n[o]=null===(t=s.next)||void 0===t?void 0:t.bind(s),n[o+1]=null===(t=s.error)||void 0===t?void 0:t.bind(s),n[o+2]=null===(t=s.complete)||void 0===t?void 0:t.bind(s)):($r("Query.onSnapshot","function",o,n[o]),Jr("Query.onSnapshot","function",o+1,n[o+1]),Jr("Query.onSnapshot","function",o+2,n[o+2]));var s={next:function(t){n[o]&&n[o](new iy(e.firestore,e.Nf,t,e.f_))},error:n[o+1],complete:n[o+2]};return ey(this.Nf),this.firestore.uf().listen(this.Nf,i,s)},ay.prototype.get=function(t){var e=this;Xr("Query.get",arguments,0,1),fy("Query.get",t),ey(this.Nf);var n=this.firestore.uf();return(t&&"cache"===t.source?n.W_(this.Nf):n.j_(this.Nf,t)).then(function(t){return new iy(e.firestore,e.Nf,t,e.f_)})},ay),iy=(Object.defineProperty(uy.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(uy.prototype,"empty",{get:function(){return this.xf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(uy.prototype,"size",{get:function(){return this.xf.docs.size},enumerable:!1,configurable:!0}),uy.prototype.forEach=function(e,n){var r=this;Xr("QuerySnapshot.forEach",arguments,1,2),$r("QuerySnapshot.forEach","function",1,e),this.xf.docs.forEach(function(t){e.call(n,r.Of(t,r.metadata.fromCache,r.xf.Qt.has(t.key)))})},Object.defineProperty(uy.prototype,"query",{get:function(){return new ry(this.$f,this.gf,this.f_)},enumerable:!1,configurable:!0}),uy.prototype.docChanges=function(t){t&&(ui("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ti("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));t=!(!t||!t.includeMetadataChanges);if(t&&this.xf.jt)throw new Tr(_r.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.kf&&this.Mf===t||(this.kf=function(i,e,o){if(i.Ut.m()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ut;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return kr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.xf,t,this.Of.bind(this)),this.Mf=t),this.kf},uy.prototype.isEqual=function(t){if(!(t instanceof uy))throw ai("isEqual","QuerySnapshot",1,t);return this.gf===t.gf&&Bu(this.$f,t.$f)&&this.xf.isEqual(t.xf)&&this.f_===t.f_},uy.prototype.Of=function(t,e,n){return new Bd(this.gf,t.key,t,e,n,this.f_)},uy),oy=(n(sy,ny=ry),Object.defineProperty(sy.prototype,"id",{get:function(){return this.Nf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(sy.prototype,"parent",{get:function(){var t=this.Nf.path.h();return t.m()?null:new jd(new Br(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(sy.prototype,"path",{get:function(){return this.Nf.path.R()},enumerable:!1,configurable:!0}),sy.prototype.doc=function(t){Xr("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=li.k()),$r("CollectionReference.doc","non-empty string",1,t);t=jr.P(t);return jd.Af(this.Nf.path.child(t),this.firestore,this.f_)},sy.prototype.add=function(t){Qr("CollectionReference.add",arguments,1);t=this.f_?this.f_.toFirestore(t):t;$r("CollectionReference.add","object",1,t);var e=this.doc();return new jd(e.__,this.firestore,null).set(t).then(function(){return e})},sy.prototype.withConverter=function(t){return new sy(this.Lf,this.firestore,t)},sy);function sy(t,e,n){var r=this;if(((r=ny.call(this,Ru(t),e,n)||this).Lf=t).length%2!=1)throw new Tr(_r.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.R()+" has "+t.length);return r}function uy(t,e,n,r){this.gf=t,this.$f=e,this.xf=n,this.f_=r,this.kf=null,this.Mf=null,this.metadata=new Fd(n.hasPendingWrites,n.fromCache)}function ay(t,e,n){this.Nf=t,this.firestore=e,this.f_=n}function cy(t,e){if(void 0===e)return{merge:!1};if(ui(t,e,["merge","mergeFields"]),ti(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+oi(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Tr(_r.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+oi(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof Dp}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Tr(_r.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function hy(t,e){return void 0===e?{}:(ui(t,e,["serverTimestamps"]),ei(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function fy(t,e){Jr(t,"object",1,e),e&&(ui(t,e,["source"]),ei(t,0,"source",e.source,["default","server","cache"]))}function ly(t,e,n){if(e instanceof $p){if(e.firestore!==n)throw new Tr(_r.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw ai(t,"DocumentReference",1,e)}function py(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var dy,yy,Ee=(n(gy,dy=Yp),gy.serverTimestamp=function(){Hr("FieldValue.serverTimestamp",arguments);var t=new zp("serverTimestamp");return t.t_="FieldValue.serverTimestamp",new gy(t)},gy.delete=function(){Hr("FieldValue.delete",arguments);var t=new Rp("deleteField");return t.t_="FieldValue.delete",new gy(t)},gy.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Yr("FieldValue.arrayUnion",arguments,1);var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yr("arrayUnion()",arguments,1),new Wp("arrayUnion",t)}.apply(void 0,t);return n.t_="FieldValue.arrayUnion",new gy(n)},gy.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Yr("FieldValue.arrayRemove",arguments,1);var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yr("arrayRemove()",arguments,1),new Kp("arrayRemove",t)}.apply(void 0,t);return n.t_="FieldValue.arrayRemove",new gy(n)},gy.increment=function(t){$r("FieldValue.increment","number",1,t),Qr("FieldValue.increment",arguments,1);t=new Hp("increment",t);return t.t_="FieldValue.increment",new gy(t)},gy.prototype.isEqual=function(t){return this.h_.isEqual(t.h_)},gy),vy={Firestore:Cd,GeoPoint:Qp,Timestamp:Di,Blob:Ni,Transaction:Ud,WriteBatch:Md,DocumentReference:jd,DocumentSnapshot:qd,Query:ry,QueryDocumentSnapshot:Bd,QuerySnapshot:iy,CollectionReference:oy,FieldPath:Dp,FieldValue:Ee,setLogLevel:Cd.setLogLevel,CACHE_SIZE_UNLIMITED:Pd};function gy(){return null!==dy&&dy.apply(this,arguments)||this}(yy=e.default).INTERNAL.registerComponent(new br("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new Np,t=new Tp(r),new Cd(e,n,t,r);var e,n,r},"PUBLIC").setServiceProps(Object.assign({},vy))),yy.registerVersion("@firebase/firestore","1.17.3")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
